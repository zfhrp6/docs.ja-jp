---
title: "確認"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 8637aeaf-ac9e-49b8-93f4-da15dee45277
caps.latest.revision: "7"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 42d9fad968b471c63dbdac2145bb9e84afed183b
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/22/2017
---
# <a name="confirmation"></a><span data-ttu-id="3a4fc-102">確認</span><span class="sxs-lookup"><span data-stu-id="3a4fc-102">Confirmation</span></span>
<span data-ttu-id="3a4fc-103">このサンプルでは、<xref:System.Activities.Statements.CompensableActivity> および確認を使用する 4 つの一般的なシナリオを示します。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-103">This sample shows four common scenarios surrounding the use of <xref:System.Activities.Statements.CompensableActivity> and confirmation.</span></span> <span data-ttu-id="3a4fc-104">確認を示すために、4 つのワークフローを実行します。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-104">The sample runs four workflows to show confirmation.</span></span> <span data-ttu-id="3a4fc-105">このサンプルには、宣言型バージョンと命令型バージョンが用意されています。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-105">This sample is available in declarative and imperative versions.</span></span>  
  
## <a name="confirm-a-compensable-activity"></a><span data-ttu-id="3a4fc-106">補正可能なアクティビティの確認</span><span class="sxs-lookup"><span data-stu-id="3a4fc-106">Confirm a Compensable Activity</span></span>  
 <span data-ttu-id="3a4fc-107">最初のワークフローでは、補正可能なアクティビティを確認する方法を示します。このワークフローは、2 つの <xref:System.Activities.Statements.CompensableActivity> インスタンスのシーケンスで構成されています。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-107">The first workflow demonstrates how to confirm a compensable activity and consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> instances.</span></span> <span data-ttu-id="3a4fc-108">2 つ目の <xref:System.Activities.Statements.CompensableActivity> の完了後、確認アクティビティによって 1 つ目のアクティビティが確認されます。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-108">After the completion of the second <xref:System.Activities.Statements.CompensableActivity> a confirm activity confirms the first activity.</span></span> <span data-ttu-id="3a4fc-109">ワークフローが正常に完了すると、確認または補正されていないすべての <xref:System.Activities.Statements.CompensableActivity> インスタンスが既定の順序で自動的に確認されます。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-109">When the workflow successfully completes, all <xref:System.Activities.Statements.CompensableActivity> instances that have not been confirmed or compensated are automatically confirmed using the default order.</span></span> <span data-ttu-id="3a4fc-110">確認アクティビティを使用しなかった場合、2 つ目の <xref:System.Activities.Statements.CompensableActivity> が最初に確認されていたことになります。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-110">Without the confirm, the second <xref:System.Activities.Statements.CompensableActivity> would have been confirmed first.</span></span>  
  
## <a name="explicit-compensation"></a><span data-ttu-id="3a4fc-111">明示的な補正</span><span class="sxs-lookup"><span data-stu-id="3a4fc-111">Explicit Compensation</span></span>  
 <span data-ttu-id="3a4fc-112">2 番目のシナリオでは、<xref:System.Activities.Statements.CompensableActivity> が明示的に補正される場合の既定の確認に対する影響を示します。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-112">The second scenario shows the affect on default confirmation when a <xref:System.Activities.Statements.CompensableActivity> is explicitly compensated.</span></span> <span data-ttu-id="3a4fc-113">このワークフローは、2 つの <xref:System.Activities.Statements.CompensableActivity> アクティビティのシーケンスで構成されています。2 つ目のアクティビティが完了すると、1 つ目のアクティビティが明示的に補正されます。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-113">The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> activities, after the second completes the first is explicitly compensated.</span></span> <span data-ttu-id="3a4fc-114">したがって、ワークフローが完了すると、2 つ目の <xref:System.Activities.Statements.CompensableActivity> のみが確認されます。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-114">As a result when the workflow, completes only the second <xref:System.Activities.Statements.CompensableActivity> is confirmed.</span></span>  
  
## <a name="controlling-the-order-of-confirmation-for-nested-compensableactivity-activities"></a><span data-ttu-id="3a4fc-115">入れ子になった CompensableActivity アクティビティの確認順序の制御</span><span class="sxs-lookup"><span data-stu-id="3a4fc-115">Controlling the Order of Confirmation for Nested CompensableActivity Activities</span></span>  
 <span data-ttu-id="3a4fc-116">3 番目のシナリオでは、入れ子になった <xref:System.Activities.Statements.CompensableActivity> の確認順序を制御する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-116">The third scenario shows how to control the order of confirmation for nested <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="3a4fc-117">このシナリオは、ワークフローのルートとしての <xref:System.Activities.Statements.CompensableActivity> で構成されています。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-117">The scenario consists of a <xref:System.Activities.Statements.CompensableActivity> as the root of the workflow.</span></span> <span data-ttu-id="3a4fc-118">ルート <xref:System.Activities.Statements.CompensableActivity> の本体は 3 つの <xref:System.Activities.Statements.CompensableActivity> のシーケンスです。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-118">The body of the root <xref:System.Activities.Statements.CompensableActivity> is a sequence of three <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="3a4fc-119">ルート <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> の <xref:System.Activities.Statements.CompensableActivity> は、1 つ目および 2 つ目の入れ子になった <xref:System.Activities.Statements.CompensableActivity> をこの順序で確認するように指定するシーケンスです。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-119">The <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> for the root <xref:System.Activities.Statements.CompensableActivity> is a sequence that specifies to confirm the first then the second nested <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="3a4fc-120">ワークフローが完了すると、ルート <xref:System.Activities.Statements.CompensableActivity> が確認され、その後、1 つ目、2 つ目、および 3 つ目の入れ子になった <xref:System.Activities.Statements.CompensableActivity> がこの順序で確認されます。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-120">When the workflow completes it confirms the root <xref:System.Activities.Statements.CompensableActivity>, which then confirms the first, second and third nested <xref:System.Activities.Statements.CompensableActivity>, in that order.</span></span> <span data-ttu-id="3a4fc-121">したがって、既定の確認順序は基本的に逆になります。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-121">As a result, the default confirmation order is essentially reversed.</span></span> <span data-ttu-id="3a4fc-122">3 つ目の <xref:System.Activities.Statements.CompensableActivity> はルート <xref:System.Activities.Statements.CompensableActivity> の一部として <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> によって明示的に確認されなかったため、既定の順序に従って確認されます。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-122">Because the third <xref:System.Activities.Statements.CompensableActivity> was not explicitly confirmed as part of the root <xref:System.Activities.Statements.CompensableActivity> by the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A>, it is confirmed according to the default order.</span></span> <span data-ttu-id="3a4fc-123">ただし、このアクティビティが唯一未確認の <xref:System.Activities.Statements.CompensableActivity> であるので、このアクティビティが確認されるだけです。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-123">However, because it is the only unconfirmed <xref:System.Activities.Statements.CompensableActivity> this just means it is confirmed.</span></span>  
  
## <a name="scoping-of-variables"></a><span data-ttu-id="3a4fc-124">変数のスコープ</span><span class="sxs-lookup"><span data-stu-id="3a4fc-124">Scoping of Variables</span></span>  
 <span data-ttu-id="3a4fc-125">4 番目のシナリオでは、アクティビティが完了した場合またはワークフローが完了した場合でも、<xref:System.Activities.Statements.CompensableActivity>、<xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A>、または <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> の各ハンドラーが実行されるときに、<xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> またはその親のいずれかに対して定義された変数が有効期間中にスコープ外にならないようにする方法を示します。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-125">The fourth scenario shows how the lifetime of variables defined for a <xref:System.Activities.Statements.CompensableActivity> or one of their parents are still in scope when the <xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A>, <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> or <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> handlers are executed even if the activity has completed or the workflow has completed.</span></span> <span data-ttu-id="3a4fc-126">このワークフローは、2 つの <xref:System.Activities.Statements.CompensableActivity> のシーケンスで構成されています。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-126">The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="3a4fc-127">1 つ目のアクティビティの本体では、変数 `mySum` は、5 と 10 の合計、および印刷される結果に設定されます。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-127">In the body of the first, the variable `mySum` is set to the sum of 5 and 10 and the result printed.</span></span> <span data-ttu-id="3a4fc-128">2 つ目の <xref:System.Activities.Statements.CompensableActivity> の本体では、合計は、既存の合計と 7 の合計、および印刷される結果に設定されます。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-128">In the body of the second <xref:System.Activities.Statements.CompensableActivity>, the sum is set to the sum of the existing sum and 7 and the result printed.</span></span> <span data-ttu-id="3a4fc-129">1 つ目の <xref:System.Activities.Statements.CompensableActivity> に対しては、カスタムの確認ハンドラーが定義されています。このアクティビティは、合計を印刷し、7 を差し引いて、合計を再度印刷します。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-129">A custom confirmation handler is defined for the first <xref:System.Activities.Statements.CompensableActivity>, which prints the sum, subtracts 7 and prints the sum again.</span></span> <span data-ttu-id="3a4fc-130">印刷された合計を調べることで、両方の <xref:System.Activities.Statements.CompensableActivity> の本体だけでなく <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> についても変数がスコープ内にあることがわかります。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-130">It is clear by inspecting the printed sums that the variable is in scope not only for the bodies of both <xref:System.Activities.Statements.CompensableActivity> but the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> as well.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="3a4fc-131">サンプルを実行するには</span><span class="sxs-lookup"><span data-stu-id="3a4fc-131">To run the sample</span></span>  
  
1.  <span data-ttu-id="3a4fc-132">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] でソリューションを読み込みます。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-132">Load the solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span></span>  
  
2.  <span data-ttu-id="3a4fc-133">ConfirmationSample.exe アプリケーションを実行します。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-133">Run the ConfirmationSample.exe application.</span></span>  
  
3.  <span data-ttu-id="3a4fc-134">次の出力を確認します。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-134">Observe the following output:</span></span>  
  
 <span data-ttu-id="3a4fc-135">**明示的な確認: workflowCompensableActivity1 の開始: BodyCompensableActivity2: BodyCompensableActivity1: workflowCompensableActivity2 の確認 HandlerEnd: 確認 HandlerExplicit の補正: 開始workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: workflowCompensableActivity2 の補正 HandlerEnd: 確認 HandlerCustom 確認ハンドラー: 開始 workflowCompensableActivity1 の。BodyCompensableActivity2: BodyCompensableActivity3: workflowCompensableActivity1 の BodyEnd: 確認 HandlerCompensableActivity2: 確認 HandlerCompensableActivity3: 確認ハンドラーの確認 HandlerVariable アクセス。WorkflowCompensableActivity1 の開始: BodyCompensableActivity1: 合計: 15CompensableActivity2: BodyCompensableActivity2: 7、sumCompensableActivity2 を追加する: 合計: workflowCompensableActivity2 の 22End: 確認HandlerCompensableActivity1: 確認 HandlerCompensableActivity2: 合計: 22CompensableActivity2: 12 を引いた後、合計になります: を終了する 10Press を入力してください。**</span><span class="sxs-lookup"><span data-stu-id="3a4fc-135">**Explicit confirmation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Confirmation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerExplicit compensation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Compensation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerCustom confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity3: BodyEnd of workflowCompensableActivity1: Confirmation HandlerCompensableActivity2: Confirmation HandlerCompensableActivity3: Confirmation HandlerVariable access in a confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity1: The sum is: 15CompensableActivity2: BodyCompensableActivity2: Adding 7 to the sumCompensableActivity2: The sum is now: 22End of workflowCompensableActivity2: Confirmation HandlerCompensableActivity1: Confirmation HandlerCompensableActivity2: The sum is: 22CompensableActivity2: After subtracting 12 the sum is now: 10Press ENTER to exit.**</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="3a4fc-136">サンプルは、既にコンピューターにインストールされている場合があります。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-136">The samples may already be installed on your machine.</span></span> <span data-ttu-id="3a4fc-137">続行する前に、次の (既定の) ディレクトリを確認してください。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-137">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="3a4fc-138">このディレクトリが存在しない場合は、「 [.NET Framework 4 向けの Windows Communication Foundation (WCF) および Windows Workflow Foundation (WF) のサンプル](http://go.microsoft.com/fwlink/?LinkId=150780) 」にアクセスして、 [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] および [!INCLUDE[wf1](../../../../includes/wf1-md.md)] のサンプルをすべてダウンロードしてください。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-138">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="3a4fc-139">このサンプルは、次のディレクトリに格納されます。</span><span class="sxs-lookup"><span data-stu-id="3a4fc-139">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Compensation\Confirmation`