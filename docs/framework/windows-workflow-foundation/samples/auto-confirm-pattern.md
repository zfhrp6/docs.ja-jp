---
title: 自動確認パターン
ms.date: 03/30/2017
ms.assetid: 668aec65-78d3-4636-9c7b-deed643a18f9
ms.openlocfilehash: b30703ffba3b721ac544ea6471ec47ce7f746d2b
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/04/2018
ms.locfileid: "33515994"
---
# <a name="auto-confirm-pattern"></a><span data-ttu-id="133ff-102">自動確認パターン</span><span class="sxs-lookup"><span data-stu-id="133ff-102">Auto-Confirm Pattern</span></span>
<span data-ttu-id="133ff-103">このサンプルは、カスタム `AutoConfirmScope` アクティビティを示す 3 つのシナリオで構成されます。</span><span class="sxs-lookup"><span data-stu-id="133ff-103">This sample consists of three scenarios that run illustrating a custom `AutoConfirmScope` activity.</span></span> <span data-ttu-id="133ff-104">1 つ目のサンプルでは、2 番目と 3 番目の補正可能なアクティビティが `AutoConfirmScope` で入れ子になっている 4 つの補正可能なアクティビティのシーケンスが正常に実行された場合を示します。</span><span class="sxs-lookup"><span data-stu-id="133ff-104">The first sample shows the successful execution of a sequence of four compensable activities where the second and third are nested in an `AutoConfirmScope`.</span></span> <span data-ttu-id="133ff-105">2 つ目のサンプルでは、同じシーケンスを示しますが、4 番目の <xref:System.Activities.Statements.CompensableActivity> の実行後に例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="133ff-105">The second sample shows the same sequence with an exception occurring after the execution of the fourth <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="133ff-106">3 つ目のシナリオでは、同じシーケンスを示しますが、2 番目の `AutoConfirmScope` の完了後に <xref:System.Activities.Statements.CompensableActivity> で例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="133ff-106">The third scenario shows the same sequence with an exception occurring in the `AutoConfirmScope` after the second <xref:System.Activities.Statements.CompensableActivity> completes.</span></span>  
  
 <span data-ttu-id="133ff-107">このサンプルでは、スコープが正常に完了したときにすべての補正可能な子アクティビティが確認される自動確認パターンを示します。</span><span class="sxs-lookup"><span data-stu-id="133ff-107">The sample demonstrates the auto-confirm pattern where all child compensable activities are confirmed upon successful completion of the scope.</span></span> <span data-ttu-id="133ff-108">このパターンでは、すべての補正可能な子アクティビティの有効期間が定義され、この期間を過ぎるとこれらのアクティビティは補正または確認できなくなります。</span><span class="sxs-lookup"><span data-stu-id="133ff-108">This pattern defines the lifetime of all child compensable activities, as they can no longer be compensated or confirmed.</span></span>  
  
 <span data-ttu-id="133ff-109">スコープは、<xref:System.Activities.Statements.TryCatch> が内部 <xref:System.Activities.Statements.TryCatch.Try%2A> である <xref:System.Activities.Statements.CompensableActivity> で構成されます。</span><span class="sxs-lookup"><span data-stu-id="133ff-109">The scope consists of a <xref:System.Activities.Statements.TryCatch> where the <xref:System.Activities.Statements.TryCatch.Try%2A> is an internal <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="133ff-110">`AutoConfirmScope` のユーザー指定の本文は、内部 <xref:System.Activities.Statements.CompensableActivity> の本文です。</span><span class="sxs-lookup"><span data-stu-id="133ff-110">The user-specified body of the `AutoConfirmScope` is the body of the inner <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="133ff-111">この内部 <xref:System.Activities.Statements.CompensableActivity> が完了すると、<xref:System.Activities.Statements.CompensationToken> が out 引数として生成されます。</span><span class="sxs-lookup"><span data-stu-id="133ff-111">When this internal <xref:System.Activities.Statements.CompensableActivity> completes, it produces a <xref:System.Activities.Statements.CompensationToken> as an out-argument.</span></span> <span data-ttu-id="133ff-112">`AutoConfirmScope` は、<xref:System.Activities.Statements.TryCatch.Finally%2A> を使用してトークンが生成されているかどうかをチェックし、生成されている場合は内部 <xref:System.Activities.Statements.CompensableActivity> を確認します。</span><span class="sxs-lookup"><span data-stu-id="133ff-112">The `AutoConfirmScope` uses a <xref:System.Activities.Statements.TryCatch.Finally%2A> to check whether the token has been produced and if it has then it confirms the inner <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="133ff-113">内部 <xref:System.Activities.Statements.CompensableActivity> は、本文に存在する補正可能なアクティビティの既定の補正を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="133ff-113">The inner <xref:System.Activities.Statements.CompensableActivity> invokes the default compensation for any compensable activities that may exist in its body.</span></span>  
  
 <span data-ttu-id="133ff-114">1 つ目のシナリオでは、ワークフローが正常に実行された場合を示します。ワークフローが完了して 1 番目と 4 番目の補正可能なアクティビティが確認されるときには、2 番目と 3 番目の補正可能なアクティビティは既に確認されています。</span><span class="sxs-lookup"><span data-stu-id="133ff-114">The first scenario shows successful execution of the workflow and demonstrates that the second and third compensable activities are already confirmed when the workflow completes and the first and fourth are confirmed.</span></span> <span data-ttu-id="133ff-115">ここでは、確認順序は 3、2、4、1 となります。</span><span class="sxs-lookup"><span data-stu-id="133ff-115">This produces a confirmation order of three, two, four, and one.</span></span>  
  
 <span data-ttu-id="133ff-116">2 つ目のシナリオでは、4 つの補正可能なアクティビティの完了後に例外が発生した場合を示します。</span><span class="sxs-lookup"><span data-stu-id="133ff-116">The second scenario shows an exception after the four compensable activities have completed.</span></span> <span data-ttu-id="133ff-117">補正可能なアクティビティ 2 および 3 は既に確認されているので影響を受けませんが、1 および 4 は補正されます。</span><span class="sxs-lookup"><span data-stu-id="133ff-117">Because compensable activities two and three are already confirmed they are unaffected but one and four are compensated.</span></span> <span data-ttu-id="133ff-118">ここでは、3 が確認され、2 が確認され、4 が補正されて 1 が補正されます。</span><span class="sxs-lookup"><span data-stu-id="133ff-118">This produces confirm three, confirm two, compensate four and compensate one.</span></span>  
  
 <span data-ttu-id="133ff-119">最後のシナリオでは、`AutoConfirmScope` が正常に実行されなかった場合を示します。</span><span class="sxs-lookup"><span data-stu-id="133ff-119">The final scenario shows unsuccessful execution of the `AutoConfirmScope`.</span></span> <span data-ttu-id="133ff-120">このシナリオでは、2 番目の <xref:System.Activities.Statements.CompensableActivity> の完了後に例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="133ff-120">In this scenario, an exception occurs after the completion of the second <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="133ff-121">3 番目と 4 番目の補正可能なアクティビティは実行されていないので影響を受けません。</span><span class="sxs-lookup"><span data-stu-id="133ff-121">Because the third and fourth compensable activities have not executed, they are unaffected.</span></span> <span data-ttu-id="133ff-122">スコープが正常に完了しなかったので、2 番目の <xref:System.Activities.Statements.CompensableActivity> は確認されません。</span><span class="sxs-lookup"><span data-stu-id="133ff-122">Because the scope did not complete successfully, the second <xref:System.Activities.Statements.CompensableActivity> does not get confirmed.</span></span> <span data-ttu-id="133ff-123">ここでは、補正順序は 2、1 となります。</span><span class="sxs-lookup"><span data-stu-id="133ff-123">This produces and compensation order of two then one.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="133ff-124">このサンプルを使用するには</span><span class="sxs-lookup"><span data-stu-id="133ff-124">To use this sample</span></span>  
  
1.  <span data-ttu-id="133ff-125">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] を使用して、AutoConfirmSample.sln ソリューション ファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="133ff-125">Using [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], open the AutoConfirmSample.sln solution file.</span></span>  
  
2.  <span data-ttu-id="133ff-126">ソリューションをビルドするには、Ctrl キーと Shift キーを押しながら B キーを押します。</span><span class="sxs-lookup"><span data-stu-id="133ff-126">To build the solution, press CTRL+SHIFT+B.</span></span>  
  
3.  <span data-ttu-id="133ff-127">ソリューションを実行するには、Ctrl キーを押しながら F5 キーを押します。</span><span class="sxs-lookup"><span data-stu-id="133ff-127">To run the solution, press CTRL+F5.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="133ff-128">サンプルは、既にコンピューターにインストールされている場合があります。</span><span class="sxs-lookup"><span data-stu-id="133ff-128">The samples may already be installed on your machine.</span></span> <span data-ttu-id="133ff-129">続行する前に、次の (既定の) ディレクトリを確認してください。</span><span class="sxs-lookup"><span data-stu-id="133ff-129">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="133ff-130">このディレクトリが存在しない場合に、 [Windows Communication Foundation (WCF) および .NET Framework 4 向けの Windows Workflow Foundation (WF) サンプル](http://go.microsoft.com/fwlink/?LinkId=150780)すべて Windows Communication Foundation (WCF) をダウンロードして[!INCLUDE[wf1](../../../../includes/wf1-md.md)]サンプルです。</span><span class="sxs-lookup"><span data-stu-id="133ff-130">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="133ff-131">このサンプルは、次のディレクトリに格納されます。</span><span class="sxs-lookup"><span data-stu-id="133ff-131">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\Compensation\AutoConfirm`