---
title: "キューの概要"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords: queues [WCF], MSMQ integration
ms.assetid: b8757992-ffce-40ad-9e9b-3243f6d0fce1
caps.latest.revision: "28"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: c0952f238c34176112f6ec6a8520fb603cca4750
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/02/2017
---
# <a name="queues-overview"></a><span data-ttu-id="4c3fd-102">キューの概要</span><span class="sxs-lookup"><span data-stu-id="4c3fd-102">Queues Overview</span></span>
<span data-ttu-id="4c3fd-103">ここでは、キューを使った通信の概要とその基本概念を解説します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-103">This section introduces the general and core concepts behind queued communication.</span></span> <span data-ttu-id="4c3fd-104">後の各セクションでは、キューの概念がどのように [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] に活かされているかを詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-104">Subsequent sections go into details about how the queuing concepts described here are manifested in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span>  
  
## <a name="basic-queuing-concepts"></a><span data-ttu-id="4c3fd-105">キューの基本概念</span><span class="sxs-lookup"><span data-stu-id="4c3fd-105">Basic Queuing Concepts</span></span>  
 <span data-ttu-id="4c3fd-106">分散アプリケーションの設計では、サービスとクライアントとの間の通信に適したトランスポートを選択することが重要になります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-106">When designing a distributed application, choosing the right transport for communication between services and clients is important.</span></span> <span data-ttu-id="4c3fd-107">使用するトランスポートの種類の決定には、いくつかの要素が影響します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-107">Several factors affect the kind of transport to use.</span></span> <span data-ttu-id="4c3fd-108">そのうちの 1 つである、サービス、クライアント、トランスポートの分離という重要な要素により、キューを使用するトランスポートと、TCP や HTTP などの直接的なトランスポートのどちらを使用するかが決定します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-108">One important factor—isolation between the service, the client, and the transport—determines use of a queued transport or a direct transport, such as TCP or HTTP.</span></span> <span data-ttu-id="4c3fd-109">TCP や HTTP などの直接的なトランスポートの性質により、サービスやクライアントの機能が停止したり、ネットワークに障害が発生したりすると、通信全体が停止します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-109">Due to the nature of direct transports such as TCP and HTTP, communication stops altogether if the service or the client stop functioning or if the network fails.</span></span> <span data-ttu-id="4c3fd-110">アプリケーションが全体として正常に機能するためには、サービス、クライアント、ネットワークがすべて揃って稼働している必要があります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-110">The service, the client, and the network must be running at the same time for the application to work.</span></span> <span data-ttu-id="4c3fd-111">キューを使用するトランスポートでは、分離が実現されます。つまり、サービスやクライアントが停止したり、これらの間の通信リンクに障害が発生したりしても、障害が発生していないサービスやクライアントは引き続き機能します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-111">Queued transports provide isolation, which means that if the service or client fail or if communication links between them fail, the client and service can continue to function.</span></span>  
  
 <span data-ttu-id="4c3fd-112">キューとは、通信ノードやネットワークの障害時にも通信の信頼性を確保するための手段です。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-112">Queues provide reliable communication even with failures in the communicating parties or the network.</span></span> <span data-ttu-id="4c3fd-113">通信ノード間で交換されたメッセージは、いったんキューに取り込まれ、それから配信されます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-113">Queues capture and deliver messages exchanged between the communicating parties.</span></span> <span data-ttu-id="4c3fd-114">通常、キューはその過程で、記憶装置に保存されます。これは、一時的に記憶されるだけの場合も、ある程度の期間保存される場合もあります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-114">Queues are typically backed by some kind of a store, which can be volatile or durable.</span></span> <span data-ttu-id="4c3fd-115">キューは、クライアントからのメッセージをサービスに代わって保存しておき、後でサービスに転送します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-115">Queues store messages from a client on behalf of a service and later forward these messages to the service.</span></span> <span data-ttu-id="4c3fd-116">このように、仲介の役割を果たすキューにより、いずれかの通信ノードで生じた障害が分離されるので、システムの可用性およびサービスの分離を実現するには、キューを使用するトランスポートが適しています。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-116">The indirection queues provide ensured isolation of failure by either party, thus making it the preferred communication mechanism for high-availability systems and disconnected services.</span></span> <span data-ttu-id="4c3fd-117">しかしその一方で、通信の遅延が大きい、という欠点があります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-117">The indirection comes with the cost of high latency.</span></span> <span data-ttu-id="4c3fd-118">*待機時間*サービスでは受信時間と、クライアントは、メッセージ送信時間の時間遅延がします。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-118">*Latency* is the time delay between the time the client sends a message and the time the service receives it.</span></span> <span data-ttu-id="4c3fd-119">遅延が大きいと、メッセージを送ってから実際に処理されるまでに、時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-119">This means that once a message is sent, you do not know when that message may be processed.</span></span> <span data-ttu-id="4c3fd-120">キューを使用する多くのアプリケーションでは、この遅延への対策が講じられています。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-120">Most queued applications cope with high latency.</span></span> <span data-ttu-id="4c3fd-121">次の図は、キューに置かれた通信の概念モデルを表したものです。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-121">The following illustration shows a conceptual model of queued communication.</span></span>  
  
 <span data-ttu-id="4c3fd-122">![キューに置かれた通信のモデル](../../../../docs/framework/wcf/feature-details/media/qconceptual-figure1c.gif "QConceptual Figure1c")</span><span class="sxs-lookup"><span data-stu-id="4c3fd-122">![Model of queued communication](../../../../docs/framework/wcf/feature-details/media/qconceptual-figure1c.gif "QConceptual-Figure1c")</span></span>  
  
 <span data-ttu-id="4c3fd-123">キューを使う通信の概念モデル</span><span class="sxs-lookup"><span data-stu-id="4c3fd-123">Queued communication conceptual model</span></span>  
  
 <span data-ttu-id="4c3fd-124">現実には、キューの概念は分散処理モデルに基づいています。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-124">In reality, the queue is a distributed concept.</span></span> <span data-ttu-id="4c3fd-125">キューはサービスまたはクライアントと同じホスト上に配置される場合も、この両方から独立している場合もあります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-125">As such, they can be local to either party or remote to both parties.</span></span> <span data-ttu-id="4c3fd-126">一般的には、キューはサービスと同じホスト上に配置します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-126">Typically, the queue is local to the service.</span></span> <span data-ttu-id="4c3fd-127">このような構成の場合、クライアント側では、リモート キューに接続していつでも使用できると想定することはできません。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-127">In this configuration, the client cannot depend on connectivity to the remote queue to be constantly available.</span></span> <span data-ttu-id="4c3fd-128">同様に、キューを使用するサービスの可用性に関係なく、キューの可用性が確保されなければなりません。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-128">Similarly, the queue must be available independent of the availability of the service reading from the queue.</span></span> <span data-ttu-id="4c3fd-129">そこで、キューの管理がキュー マネージャーによって行われます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-129">A queue manager manages a collection of queues.</span></span> <span data-ttu-id="4c3fd-130">キュー マネージャーは、他のキュー マネージャーからキューに送信されたメッセージを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-130">It is responsible for accepting messages sent to its queues from other queue managers.</span></span> <span data-ttu-id="4c3fd-131">さらに、リモート キューとの接続を管理し、これらのリモート キューにメッセージを転送するのもキュー マネージャーの役割です。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-131">It is also responsible for managing connectivity to remote queues and transferring messages to those remote queues.</span></span> <span data-ttu-id="4c3fd-132">クライアントやサービスに障害が発生してもキューの可用性を確保できるように、キュー マネージャーは通常、外部サービスとして実行されます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-132">To ensure availability of queues despite client or service application failures, the queue manager is typically run as an external service.</span></span>  
  
 <span data-ttu-id="4c3fd-133">クライアントがメッセージをキューに送信すると、そのメッセージがターゲット キュー (サービス側のキュー マネージャーが管理するキュー) に送信されます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-133">When a client sends a message to a queue, it addresses the message to the target queue, which is the queue managed by the service's queue manager.</span></span> <span data-ttu-id="4c3fd-134">クライアント側のキュー マネージャーは、メッセージを転送キュー (送信キュー) に送ります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-134">The queue manager on the client sends the message to a transmission (or outgoing) queue.</span></span> <span data-ttu-id="4c3fd-135">転送キューとは、クライアントのキュー マネージャーが管理するキューであり、ここではターゲット キューに転送されるメッセージがいったん蓄積されます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-135">The transmission queue is a queue on the client queue manager that stores messages for transmission to the target queue.</span></span> <span data-ttu-id="4c3fd-136">次にキュー マネージャーは、ターゲット キューを管理するキュー マネージャーとの通信経路を検索し、転送します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-136">The queue manager then finds a path to the queue manager that owns the target queue and transfers the message to it.</span></span> <span data-ttu-id="4c3fd-137">通信の信頼性を確保するために、キュー マネージャーには、データの損失を防止する転送プロトコルが実装されています。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-137">To ensure reliable communication, the queue managers implement a reliable transfer protocol to prevent data loss.</span></span> <span data-ttu-id="4c3fd-138">送信先のキュー マネージャーは、ターゲット キュー宛てのメッセージを受信してターゲット キューに格納します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-138">The destination queue manager accepts messages addressed to the target queues it owns and stores the messages.</span></span> <span data-ttu-id="4c3fd-139">ターゲット キューからの読み出しをサービスが要求すると、キュー マネージャーから目的のアプリケーションにメッセージが配信されます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-139">The service makes requests to read from the target queue, at which time the queue manager then delivers the message to the destination application.</span></span> <span data-ttu-id="4c3fd-140">以上のやり取りに関与する 4 者の関係を図に示します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-140">The following illustration shows communication between the four parties.</span></span>  
  
 <span data-ttu-id="4c3fd-141">![アプリケーション ダイアグラムをキューに置かれた](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "分散キュー図")</span><span class="sxs-lookup"><span data-stu-id="4c3fd-141">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="4c3fd-142">キューを使った通信 - 標準的な構成</span><span class="sxs-lookup"><span data-stu-id="4c3fd-142">Queued communication in a typical deployment scenario</span></span>  
  
 <span data-ttu-id="4c3fd-143">このように、キュー マネージャーによりサービスとクライアントが分離されているため、送信側または受信側のいずれかが停止していても、実際の通信には影響しません。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-143">Thus, the queue manager provides the required isolation so that the sender and receiver can independently fail without affecting actual communication.</span></span> <span data-ttu-id="4c3fd-144">キューの導入によるもう 1 つの利点として、複数のアプリケーションが同じキューからメッセージを読み込めるため、各ノードが個別に通信する場合に比べ、スループットを改善できるという点があります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-144">The benefit of extra indirection that queues provide also enables multiple application instances to read from the same queue, so that farming work among the nodes achieves higher throughput.</span></span> <span data-ttu-id="4c3fd-145">実際、拡張性やスループットを改善するためにキューを使用するケースも少なくありません。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-145">Therefore, it is not uncommon to see queues being used to achieve higher scale and throughput requirements.</span></span>  
  
## <a name="queues-and-transactions"></a><span data-ttu-id="4c3fd-146">キューとトランザクション</span><span class="sxs-lookup"><span data-stu-id="4c3fd-146">Queues and Transactions</span></span>  
 <span data-ttu-id="4c3fd-147">トランザクションでは、複数の操作をグループ化できるため、トランザクションに含まれる操作が 1 つでも失敗すると、すべての処理が失敗となります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-147">Transactions allow you to group a set of operations together so that if one operation fails, all of the operations fail.</span></span> <span data-ttu-id="4c3fd-148">例として、ATM を使用して 10 万円を普通預金から当座預金に移すことを考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-148">An example of how to use transactions is when a person uses an ATM to transfer $1,000 from his savings account to his checking account.</span></span> <span data-ttu-id="4c3fd-149">これは、次の操作を伴います。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-149">This entails the following operations:</span></span>  
  
-   <span data-ttu-id="4c3fd-150">普通預金から 10 万円を引き出す。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-150">Withdrawing $1,000 from the savings account.</span></span>  
  
-   <span data-ttu-id="4c3fd-151">当座預金に 10 万円を預ける。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-151">Depositing $1,000 into the checking account.</span></span>  
  
 <span data-ttu-id="4c3fd-152">最初の処理が成功して 10 万円が引き出された後、2 番目の操作が失敗すれば、既に引き出された 10 万円が失われてしまいます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-152">If the first operation succeeds and $1,000 is withdrawn from the savings account but the second operation fails, the $1,000 is lost because it has already been withdrawn from the savings account.</span></span> <span data-ttu-id="4c3fd-153">このような状況を避けて口座の状態を有効に維持するには、いずれか一方の操作に失敗したら、両方の操作を失敗と見なす必要があります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-153">To keep the accounts in a valid state, if one operation fails, both operations must fail.</span></span>  
  
 <span data-ttu-id="4c3fd-154">トランザクション メッセージでは、メッセージをキューに送る操作やキューから読み出す操作を、トランザクション内で行えます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-154">In transactional messaging, messages can be sent to the queue and received from the queue under a transaction.</span></span> <span data-ttu-id="4c3fd-155">つまり、トランザクション内でメッセージをキューに送った後でそのトランザクションがロールバックされると、その結果は、始めからメッセージを送らなかった場合と同じになります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-155">Thus, if a message is sent in a transaction and the transaction is rolled back, then the outcome is as if the message had never been sent to the queue.</span></span> <span data-ttu-id="4c3fd-156">同様に、トランザクション内でメッセージを受け取った後でそのトランザクションがロールバックされると、その結果は、メッセージを受信しなかった場合と同じになります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-156">Similarly if a message is received in a transaction and the transaction is rolled back, then the outcome is as if the message had never been received.</span></span> <span data-ttu-id="4c3fd-157">メッセージはキューに残り、読み出せる状態になります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-157">The message remains in the queue to be read.</span></span>  
  
 <span data-ttu-id="4c3fd-158">遅延が大きいため、メッセージを送る時点では、ターゲット キューに到達するまでどれぐらいかかるか、サービスがそのメッセージを処理するのにどれぐらいかかるかを知る手段はありません。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-158">Because of high latency, when you send a message you have no way of knowing how long it takes to reach its target queue, nor do you know how long it takes for the service to process the message.</span></span> <span data-ttu-id="4c3fd-159">したがって、単一のトランザクションを使用してメッセージの送信、受信、処理を行うことは、望ましくありません。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-159">Because of this, you do not want to use a single transaction to send the message, receive the message, and then process the message.</span></span> <span data-ttu-id="4c3fd-160">トランザクション全体がコミットされるまでの時間が予測できないからです。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-160">This creates a transaction that is not committed for an indeterminate amount of time.</span></span> <span data-ttu-id="4c3fd-161">トランザクションを使用してクライアントとサービスがキューを介して通信する場合は、クライアントとサービスでそれぞれトランザクションが必要になります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-161">When a client and service communicate through a queue using a transaction, two transactions are involved: one on the client and one on the service.</span></span> <span data-ttu-id="4c3fd-162">下の図は、キューを使った典型的な通信でのトランザクション境界を示しています。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-162">The following illustration shows the transaction boundaries in typical queued communication.</span></span>  
  
 <span data-ttu-id="4c3fd-163">![トランザクションを持つキュー](../../../../docs/framework/wcf/feature-details/media/qwithtransactions-figure3.gif "QWithTransactions 図 3")</span><span class="sxs-lookup"><span data-stu-id="4c3fd-163">![Queue with transactions](../../../../docs/framework/wcf/feature-details/media/qwithtransactions-figure3.gif "QWithTransactions-Figure3")</span></span>  
  
 <span data-ttu-id="4c3fd-164">キューを使った通信 - 送受信の別個のトランザクション</span><span class="sxs-lookup"><span data-stu-id="4c3fd-164">Queued communication showing separate transactions for capture and delivery</span></span>  
  
 <span data-ttu-id="4c3fd-165">クライアントのトランザクションでは、メッセージを処理し、送信します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-165">The client transaction processes and sends the message.</span></span> <span data-ttu-id="4c3fd-166">トランザクションがコミットされると、メッセージは転送キューに入ります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-166">When the transaction is committed, the message is in the transmission queue.</span></span> <span data-ttu-id="4c3fd-167">一方、サービスでは、ターゲット キューからメッセージを読み取り、メッセージを処理して、トランザクションをコミットします。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-167">On the service, the transaction reads the message from the target queue, processes the message, and then commits the transaction.</span></span> <span data-ttu-id="4c3fd-168">メッセージの処理中にエラーが発生すると、そのメッセージはロールバックされ、ターゲット キューに置かれます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-168">If an error occurs during the processing, the message is rolled back and placed in the target queue.</span></span>  
  
## <a name="asynchronous-communication-using-queues"></a><span data-ttu-id="4c3fd-169">キューを使った非同期通信</span><span class="sxs-lookup"><span data-stu-id="4c3fd-169">Asynchronous Communication Using Queues</span></span>  
 <span data-ttu-id="4c3fd-170">キューを利用すると非同期通信も可能です。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-170">Queues provide an asynchronous means of communication.</span></span> <span data-ttu-id="4c3fd-171">キューを使用してメッセージを送信するアプリケーションは、キュー マネージャーで生じる遅延が大きいため、メッセージが受信側で受信および処理されるまで待機することができません。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-171">Applications that send messages using queues cannot wait for the message to be received and processed by the receiver because of high latency introduced by the queue manager.</span></span> <span data-ttu-id="4c3fd-172">想定以上に長い期間、メッセージがキューに残ったままになる可能性があるからです。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-172">Messages can remain in the queue for a far longer time than the application intended.</span></span> <span data-ttu-id="4c3fd-173">この状況を回避するために、メッセージに有効期間 (TTL: Time-To-Live) を設定できるようになっています。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-173">To avoid this, the application can specify a Time-To-Live value on the message.</span></span> <span data-ttu-id="4c3fd-174">これはメッセージが転送キューに留まっていられる時間を表す値です。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-174">This value specifies how long the message should remain in the transmission queue.</span></span> <span data-ttu-id="4c3fd-175">この時間が経過してもターゲット キューに送信されなかったメッセージは、配信不能キューに転送することができます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-175">If this time value is exceeded, and the message still has not been sent to the target queue, the message can be transferred to a dead-letter queue.</span></span>  
  
 <span data-ttu-id="4c3fd-176">送信側がメッセージを送信した時点で、送信操作から制御が戻っても、送信側の転送キューにメッセージが到達したことを示しているにすぎません。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-176">When the sender sends a message, the return from the send operation implies that the message only made it to the transmission queue on the sender.</span></span> <span data-ttu-id="4c3fd-177">ターゲット キューへの転送に失敗していても、送信元アプリケーションで、すぐにそれを知ることはできないのです。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-177">As such, if there is a failure in getting the message to the target queue, the sending application cannot know about it immediately.</span></span> <span data-ttu-id="4c3fd-178">このような失敗を記録するために、失敗したメッセージは配信不能キューに転送されます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-178">To take note of such failures, the failed message is transferred to a dead-letter queue.</span></span>  
  
 <span data-ttu-id="4c3fd-179">ターゲット キューに到達できなかったり有効期間を経過したエラーは、個別に処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-179">Any error, such as a message failing to reach the target queue or the Time-To-Live expiring, must be processed separately.</span></span> <span data-ttu-id="4c3fd-180">このため、キューを使用するアプリケーションでは、次の 2 つに分けてロジックを記述することも少なくありません。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-180">It is not uncommon, therefore, for queued applications to write two sets of logic:</span></span>  
  
-   <span data-ttu-id="4c3fd-181">正常時にクライアントおよびサービスがメッセージを送受信するためのロジック</span><span class="sxs-lookup"><span data-stu-id="4c3fd-181">The normal client and service logic of sending and receiving messages.</span></span>  
  
-   <span data-ttu-id="4c3fd-182">失敗した転送や配信からのメッセージを処理するための補正ロジック</span><span class="sxs-lookup"><span data-stu-id="4c3fd-182">Compensation logic to handle messages from the failed transmission or delivery.</span></span>  
  
 <span data-ttu-id="4c3fd-183">以下のセクションで、これらの概念について説明します。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-183">The following sections discuss these concepts.</span></span>  
  
## <a name="dead-letter-queue-programming"></a><span data-ttu-id="4c3fd-184">配信不能キューのプログラミング</span><span class="sxs-lookup"><span data-stu-id="4c3fd-184">Dead-Letter Queue Programming</span></span>  
 <span data-ttu-id="4c3fd-185">配信不能キューには、さまざまな原因によりターゲット キューに到達できなかったメッセージが収容されます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-185">Dead-letter queues contain messages that failed to reach the target queue for various reasons.</span></span> <span data-ttu-id="4c3fd-186">原因としては、有効期限の経過や、ターゲット キューとの接続経路の異常などが考えられます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-186">The reasons can range from expired messages to connectivity issues preventing transfer of the message to the target queue.</span></span>  
  
 <span data-ttu-id="4c3fd-187">通常、アプリケーションは、システム全体の配信不能キューを読み取り、エラー原因を調べたうえで、エラー状態を修復して再送したり、エラーを記録したりするなどの適切な処理を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-187">Typically, an application can read messages from a system-wide dead-letter queue, determine what went wrong, and take appropriate action, such as correcting the errors and resending the message or taking note of it.</span></span>  
  
## <a name="poison-message-queue-programming"></a><span data-ttu-id="4c3fd-188">有害メッセージ キューのプログラミング</span><span class="sxs-lookup"><span data-stu-id="4c3fd-188">Poison Message Queue Programming</span></span>  
 <span data-ttu-id="4c3fd-189">メッセージがターゲット キューに到達しても、サービス側で繰り返し処理に失敗する場合があります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-189">After a message makes it to the target queue, the service may repeatedly fail to process the message.</span></span> <span data-ttu-id="4c3fd-190">原因としては、アプリケーションがトランザクション内でキューからメッセージを読み込み、データベースを更新しようとしたところ、データベースの接続が一時的に切断されていた、というような状況が考えられます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-190">For example, an application reading a message from the queue under a transaction and updating a database may find the database temporarily disconnected.</span></span> <span data-ttu-id="4c3fd-191">この場合は、トランザクションのロールバック、新たなトランザクションの作成、メッセージの再読み込みが行われます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-191">In this case, the transaction is rolled back, a new transaction is created, and the message is reread from the queue.</span></span> <span data-ttu-id="4c3fd-192">ただし、2 回目の試行で成功するかどうかはわかりません。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-192">A second attempt may succeed or fail.</span></span> <span data-ttu-id="4c3fd-193">エラーの原因によっては、メッセージをアプリケーションに配信する処理が繰り返し失敗することがあります。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-193">In some cases, depending on the cause of the error, the message may repeatedly fail delivery to the application.</span></span> <span data-ttu-id="4c3fd-194">このようなメッセージは "有害" であると見なされ、</span><span class="sxs-lookup"><span data-stu-id="4c3fd-194">In this case, the message is deemed as "poison."</span></span> <span data-ttu-id="4c3fd-195">有害メッセージ キューに移されます。このキューの内容は、有害メッセージを処理するアプリケーションに渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-195">Such messages are moved to a poison queue that can be read by a poison-handling application.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4c3fd-196">関連項目</span><span class="sxs-lookup"><span data-stu-id="4c3fd-196">See Also</span></span>  
 [<span data-ttu-id="4c3fd-197">WCF でのキュー</span><span class="sxs-lookup"><span data-stu-id="4c3fd-197">Queuing in WCF</span></span>](../../../../docs/framework/wcf/feature-details/queuing-in-wcf.md)  
 [<span data-ttu-id="4c3fd-198">WCF でのキュー</span><span class="sxs-lookup"><span data-stu-id="4c3fd-198">Queuing in WCF</span></span>](../../../../docs/framework/wcf/feature-details/queuing-in-wcf.md)  
 [<span data-ttu-id="4c3fd-199">セッションおよびキュー</span><span class="sxs-lookup"><span data-stu-id="4c3fd-199">Sessions and Queues</span></span>](../../../../docs/framework/wcf/samples/sessions-and-queues.md)  
 [<span data-ttu-id="4c3fd-200">配信不能キュー</span><span class="sxs-lookup"><span data-stu-id="4c3fd-200">Dead Letter Queues</span></span>](../../../../docs/framework/wcf/samples/dead-letter-queues.md)  
 [<span data-ttu-id="4c3fd-201">揮発性キューによる通信</span><span class="sxs-lookup"><span data-stu-id="4c3fd-201">Volatile Queued Communication</span></span>](../../../../docs/framework/wcf/samples/volatile-queued-communication.md)  
 [<span data-ttu-id="4c3fd-202">メッセージ キューへの Windows Communication Foundation</span><span class="sxs-lookup"><span data-stu-id="4c3fd-202">Windows Communication Foundation to Message Queuing</span></span>](../../../../docs/framework/wcf/samples/wcf-to-message-queuing.md)  
 [<span data-ttu-id="4c3fd-203">メッセージ キュー (MSMQ) をインストールします。</span><span class="sxs-lookup"><span data-stu-id="4c3fd-203">Installing Message Queuing (MSMQ)</span></span>](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md)  
 [<span data-ttu-id="4c3fd-204">メッセージ キュー統合バインディングのサンプル</span><span class="sxs-lookup"><span data-stu-id="4c3fd-204">Message Queuing Integration Binding Samples</span></span>](http://msdn.microsoft.com/en-us/997d11cb-f2c5-4ba0-9209-92843d4d0e1a)  
 [<span data-ttu-id="4c3fd-205">Windows Communication foundation キュー メッセージ</span><span class="sxs-lookup"><span data-stu-id="4c3fd-205">Message Queuing to Windows Communication Foundation</span></span>](../../../../docs/framework/wcf/samples/message-queuing-to-wcf.md)  
 [<span data-ttu-id="4c3fd-206">メッセージ キューを介したメッセージ セキュリティ</span><span class="sxs-lookup"><span data-stu-id="4c3fd-206">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)
