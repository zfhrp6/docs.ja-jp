---
title: キューに置かれたメッセージングのトラブルシューティング
ms.date: 03/30/2017
ms.assetid: a5f2836f-018d-42f5-a571-1e97e64ea5b0
ms.openlocfilehash: 45a3bf82662fcc01b732428d1ca351e4ae8ddca0
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/04/2018
ms.locfileid: "33509126"
---
# <a name="troubleshooting-queued-messaging"></a><span data-ttu-id="7ddf6-102">キューに置かれたメッセージングのトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="7ddf6-102">Troubleshooting Queued Messaging</span></span>
<span data-ttu-id="7ddf6-103">このセクションには、一般的な質問とトラブルシューティングの Windows Communication Foundation (WCF) でキューを使用するためのヘルプが含まれています。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-103">This section contains common questions and troubleshooting help for using queues in Windows Communication Foundation (WCF).</span></span>  
  
## <a name="common-questions"></a><span data-ttu-id="7ddf6-104">一般的な質問</span><span class="sxs-lookup"><span data-stu-id="7ddf6-104">Common Questions</span></span>  
 <span data-ttu-id="7ddf6-105">**Q:** WCF Beta 1 を使用して、MSMQ の修正プログラムをインストールします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-105">**Q:** I used WCF Beta 1 and I installed the MSMQ hotfix.</span></span> <span data-ttu-id="7ddf6-106">この修正プログラムを削除する必要がありますか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-106">Do I need to remove the hotfix?</span></span>  
  
 <span data-ttu-id="7ddf6-107">**A:** できます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-107">**A:** Yes.</span></span> <span data-ttu-id="7ddf6-108">この修正プログラムのサポートは終了しています。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-108">This hotfix is no longer supported.</span></span> <span data-ttu-id="7ddf6-109">WCF になりました MSMQ に、修正プログラムは不要です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-109">WCF now works on MSMQ without a hotfix requirement.</span></span>  
  
 <span data-ttu-id="7ddf6-110">**Q:** MSMQ 用の 2 つのバインディングがある:<xref:System.ServiceModel.NetMsmqBinding>と<xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-110">**Q:** There are two bindings for MSMQ: <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span></span> <span data-ttu-id="7ddf6-111">それぞれの用途を教えてください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-111">What should I use and when?</span></span>  
  
 <span data-ttu-id="7ddf6-112">**A:** を使用して、<xref:System.ServiceModel.NetMsmqBinding>の 2 つの WCF アプリケーション間でキューに置かれた通信をトランスポートとして MSMQ を使用する場合。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-112">**A:** Use the <xref:System.ServiceModel.NetMsmqBinding> when you want to use MSMQ as a transport for queued communication between two WCF applications.</span></span> <span data-ttu-id="7ddf6-113">使用して、<xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>既存の MSMQ アプリケーションを使用して、新しい WCF アプリケーションと通信する場合。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-113">Use the <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> when you want to use existing MSMQ applications to communicate with new WCF applications.</span></span>  
  
 <span data-ttu-id="7ddf6-114">**Q:** を使用するように MSMQ をアップグレードする必要は、<xref:System.ServiceModel.NetMsmqBinding>と`MsmqIntegration`バインドしますか?</span><span class="sxs-lookup"><span data-stu-id="7ddf6-114">**Q:** Do I have to upgrade MSMQ to use the <xref:System.ServiceModel.NetMsmqBinding> and `MsmqIntegration` bindings?</span></span>  
  
 <span data-ttu-id="7ddf6-115">**A:** いいえ。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-115">**A:** No.</span></span> <span data-ttu-id="7ddf6-116">これらは共に [!INCLUDE[wxp](../../../../includes/wxp-md.md)] および [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)] 上の MSMQ 3.0 で使用できます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-116">Both bindings work with MSMQ 3.0 on [!INCLUDE[wxp](../../../../includes/wxp-md.md)] and [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)].</span></span> <span data-ttu-id="7ddf6-117">[!INCLUDE[wv](../../../../includes/wv-md.md)] で MSMQ 4.0 にアップグレードすると、バインディングの特定の機能が使用可能になります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-117">Certain features of the bindings become available when you upgrade to MSMQ 4.0 in [!INCLUDE[wv](../../../../includes/wv-md.md)].</span></span>  
  
 <span data-ttu-id="7ddf6-118">**Q:** のどの機能、<xref:System.ServiceModel.NetMsmqBinding>と<xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>バインドが MSMQ 4.0 ではなく MSMQ 3.0 で使用可能ですか?</span><span class="sxs-lookup"><span data-stu-id="7ddf6-118">**Q:** What features of the <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> bindings are available in MSMQ 4.0 but not in MSMQ 3.0?</span></span>  
  
 <span data-ttu-id="7ddf6-119">**A:** 次の機能は、MSMQ 4.0 ではなく MSMQ 3.0 で使用します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-119">**A:** The following features are available in MSMQ 4.0 but not in MSMQ 3.0:</span></span>  
  
-   <span data-ttu-id="7ddf6-120">カスタム配信不能キューは、MSMQ 4.0 でのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-120">Custom dead-letter queue is supported only on MSMQ 4.0.</span></span>  
  
-   <span data-ttu-id="7ddf6-121">MSMQ 3.0 と 4.0 では、有害メッセージの処理方法が異なります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-121">MSMQ 3.0 and 4.0 handle poison messages differently.</span></span>  
  
-   <span data-ttu-id="7ddf6-122">MSMQ 4.0 のみが、リモート トランザクション読み取りをサポートします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-122">Only MSMQ 4.0 supports remote transacted read.</span></span>  
  
 <span data-ttu-id="7ddf6-123">詳細については、次を参照してください。 [Windows Vista、Windows Server 2003、および Windows XP におけるキューの機能の相違点](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md)です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-123">For more information, see [Differences in Queuing Features in Windows Vista, Windows Server 2003, and Windows XP](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md).</span></span>  
  
 <span data-ttu-id="7ddf6-124">**Q:** 相手側のキューに置かれた通信および MSMQ 4.0 の一方の側で MSMQ 3.0 を使用できますか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-124">**Q:** Can I use MSMQ 3.0 on one side of a queued communication and MSMQ 4.0 on the other side?</span></span>  
  
 <span data-ttu-id="7ddf6-125">**A:** できます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-125">**A:** Yes.</span></span>  
  
 <span data-ttu-id="7ddf6-126">**Q:** 新しい WCF クライアントまたはサーバーと既存の MSMQ アプリケーションを統合します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-126">**Q:** I want to integrate existing MSMQ applications with new WCF clients or servers.</span></span> <span data-ttu-id="7ddf6-127">使用している MSMQ インフラストラクチャの両方の側をアップグレードする必要がありますか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-127">Do I need to upgrade both sides of my MSMQ infrastructure?</span></span>  
  
 <span data-ttu-id="7ddf6-128">**A:** いいえ。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-128">**A:** No.</span></span> <span data-ttu-id="7ddf6-129">どちら側も MSMQ 4.0 にアップグレードする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-129">You do not have to upgrade to MSMQ 4.0 on either side.</span></span>  
  
## <a name="troubleshooting"></a><span data-ttu-id="7ddf6-130">トラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="7ddf6-130">Troubleshooting</span></span>  
 <span data-ttu-id="7ddf6-131">ここでは、一般的なトラブルシューティングの問題に対する解答を示します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-131">This section contains answers to most common troubleshooting issues.</span></span> <span data-ttu-id="7ddf6-132">既知の制限である一部の問題は、リリース ノートにも記載されています。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-132">Some issues that are known limitations are also described in the release notes.</span></span>  
  
 <span data-ttu-id="7ddf6-133">**Q:** プライベート キューを使用して、次の例外を取得します。 `System.InvalidOperationException`: URL が無効です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-133">**Q:** I am trying to use a private queue and I get the following exception: `System.InvalidOperationException`: The URL is invalid.</span></span> <span data-ttu-id="7ddf6-134">キューの URL に '$' 文字を使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-134">The URL for the queue cannot contain the '$' character.</span></span> <span data-ttu-id="7ddf6-135">net.msmq://machine/private/queueName の構文を使用して、プライベート キューをアドレス指定してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-135">Use the syntax in net.msmq://machine/private/queueName to address a private queue.</span></span>  
  
 <span data-ttu-id="7ddf6-136">**A:** 構成またはコードでキュー (Uniform Resource Identifier) を確認してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-136">**A:** Please check the queue Uniform Resource Identifier (URI) in your configuration and code.</span></span> <span data-ttu-id="7ddf6-137">URI では、"$" 文字を使用できません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-137">Do not use the "$" character in the URI.</span></span> <span data-ttu-id="7ddf6-138">たとえば、OrdersQueue という名前のプライベート キューのアドレスを指定する場合は、URI を net.msmq://localhost/private/ordersQueue と指定してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-138">For example, to address a private queue named OrdersQueue, specify the URI as net.msmq://localhost/private/ordersQueue.</span></span>  
  
 <span data-ttu-id="7ddf6-139">**Q:** 呼び出す`ServiceHost.Open()`キューに置かれたアプリケーションで、次の例外をスローします。 `System.ArgumentException`: ベース アドレスに URI クエリ文字列を含めることはできません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-139">**Q:** Calling `ServiceHost.Open()` on my queued application throws the following exception: `System.ArgumentException`: A base address cannot contain a URI query string.</span></span> <span data-ttu-id="7ddf6-140">なぜでしょうか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-140">Why?</span></span>  
  
 <span data-ttu-id="7ddf6-141">**A:** URI の構成ファイルと、コードでキューを確認します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-141">**A:** Check the queue URI in your configuration file and in your code.</span></span> <span data-ttu-id="7ddf6-142">MSMQ のキューでは '?' 文字の使用がサポートされていますが、URI はこれを文字列クエリの開始と解釈します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-142">While MSMQ queues support the use of the '?' character, URIs interpret this character as the beginning of a string query.</span></span> <span data-ttu-id="7ddf6-143">この問題を回避するには、'?' 文字を含まないキュー名を使用してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-143">To avoid this issue, use queue names that do not contain '?' characters.</span></span>  
  
 <span data-ttu-id="7ddf6-144">**Q:** 送信が成功しましたが、受信者側でサービス操作が呼び出されません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-144">**Q:** My send succeeded but no service operation is invoked on the receiver.</span></span> <span data-ttu-id="7ddf6-145">なぜでしょうか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-145">Why?</span></span>  
  
 <span data-ttu-id="7ddf6-146">**A:** への回答を決定するには、次のチェック ボックスの一覧から作業します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-146">**A:** To determine the answer, work through the following check list:</span></span>  
  
-   <span data-ttu-id="7ddf6-147">トランザクション キューの要件と指定済みの保証が適合することを確認します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-147">Check that the transactional queue requirements are compatible with the assurances specified.</span></span> <span data-ttu-id="7ddf6-148">次の原則に注意してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-148">Note the following principles:</span></span>  
  
    -   <span data-ttu-id="7ddf6-149">メッセージを送信できます持続性のある (データグラムとセッション) に「1 回限り」保証 (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`)、トランザクション キューだけにします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-149">You can send durable messages (datagrams and sessions) with "exactly once" assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) only to a transactional queue.</span></span>  
  
    -   <span data-ttu-id="7ddf6-150">"1 回限りの" 配信の保証付きのセッションのみを送信できます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-150">You can send sessions only with "exactly once" assurances.</span></span>  
  
    -   <span data-ttu-id="7ddf6-151">セッションでトランザクション キューからメッセージを受け取るには、1 つのトランザクションが必要です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-151">A transaction is required to receive messages in a session from a transactional queue.</span></span>  
  
    -   <span data-ttu-id="7ddf6-152">保証なしの揮発性または持続性のメッセージ (ダイアグラムのみ) を送受信する (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`)、非トランザクション キューにのみです。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-152">You can send or receive volatile or durable messages (datagrams only) with no assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`) only to a non-transactional queue.</span></span>  
  
-   <span data-ttu-id="7ddf6-153">配信不能キューを確認します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-153">Check the dead-letter queue.</span></span> <span data-ttu-id="7ddf6-154">このキューにメッセージが置かれている場合は、メッセージが配信されなかった理由を特定してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-154">If you find the messages there, determine why they were not delivered.</span></span>  
  
-   <span data-ttu-id="7ddf6-155">送信キューを確認して、接続性またはアドレス指定の問題を特定します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-155">Check the outgoing queues for connectivity or addressing problems.</span></span>  
  
 <span data-ttu-id="7ddf6-156">**Q:** カスタムの配信不能キューを指定したが、送信側のアプリケーションを起動したとき、いずれかの配信不能キューが含まれていない例外を取得または送信元アプリケーションに、配信不能キューへのアクセス許可がありません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-156">**Q:** I have specified a custom dead-letter queue, but when I start the sender application, I get an exception that either the dead-letter queue is not found, or the sending application has no permission to the dead-letter queue.</span></span> <span data-ttu-id="7ddf6-157">なぜ、こうなるのでしょうか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-157">Why is this happening?</span></span>  
  
 <span data-ttu-id="7ddf6-158">**A:** カスタム配信不能キューの URI は、たとえば、net.msmq://localhost/private/myAppdead-letter queue の最初のセグメントに"localhost"またはコンピューター名を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-158">**A:** The custom dead-letter queue URI must include a "localhost" or the computer name in the first segment, for example, net.msmq://localhost/private/myAppdead-letter queue.</span></span>  
  
 <span data-ttu-id="7ddf6-159">**Q:** 常にする必要があるカスタムの配信不能キューを定義または既定の配信不能キューではありますか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-159">**Q:** Is it always necessary to define a custom dead-letter queue, or is there a default dead-letter queue?</span></span>  
  
 <span data-ttu-id="7ddf6-160">**A:** 保証が「1 回限り」の場合 (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`)、およびカスタム配信不能キューを指定しないと、既定値がシステム全体のトランザクション配信不能キュー。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-160">**A:** If assurances are "exactly once" (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`), and if you do not specify a custom dead-letter queue, the default is a system-wide transactional dead-letter queue.</span></span>  
  
 <span data-ttu-id="7ddf6-161">保証がない場合 (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`)、既定値には、配信不能キューの機能は不要です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-161">If assurances are none (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`), then the default is no dead-letter queue functionality.</span></span>  
  
 <span data-ttu-id="7ddf6-162">**Q:** メッセージ SvcHost.Open で「EndpointListener 要件満たすことができません ListenerFactory」サービスがスローされます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-162">**Q:** My service throws on SvcHost.Open with a message "EndpointListener requirements cannot be met by the ListenerFactory".</span></span> <span data-ttu-id="7ddf6-163">なぜでしょうか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-163">Why?</span></span>  
  
 <span data-ttu-id="7ddf6-164">A: </span><span class="sxs-lookup"><span data-stu-id="7ddf6-164">A.</span></span> <span data-ttu-id="7ddf6-165">サービス コントラクトを確認してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-165">Check your service contract.</span></span> <span data-ttu-id="7ddf6-166">配置を忘れた"IsOneWay =`true`"すべてのサービス操作にします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-166">You may have forgotten to put "IsOneWay=`true`" on all the service operations.</span></span> <span data-ttu-id="7ddf6-167">キューは、一方向のサービス操作しかサポートしません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-167">Queues support only one-way service operations.</span></span>  
  
 <span data-ttu-id="7ddf6-168">**Q:** キューにメッセージがあるが、サービス操作が呼び出されません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-168">**Q:** There are messages in the queue but no service operation is invoked.</span></span> <span data-ttu-id="7ddf6-169">何が問題なのでしょうか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-169">What is the problem?</span></span>  
  
 <span data-ttu-id="7ddf6-170">**A:** サービス ホストに障害があるかを判断します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-170">**A:** Determine if your service host is faulted.</span></span> <span data-ttu-id="7ddf6-171">確認するには、トレースを調べるか、`IErrorHandler` を実装します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-171">You can check by looking at the trace or implementing `IErrorHandler`.</span></span> <span data-ttu-id="7ddf6-172">既定では、有害メッセージが検出された場合、サービス ホストはエラーになります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-172">Service host faults, by default, if a poison message is detected.</span></span>  
  
 <span data-ttu-id="7ddf6-173">**Q:** キューにメッセージがあるが、Web ホストのキューに置かれたサービスがアクティブになりません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-173">**Q:** There are messages in the queue but my Web-hosted queued service is not getting activated.</span></span> <span data-ttu-id="7ddf6-174">なぜでしょうか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-174">Why?</span></span>  
  
 <span data-ttu-id="7ddf6-175">**A:** 最も一般的な理由はアクセス許可。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-175">**A:** The most common reason is permissions.</span></span>  
  
1.  <span data-ttu-id="7ddf6-176">`NetMsmqActivator` プロセスが実行され、そのキューで、`NetMsmqActivator` の ID に読み取りおよびシーク アクセス許可が割り当てられていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-176">Ensure that the `NetMsmqActivator` process is running and the identity of the `NetMsmqActivator` process is given read and seek permission on the queue.</span></span>  
  
2.  <span data-ttu-id="7ddf6-177">`NetMsmqActivator` がリモート コンピューター上のキューを監視している場合は、`NetMsmqActivator` が制限付きトークンの下で実行されていないことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-177">If the `NetMsmqActivator` is monitoring queues on a remote machine, ensure that `NetMsmqActivator` does not run under a restricted token.</span></span> <span data-ttu-id="7ddf6-178">無制限のトークンを使用して `NetMsmqActivator` を実行するには、以下を実行します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-178">To run the `NetMsmqActivator` with an unrestricted token:</span></span>  
  
    ```  
    sc sidtype NetMsmqActivator unrestricted  
    ```  
  
 <span data-ttu-id="7ddf6-179">関連する Web ホストの問題のないセキュリティを参照してください:[キューに置かれたアプリケーションをホストしている Web](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-179">For non-security related Web host issues refer to: [Web Hosting a Queued Application](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md).</span></span>  
  
 <span data-ttu-id="7ddf6-180">**Q:** access セッションに最も簡単な方法は何ですか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-180">**Q:** What is the easiest way to access sessions?</span></span>  
  
 <span data-ttu-id="7ddf6-181">**A:** オートコンプリートの設定 =`true`の最後に対応した操作には、セッションで、メッセージし、オートコンプリートの設定 =`false`残りのすべてのサービス操作にします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-181">**A:** Set AutoComplete=`true` on the operation that corresponds to the last message in the session, and set AutoComplete=`false` on all remaining service operations.</span></span>  
  
 <span data-ttu-id="7ddf6-182">**Q:** MSMQ によく寄せられる質問に対する回答を見つける場所ですか?</span><span class="sxs-lookup"><span data-stu-id="7ddf6-182">**Q:** Where can I find answers to common questions on MSMQ?</span></span>  
  
 <span data-ttu-id="7ddf6-183">**A:** MSMQ の詳細については、次を参照してください。 [Microsoft メッセージ キュー](http://go.microsoft.com/fwlink/?LinkId=87810)です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-183">**A:** For more information about MSMQ, see [Microsoft Message Queuing](http://go.microsoft.com/fwlink/?LinkId=87810).</span></span>  
  
 <span data-ttu-id="7ddf6-184">**Q:** 理由は、サービスをスロー、`ProtocolException`両方を含むキューからの読み取りがセッション メッセージをキューに登録および使用するデータグラム メッセージをキューに登録しますか?</span><span class="sxs-lookup"><span data-stu-id="7ddf6-184">**Q:** Why does my service throw a `ProtocolException` when reading from a queue that contains both queued session messages and queued datagram messages?</span></span>  
  
 <span data-ttu-id="7ddf6-185">**A:** までキューに置かれたセッションのメッセージでの基本的な違いがあるし、キューに置かれた使用するデータグラム メッセージを構成します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-185">**A:** There is a fundamental difference in the way queued session messages and queued datagram messages are composed.</span></span> <span data-ttu-id="7ddf6-186">このため、キューを使用するセッション メッセージを読み取ろうとするサービスは、キューを使用するデータグラム メッセージを受信できず、キューを使用するデータグラム メッセージを読み取ろうとするサービスは、セッション メッセージを受信できません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-186">Because of this, a service that is expecting to read a queued session message cannot receive a queued datagram message and a service expecting to read a queued datagram message cannot receive a session message.</span></span> <span data-ttu-id="7ddf6-187">これら両方の種類のメッセージを同じキューから読み取ろうとすると、次の例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-187">Attempting to read both types of messages from the same queue throws the following exception:</span></span>  
  
```  
System.ServiceModel.MsmqPoisonMessageException: The transport channel detected a poison message. This occurred because the message exceeded the maximum number of delivery attempts or because the channel detected a fundamental problem with the message. The inner exception may contain additional information.   
---> System.ServiceModel.ProtocolException: An incoming MSMQ message contained invalid or unexpected .NET Message Framing information in its body. The message cannot be received. Ensure that the sender is using a compatible service contract with a matching SessionMode.  
```  
  
 <span data-ttu-id="7ddf6-188">アプリケーションが同じコンピューターからキューを使用するセッション メッセージとキューを使用するデータグラム メッセージの両方を送信する場合は、任意のカスタム配信不能キューだけでなくシステム配信不能キューで特にこの問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-188">The system dead-letter queue, as well as any custom dead-letter queue, is particularly susceptible to this issue if an application sends both queued session messages and queued datagram messages from the same computer.</span></span> <span data-ttu-id="7ddf6-189">メッセージを正常に送信できない場合、メッセージは配信不能キューに移されます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-189">If a message cannot be sent successfully, it is moved to the dead-letter queue.</span></span> <span data-ttu-id="7ddf6-190">このような場合は、セッション メッセージとデータグラム メッセージの両方が配信不能キューに置かれる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-190">Under these circumstances, it is possible to have both session and datagram messages in the dead-letter queue.</span></span> <span data-ttu-id="7ddf6-191">実行時にキューから読み取るときに両方の種類のメッセージを分離することはできません。そのため、アプリケーションでは、キューを使用するセッション メッセージとキューを使用するデータグラム メッセージの両方を同じコンピューターから送信しないでください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-191">There is no way to separate both types of messages at runtime when reading from a queue, therefore, applications should not send both queued session messages and queued datagram messages from the same computer.</span></span>  
  
### <a name="msmq-integration-specific-troubleshooting"></a><span data-ttu-id="7ddf6-192">MSMQ 統合 : 固有のトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="7ddf6-192">MSMQ Integration: Specific Troubleshooting</span></span>  
 <span data-ttu-id="7ddf6-193">**Q:** メッセージを送信するとき、またはサービス ホストを開くときに、スキームが間違っているかを示すエラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-193">**Q:** When I send a message, or when I open the service host, I get an error that indicates the scheme is wrong.</span></span> <span data-ttu-id="7ddf6-194">なぜでしょうか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-194">Why?</span></span>  
  
 <span data-ttu-id="7ddf6-195">**A:** MSMQ 統合バインディングを使用する場合は、msmq.formatname スキームを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-195">**A:** When you use the MSMQ integration binding, you must use the msmq.formatname scheme.</span></span> <span data-ttu-id="7ddf6-196">たとえば、msmq.formatname:DIRECT=OS:.\private$\OrdersQueue などです。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-196">For example, msmq.formatname:DIRECT=OS:.\private$\OrdersQueue.</span></span> <span data-ttu-id="7ddf6-197">ただし、カスタム配信不能キューを指定するときは、net.msmq スキームを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-197">But when you specify the custom dead-letter queue, you must use the net.msmq scheme.</span></span>  
  
 <span data-ttu-id="7ddf6-198">**Q:** public または private 形式名を使用し、上のサービス ホストを開いてすればとき[!INCLUDE[wv](../../../../includes/wv-md.md)]、エラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-198">**Q:** When I use a public or private format name and open the service host on [!INCLUDE[wv](../../../../includes/wv-md.md)], I get an error.</span></span> <span data-ttu-id="7ddf6-199">なぜでしょうか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-199">Why?</span></span>  
  
 <span data-ttu-id="7ddf6-200">**A:** で WCF 統合チャネル[!INCLUDE[wv](../../../../includes/wv-md.md)]サブキュー有害なメッセージを処理するため、アプリケーションのメイン キューを開くことができるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-200">**A:** The WCF integration channel on [!INCLUDE[wv](../../../../includes/wv-md.md)] checks to see if a sub-queue can be opened for the main application queue for handling poison messages.</span></span> <span data-ttu-id="7ddf6-201">サブキューの名前は、リスナーに渡される msmq.formatname URI から派生します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-201">The sub-queue name is derived from an msmq.formatname URI passed to the listener.</span></span> <span data-ttu-id="7ddf6-202">MSMQ でのサブキュー名は、直接形式名に限定されます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-202">The sub-queue name in MSMQ can only be a direct format name.</span></span> <span data-ttu-id="7ddf6-203">そのためにエラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-203">So you see the error.</span></span> <span data-ttu-id="7ddf6-204">キュー URI を直接形式名に変更してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-204">Change the queue URI to a direct format name.</span></span>  
  
 <span data-ttu-id="7ddf6-205">**Q:** MSMQ アプリケーションからメッセージを受信するときに、メッセージがキューに置かれ、は、受信側の WCF アプリケーションで読み取ることができません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-205">**Q:** When receiving a message from an MSMQ application, the message sits in the queue and is not read by the receiving WCF application.</span></span> <span data-ttu-id="7ddf6-206">なぜでしょうか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-206">Why?</span></span>  
  
 <span data-ttu-id="7ddf6-207">**A:** メッセージ本文が含まれるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-207">**A:** Check to see whether the message has a body.</span></span> <span data-ttu-id="7ddf6-208">メッセージに本文がない場合、MSMQ 統合チャネルはメッセージを無視します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-208">If the message has no body, the MSMQ integration channel ignores the message.</span></span> <span data-ttu-id="7ddf6-209">例外を通知する `IErrorHandler` を実装し、トレースを確認してください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-209">Implement `IErrorHandler` to be notified of exceptions and check the traces.</span></span>  
  
### <a name="security-related-troubleshooting"></a><span data-ttu-id="7ddf6-210">セキュリティ関連のトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="7ddf6-210">Security-Related Troubleshooting</span></span>  
 <span data-ttu-id="7ddf6-211">**Q:** メッセージが送信されたようですが、受信側で受信されませんワークグループ モードで、既定のバインディングを使用するサンプルを実行するとします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-211">**Q:** When I run the sample that uses a default binding in workgroup mode, messages seem to get sent but are never received by the receiver.</span></span>  
  
 <span data-ttu-id="7ddf6-212">**A:** を Active Directory ディレクトリ サービスを必要とする MSMQ 内部の証明書を使用して既定では、メッセージは署名されます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-212">**A:** By default, messages are signed using an MSMQ internal certificate that requires the Active Directory directory service.</span></span> <span data-ttu-id="7ddf6-213">ワークグループ モードでは、Active Directory が使用できないため、メッセージに署名できません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-213">In workgroup mode, because Active Directory is not available, signing the message fails.</span></span> <span data-ttu-id="7ddf6-214">したがって、メッセージが配信不能キューに入るれ、「署名が正しくありません」などの障害の原因が示されます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-214">So the message lands in the dead-letter queue and failure cause, such as "Bad signature", is indicated.</span></span>  
  
 <span data-ttu-id="7ddf6-215">この問題を回避するには、セキュリティを無効にします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-215">The workaround is to turn off security.</span></span> <span data-ttu-id="7ddf6-216">これは、設定で<xref:System.ServiceModel.NetMsmqSecurity.Mode%2A>  =  <xref:System.ServiceModel.NetMsmqSecurityMode.None>ワークグループ モードで動作させるのにします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-216">This is done by setting <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A> = <xref:System.ServiceModel.NetMsmqSecurityMode.None> to make it work in workgroup mode.</span></span>  
  
 <span data-ttu-id="7ddf6-217">また、<xref:System.ServiceModel.MsmqTransportSecurity> プロパティから <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> を取得し、それを <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> に設定して、クライアント証明書を設定する方法もあります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-217">Another workaround is to get the <xref:System.ServiceModel.MsmqTransportSecurity> from the <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> property and set it to <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>, and set the client certificate.</span></span>  
  
 <span data-ttu-id="7ddf6-218">さらに、MSMQ と Active Directory 統合をインストールして回避することもできます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-218">Yet another workaround is to install MSMQ with Active Directory integration.</span></span>  
  
 <span data-ttu-id="7ddf6-219">**Q:** 既定のバインディングでメッセージを送信するときに (トランスポート セキュリティが有効)「内部証明書が見つかりません」メッセージが表示されるキューを Active Directory でします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-219">**Q:** When I send a message with default binding (transport security turned on) in Active Directory to a queue, I get an "internal certificate not found" message.</span></span> <span data-ttu-id="7ddf6-220">これを修復する方法を教えてください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-220">How do I fix this?</span></span>  
  
 <span data-ttu-id="7ddf6-221">**A:** つまり、送信者の Active Directory で証明書を更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-221">**A:** This means that the certificate in Active Directory for the sender must be renewed.</span></span> <span data-ttu-id="7ddf6-222">これを行うには、開く**コントロール パネルの **、**管理ツール**、**コンピューターの管理**を右クリックして**MSMQ**を選択し、**プロパティ**です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-222">To do so, open **Control Panel**, **Administrative Tools**, **Computer Management**, right-click **MSMQ**, and select **Properties**.</span></span> <span data-ttu-id="7ddf6-223">選択、**ユーザー証明書** タブでをクリックし、**書き換え**ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-223">Select the **User Certificate** tab and click the **Renew** button.</span></span>  
  
 <span data-ttu-id="7ddf6-224">**Q:** を使用して、メッセージ送信時に<xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>使用する証明書を指定して、「無効な証明書」メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-224">**Q:** When I send a message using <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> and specify the certificate to use, I get an "Invalid certificate" message.</span></span> <span data-ttu-id="7ddf6-225">これを修復する方法を教えてください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-225">How do I fix this?</span></span>  
  
 <span data-ttu-id="7ddf6-226">**A:** 証明書のモードでローカル コンピューターの証明書ストアを使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-226">**A:** You cannot use a local machine certificate store with certificate mode.</span></span> <span data-ttu-id="7ddf6-227">証明書スナップインを使用して、コンピューターの証明書ストアから現在のユーザー ストアに証明書をコピーする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-227">You have to copy the certificate from the machine certificate store to the current user store using the Certificate snap-in.</span></span> <span data-ttu-id="7ddf6-228">証明書スナップインを開くには、以下を実行します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-228">To get the Certificate snap-in:</span></span>  
  
1.  <span data-ttu-id="7ddf6-229">をクリックして**開始**を選択**実行**、型`mmc`、 をクリック**OK**です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-229">Click **Start**, select **Run**, type `mmc`, and click **OK**.</span></span>  
  
2.  <span data-ttu-id="7ddf6-230">**Microsoft 管理コンソール**を開き、**ファイル**メニュー**スナップインの追加と削除**です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-230">In the **Microsoft Management Console**, open the **File** menu and select **Add/Remove Snap-in**.</span></span>  
  
3.  <span data-ttu-id="7ddf6-231">**スナップインの追加と削除**ダイアログ ボックスで、をクリックして、**追加**ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-231">In the **Add/Remove Snap-in** dialog box, click the **Add** button.</span></span>  
  
4.  <span data-ttu-id="7ddf6-232">**スタンドアロン スナップインの追加** ダイアログ ボックス、選択の証明書およびクリック**追加**です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-232">In the **Add Standalone Snap-in** dialog box, select Certificates and click **Add**.</span></span>  
  
5.  <span data-ttu-id="7ddf6-233">**証明書**スナップイン ダイアログ ボックスで、 **ユーザー アカウント** をクリック**完了**です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-233">In the **Certificates** snap-in dialog box, select **My user account,** and click **Finish**.</span></span>  
  
6.  <span data-ttu-id="7ddf6-234">スナップインで、前の手順を使用して、2 番目の証明書が、今回の選択を次に、追加**コンピューター アカウント** をクリック**次**です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-234">Next, add a second Certificates snap-in using the previous steps, but this time select **Computer account** and click **Next**.</span></span>  
  
7.  <span data-ttu-id="7ddf6-235">選択**ローカル コンピューター**  をクリック**完了**です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-235">Select **Local Computer** and click **Finish**.</span></span> <span data-ttu-id="7ddf6-236">これで、コンピューターの証明書ストアから現在のユーザー ストアに証明書をドラッグ アンド ドロップできます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-236">You can now drag and drop certificates from the machine certificate store to the current user store.</span></span>  
  
 <span data-ttu-id="7ddf6-237">**Q:** ときに、サービス、キューから読み取るワークグループ モードで別のコンピューターに"access denied"例外を取得します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-237">**Q:** When my service reads from a queue on another computer in workgroup mode, I get an "access denied" exception.</span></span>  
  
 <span data-ttu-id="7ddf6-238">**A:** リモート アプリケーション キューにアクセスするために、ワークグループ モードでアプリケーションのキューへのアクセス権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-238">**A:** In workgroup mode, for a remote application to gain access to the queue, the application must have permission to access the queue.</span></span> <span data-ttu-id="7ddf6-239">キューのアクセス制御リスト (ACL) に「匿名ログイン」を追加し、読み取りアクセス許可を付けます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-239">Add "Anonymous login" to the queue's access control list (ACL) and give it read permission.</span></span>  
  
 <span data-ttu-id="7ddf6-240">**Q:** ネットワーク サービス クライアント (またはドメイン アカウントを持たない任意のクライアント) は、キューに置かれたメッセージを送信するとき、送信が無効な証明書で失敗します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-240">**Q:** When a network service client (or any client that does not have a domain account) sends a queued message, the send fails with an invalid certificate.</span></span> <span data-ttu-id="7ddf6-241">これを修復する方法を教えてください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-241">How do I fix this?</span></span>  
  
 <span data-ttu-id="7ddf6-242">**A:** バインディング構成を確認します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-242">**A:** Check the binding configuration.</span></span> <span data-ttu-id="7ddf6-243">既定のバインディングでは、メッセージに署名するために MSMQ トランスポート セキュリティを有効にしています。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-243">The default binding has MSMQ transport security turned on to sign the message.</span></span> <span data-ttu-id="7ddf6-244">これを無効にしてください。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-244">Turn it off.</span></span>  
  
### <a name="remote-transacted-receives"></a><span data-ttu-id="7ddf6-245">リモート トランザクション受信</span><span class="sxs-lookup"><span data-stu-id="7ddf6-245">Remote Transacted Receives</span></span>  
 <span data-ttu-id="7ddf6-246">**Q:** コンピューター A で、キューがあるし、メッセージの B (リモート トランザクション受信シナリオ)、コンピューター上のキューからメッセージを読み取りを WCF サービスがキューから読み取るされません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-246">**Q:** When I have a queue on machine A, and a WCF service that reads messages from a queue on machine B (the remote transacted receive scenario), messages are not read from the queue.</span></span> <span data-ttu-id="7ddf6-247">受信側は、メッセージ「トランザクションをインポートできません」で失敗しました。 トレース情報を示します</span><span class="sxs-lookup"><span data-stu-id="7ddf6-247">Tracing information indicates the receive failed with the message "Transaction cannot be imported."</span></span> <span data-ttu-id="7ddf6-248">これを修正するのには、どうすればよいですか</span><span class="sxs-lookup"><span data-stu-id="7ddf6-248">What can I do to fix this?</span></span>  
  
 <span data-ttu-id="7ddf6-249">**A:** この 3 つの理由が考えられます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-249">**A:** There are three possible reasons for this:</span></span>  
  
-   <span data-ttu-id="7ddf6-250">ドメイン モードの場合、リモート トランザクション受信には、Microsoft 分散トランザクション コーディネーター (MSDTC) ネットワーク アクセスが必要です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-250">If you are in domain mode, remote transacted receive requires Microsoft Distributed Transaction Coordinator (MSDTC) network access.</span></span> <span data-ttu-id="7ddf6-251">有効にできますこれを使用して**コンポーネントの追加/削除**です。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-251">You can enable this using **Add/Remove Components**.</span></span>  
  
     <span data-ttu-id="7ddf6-252">![ネットワーク DTC アクセスを有効にする](../../../../docs/framework/wcf/feature-details/media/applicationserveraddcomps.jpg "ApplicationServerAddComps")</span><span class="sxs-lookup"><span data-stu-id="7ddf6-252">![Enabling network DTC access](../../../../docs/framework/wcf/feature-details/media/applicationserveraddcomps.jpg "ApplicationServerAddComps")</span></span>  
  
-   <span data-ttu-id="7ddf6-253">トランザクション マネージャーと通信するための認証モードを確認します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-253">Check the authentication mode for communicating with the transaction manager.</span></span> <span data-ttu-id="7ddf6-254">ワークグループ モードの場合は、「認証が必要です」を選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-254">If you are in workgroup mode, "No Authentication Required" must be selected.</span></span> <span data-ttu-id="7ddf6-255">ドメイン モードの場合は、「相互認証が必要です」を選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-255">If you are in domain mode, then "Mutual Authentication Required" must be selected.</span></span>  
  
     <span data-ttu-id="7ddf6-256">![XA トランザクションを有効にする](../../../../docs/framework/wcf/feature-details/media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span><span class="sxs-lookup"><span data-stu-id="7ddf6-256">![Enabling XA transactions](../../../../docs/framework/wcf/feature-details/media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span></span>  
  
-   <span data-ttu-id="7ddf6-257">MSDTC が内の例外の一覧であるかどうかを確認、**インターネット接続ファイアウォール**設定します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-257">Make sure that MSDTC is in the list of exceptions in the **Internet Connection Firewall** settings.</span></span>  
  
-   <span data-ttu-id="7ddf6-258">[!INCLUDE[wv](../../../../includes/wv-md.md)] を使用していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-258">Ensure that you are using [!INCLUDE[wv](../../../../includes/wv-md.md)].</span></span> <span data-ttu-id="7ddf6-259">[!INCLUDE[wv](../../../../includes/wv-md.md)] 上の MSMQ は、リモート トランザクション読み取りをサポートします。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-259">MSMQ on [!INCLUDE[wv](../../../../includes/wv-md.md)] supports remote transacted read.</span></span> <span data-ttu-id="7ddf6-260">以前の Windows リリース上の MSMQ は、リモート トランザクション読み取りをサポートしません。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-260">MSMQ on earlier Windows releases does not support remote transacted read.</span></span>  
  
 <span data-ttu-id="7ddf6-261">**Q:** キューから読み取るサービスがネットワーク サービスの場合は、たとえば、Web でホスト、アクセス拒否例外を取得する理由が発生、キューから読み取るときにしますか?</span><span class="sxs-lookup"><span data-stu-id="7ddf6-261">**Q:** When the service reading from the queue is a network service, for example, in a Web host, why do I get an access-denied exception is raised when reading from the queue?</span></span>  
  
 <span data-ttu-id="7ddf6-262">**A:** ネットワーク サービス読み取りアクセスは、キュー、ネットワーク サービスがキューから読み取ることができますを確実に ACL に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-262">**A:** Network service read access must be added to the queue ACL to ensure that a network service can read from the queue.</span></span>  
  
 <span data-ttu-id="7ddf6-263">**Q:** をリモート コンピューター上のキュー内のメッセージに基づくアプリケーションをアクティブ化する、MSMQ アクティブ化サービスを使用できますか。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-263">**Q:** Can I use the MSMQ activation service to activate applications based on messages in a queue on a remote machine?</span></span>  
  
 <span data-ttu-id="7ddf6-264">**A:** できます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-264">**A:** Yes.</span></span> <span data-ttu-id="7ddf6-265">これには、ネットワーク サービスとして動作するように MSMQ アクティベーション サービスを構成し、リモート コンピューター上のキューへのネットワーク サービス アクセスを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-265">To do this, you must configure the MSMQ activation service to run as a network service, and add network service access to the queue on the remote machine.</span></span>  
  
## <a name="using-custom-msmq-bindings-with-receivecontext-enabled"></a><span data-ttu-id="7ddf6-266">ReceiveContext を有効にしたカスタム MSMQ バインディングの使用</span><span class="sxs-lookup"><span data-stu-id="7ddf6-266">Using Custom MSMQ Bindings with ReceiveContext Enabled</span></span>  
 <span data-ttu-id="7ddf6-267"><xref:System.ServiceModel.Channels.ReceiveContext> を有効にしてカスタム MSMQ バインディングを使用すると、ネイティブの MSMQ が非同期の <xref:System.ServiceModel.Channels.ReceiveContext> 受信の I/O 完了をサポートしないために、着信メッセージの処理にスレッド プール内のスレッドが使用されます。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-267">When using a custom MSMQ binding with <xref:System.ServiceModel.Channels.ReceiveContext> enabled processing an incoming message will use a thread pool thread because native MSMQ does not support I/O completion for asynchronous <xref:System.ServiceModel.Channels.ReceiveContext> receives.</span></span> <span data-ttu-id="7ddf6-268">これは、このようなメッセージの処理に <xref:System.ServiceModel.Channels.ReceiveContext> の内部トランザクションが使用され、MSMQ が非同期処理をサポートしないためです。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-268">This is because processing such a message uses internal transactions for <xref:System.ServiceModel.Channels.ReceiveContext> and MSMQ does not support asynchronous processing.</span></span> <span data-ttu-id="7ddf6-269">この問題を回避するには、<xref:System.ServiceModel.Description.SynchronousReceiveBehavior> をエンドポイントに追加して同期処理を強制するか、<xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> を 1 に設定します。</span><span class="sxs-lookup"><span data-stu-id="7ddf6-269">To work around this issue you can add a <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> to the endpoint to force synchronous processing or set <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> to 1.</span></span>
