---
title: Windows サービス アプリケーションのホスト
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f4199998-27f3-4dd9-aee4-0a4addfa9f24
caps.latest.revision: 12
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: c1f0d2336c2682bd525a66c6e5b12ce2d17ad219
ms.sourcegitcommit: 94d33cadc5ff81d2ac389bf5f26422c227832052
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/30/2018
---
# <a name="hosting-in-a-windows-service-application"></a><span data-ttu-id="6f6dd-102">Windows サービス アプリケーションのホスト</span><span class="sxs-lookup"><span data-stu-id="6f6dd-102">Hosting in a Windows Service Application</span></span>
<span data-ttu-id="6f6dd-103">Windows サービス (従来 Windows NT サービスと呼ばれていたもの) が提供するプロセス モデルが特に適しているのは、長い期間にわたって動作し続ける必要があり、どのような形式でもユーザー インターフェイスを表示することのないアプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-103">Windows services (formerly known as Windows NT services) provide a process model particularly suited to applications that must live in a long-running executable and do not display any form of user interface.</span></span> <span data-ttu-id="6f6dd-104">Windows サービス アプリケーションのプロセスの有効期間を管理するのは、サービス コントロール マネージャー (SCM) です。SCM を使用して、Windows サービス アプリケーションを起動、停止、および一時停止できます。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-104">The process lifetime of a Windows service application is managed by the service control manager (SCM), which allows you to start, stop, and pause Windows service applications.</span></span> <span data-ttu-id="6f6dd-105">「常時オン」アプリケーション用の適切なホスティング環境を作成、コンピューターの起動時に自動的に開始する Windows サービスのプロセスを構成することができます。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-105">You can configure a Windows service process to start automatically when the computer starts, making it a suitable hosting environment for "always on" applications.</span></span> <span data-ttu-id="6f6dd-106">Windows サービス アプリケーションの詳細については、次を参照してください。 [Windows サービス アプリケーション](http://go.microsoft.com/fwlink/?LinkId=89450)です。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-106">For more information about Windows service applications, see [Windows Service Applications](http://go.microsoft.com/fwlink/?LinkId=89450).</span></span>  
  
 <span data-ttu-id="6f6dd-107">長い期間にわたって動作し続ける [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] サービスをホストするアプリケーションは、さまざまな点で Windows サービスに似ています。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-107">Applications that host long-running [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] services share many characteristics with Windows services.</span></span> <span data-ttu-id="6f6dd-108">中でも顕著な類似点は、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] サービスは長期間動作し続けるサーバー側実行可能ファイルであり、画面上でユーザーと直接対話することがないので、ユーザー インターフェイスを実装する必要がない、ということです。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-108">In particular, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services are long-running server executables that do not interact directly with the user and therefore do not implement any form of user interface.</span></span> <span data-ttu-id="6f6dd-109">したがって、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] サービスを Windows サービス アプリケーション上でホストするやり方も、頑健で長期間動作し続ける [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] アプリケーションの構築方法として選択肢となります。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-109">As such, hosting [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services inside of a Windows service application is one option for building robust, long-running, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] applications.</span></span>  
  
 <span data-ttu-id="6f6dd-110">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] を開発する際には、多くの場合、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] アプリケーションを Windows サービス上でホストするか、それとも Internet Information Services (IIS) や Windows Process Activation Service (WAS) のホスティング環境を使うか、決定しなければなりません。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-110">Often, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] developers must decide whether to host their [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] application inside of a Windows service application or inside of the Internet Information Services (IIS) or Windows Process Activation Service (WAS) hosting environment.</span></span> <span data-ttu-id="6f6dd-111">次のような場合、Windows サービス上でホストする方法を使用できないか検討してください。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-111">You should consider using Windows service applications under the following conditions:</span></span>  
  
-   <span data-ttu-id="6f6dd-112">アプリケーションを明示的にアクティブ化する必要がある場合。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-112">Your application requires explicit activation.</span></span> <span data-ttu-id="6f6dd-113">たとえば、サーバー起動時に自動的にアプリケーションも起動しなければならず、最初に届いたメッセージに応答して動的に起動するのでは困るような場合です。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-113">For example, you should use Windows services when your application must start automatically when the server starts instead of being dynamically started in response to the first incoming message.</span></span>  
  
-   <span data-ttu-id="6f6dd-114">アプリケーションをホストするプロセスが、起動されたらそのまま動作し続けなければならない場合。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-114">The process that hosts your application must remain running once started.</span></span> <span data-ttu-id="6f6dd-115">一度起動した Windows サービスのプロセスは、サーバー管理者がサービス コントロール マネージャーで明示的にシャットダウンしない限り、そのまま動作し続けます。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-115">Once started, a Windows service process remains running unless explicitly shut down by a server administrator using the service control manager.</span></span> <span data-ttu-id="6f6dd-116">IIS や WAS 上でホストするアプリケーションは、動的に起動および停止して、システム リソースを効率よく使うことができます。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-116">Applications hosted in IIS or WAS may be started and stopped dynamically to make optimal use of system resources.</span></span> <span data-ttu-id="6f6dd-117">しかし、ホストするプロセスの有効期間にわたって明示的に制御しなければならない場合、IIS や WAS ではなく Windows サービスを使う必要があります。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-117">Applications that require explicit control over the lifetime of their hosting process should use Windows services instead of IIS or WAS.</span></span>  
  
-   <span data-ttu-id="6f6dd-118">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] サービスを Windows Server 2003 上で実行する必要があり、HTTP 以外のトランスポート層プロトコルを使う場合。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-118">Your [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service must run on Windows Server 2003 and use transports other than HTTP.</span></span> <span data-ttu-id="6f6dd-119">Windows Server 2003 では、[!INCLUDE[iis601](../../../../includes/iis601-md.md)] ホスティング環境は HTTP 通信しかできないようになっています。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-119">On Windows Server 2003, the [!INCLUDE[iis601](../../../../includes/iis601-md.md)] hosting environment is restricted to HTTP communication only.</span></span> <span data-ttu-id="6f6dd-120">Windows サービス アプリケーションにはこのような制限がなく、net.tcp、net.pipe、net.msmq など、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] が対応しているトランスポート層プロトコルはどれでも使用できます。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-120">Windows service applications are not subject to this restriction and can use any transport [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] supports, including net.tcp, net.pipe, and net.msmq.</span></span>  
  
### <a name="to-host-wcf-inside-of-a-windows-service-application"></a><span data-ttu-id="6f6dd-121">Windows サービス アプリケーションの内部で WCF をホストするには</span><span class="sxs-lookup"><span data-stu-id="6f6dd-121">To host WCF inside of a Windows service application</span></span>  
  
1.  <span data-ttu-id="6f6dd-122">Windows サービス アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-122">Create a Windows service application.</span></span> <span data-ttu-id="6f6dd-123">Windows サービス アプリケーションは、<xref:System.ServiceProcess> 名前空間のクラスを使用して、マネージ コードとして記述することができます。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-123">You can write Windows service applications in managed code using the classes in the <xref:System.ServiceProcess> namespace.</span></span> <span data-ttu-id="6f6dd-124">このアプリケーションには、<xref:System.ServiceProcess.ServiceBase> から派生したクラスを 1 つ含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-124">This application must include one class that inherits from <xref:System.ServiceProcess.ServiceBase>.</span></span>  
  
2.  <span data-ttu-id="6f6dd-125">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] サービスの有効期間を、Windows サービス アプリケーションの有効期間とリンクさせます。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-125">Link the lifetime of the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services to the lifetime of the Windows service application.</span></span> <span data-ttu-id="6f6dd-126">通常、Windows サービス アプリケーションでホストされる [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] サービスは、ホストする側のサービスの起動時にアクティブになり、停止時にメッセージの監視をやめ、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] サービスにエラーが生じた場合はホストする側のプロセスをシャットダウンするようにします。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-126">Typically, you want [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services hosted in a Windows service application to become active when the hosting service starts, stop listening for messages when the hosting service is stopped, and shut down the hosting process when the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service encounters an error.</span></span> <span data-ttu-id="6f6dd-127">これは次のようにして実装します。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-127">This can be accomplished as follows:</span></span>  
  
    -   <span data-ttu-id="6f6dd-128"><xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> をオーバーライドして、<xref:System.ServiceModel.ServiceHost> のインスタンスを必要な個数開くようにします。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-128">Override <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> to open one or more instances of <xref:System.ServiceModel.ServiceHost>.</span></span> <span data-ttu-id="6f6dd-129">単一の Windows サービス アプリケーションで、一体となって開始および終了する複数の [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] サービスをホストできます。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-129">A single Windows service application can host multiple [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services that start and stop as a group.</span></span>  
  
    -   <span data-ttu-id="6f6dd-130"><xref:System.ServiceProcess.ServiceBase.OnStop%2A> をオーバーライドして、<xref:System.ServiceModel.Channels.CommunicationObject.Closed> 時に起動された <xref:System.ServiceModel.ServiceHost> サービスが稼働する [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] の、<xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-130">Override <xref:System.ServiceProcess.ServiceBase.OnStop%2A> to call <xref:System.ServiceModel.Channels.CommunicationObject.Closed> on the <xref:System.ServiceModel.ServiceHost> any running [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services that were started during <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>.</span></span>  
  
    -   <span data-ttu-id="6f6dd-131"><xref:System.ServiceModel.Channels.CommunicationObject.Faulted> の <xref:System.ServiceModel.ServiceHost> イベントを定期受信し、エラー時には、<xref:System.ServiceProcess.ServiceController> クラスを使用して Windows サービス アプリケーションをシャットダウンします。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-131">Subscribe to the <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> event of <xref:System.ServiceModel.ServiceHost> and use the <xref:System.ServiceProcess.ServiceController> class to shut down the Windows service application in case of error.</span></span>  
  
     <span data-ttu-id="6f6dd-132">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] サービスをホストする Windows サービス アプリケーションも、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] を使わない Windows サービス アプリケーションと同様に展開および管理されます。</span><span class="sxs-lookup"><span data-stu-id="6f6dd-132">Windows service applications that host [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services are deployed and managed in the same way as Windows service applications that do not make use of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6f6dd-133">関連項目</span><span class="sxs-lookup"><span data-stu-id="6f6dd-133">See Also</span></span>  
 <xref:System.ServiceProcess>  
 [<span data-ttu-id="6f6dd-134">チュートリアル: コンポーネント デザイナーによる Windows サービス アプリケーションの作成</span><span class="sxs-lookup"><span data-stu-id="6f6dd-134">Walkthrough: Creating a Windows Service Application in the Component Designer</span></span>](http://go.microsoft.com/fwlink/?LinkId=94875)  
 [<span data-ttu-id="6f6dd-135">方法 : マネージ Windows サービスで WCF サービスをホストする</span><span class="sxs-lookup"><span data-stu-id="6f6dd-135">How to: Host a WCF Service in a Managed Windows Service</span></span>](../../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md)  
 [<span data-ttu-id="6f6dd-136">Windows サービス ホスト</span><span class="sxs-lookup"><span data-stu-id="6f6dd-136">Windows Service Host</span></span>](../../../../docs/framework/wcf/samples/windows-service-host.md)  
 [<span data-ttu-id="6f6dd-137">サービス アプリケーションのプログラミング アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="6f6dd-137">Service Application Programming Architecture</span></span>](http://go.microsoft.com/fwlink/?LinkId=94876)  
 [<span data-ttu-id="6f6dd-138">Windows Server App Fabric のホスティング機能</span><span class="sxs-lookup"><span data-stu-id="6f6dd-138">Windows Server App Fabric Hosting Features</span></span>](http://go.microsoft.com/fwlink/?LinkId=201276)
