---
title: "WCF でのキュー"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: e98d76ba-1acf-42cd-b137-0f8214661112
caps.latest.revision: "21"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: d1364aa4284bcc858a9164f78e14daecc1a3ad54
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/02/2017
---
# <a name="queuing-in-wcf"></a><span data-ttu-id="a9b60-102">WCF でのキュー</span><span class="sxs-lookup"><span data-stu-id="a9b60-102">Queuing in WCF</span></span>
<span data-ttu-id="a9b60-103">ここでは、[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] でキュー通信を使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-103">This section describes how to use queued communication in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span>  
  
## <a name="queues-as-a-wcf-transport-binding"></a><span data-ttu-id="a9b60-104">WCF トランスポート バインディングとしてのキュー</span><span class="sxs-lookup"><span data-stu-id="a9b60-104">Queues as a WCF transport binding</span></span>  
 <span data-ttu-id="a9b60-105">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] では、交換する内容をコントラクトによって指定します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-105">In [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], the contracts specify what is being exchanged.</span></span> <span data-ttu-id="a9b60-106">コントラクトは、ビジネスによって異なるまたはアプリケーション固有のメッセージ交換です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-106">Contracts are business-dependent or application-specific message exchanges.</span></span> <span data-ttu-id="a9b60-107">メッセージ交換に使用する機構 (または "方法") は、バインディングで指定します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-107">The mechanism used to exchange messages (or the "how") is specified in the bindings.</span></span> <span data-ttu-id="a9b60-108">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] のバインディングは、メッセージ交換の詳細をカプセル化します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-108">Bindings in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] encapsulate details of the message exchange.</span></span> <span data-ttu-id="a9b60-109">バインディングは、そのバインディングが表すトランスポートまたはプロトコルのさまざまな部分をユーザーが制御するための構成調整情報を公開します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-109">They expose configuration knobs for the user to control various aspects of the transport or the protocol that the bindings represent.</span></span> <span data-ttu-id="a9b60-110">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] のキューは、他のトランスポート バインディングと同様に扱われます。これは、多くのキュー アプリケーションにとって大きな利点となります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-110">Queuing in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is treated like any other transport binding, which is a big advantage for many queuing applications.</span></span> <span data-ttu-id="a9b60-111">現在、多くのキュー アプリケーションは、他のリモート プロシージャ コール (RPC) スタイルの分散アプリケーションとは異なる方法で記述されており、これが原因でフォローと管理が難しくなっています。</span><span class="sxs-lookup"><span data-stu-id="a9b60-111">Today, many queuing applications are written differently from other remote procedure call (RPC)-style distributed applications, making it harder to follow and maintain.</span></span> <span data-ttu-id="a9b60-112">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] では、分散アプリケーションを記述するスタイルはほとんど同じなので、フォローと管理が簡単です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-112">With [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], the style of writing a distributed application is much the same, making it easier to follow and maintain.</span></span> <span data-ttu-id="a9b60-113">さらに、交換の機構をビジネス ロジックから切り離すことによって、アプリケーション固有のコードに影響を与えることなく、簡単にトランスポートを構成したり、そのトランスポートに変更を加えたりできます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-113">Moreover, by factoring out the mechanism of exchange separately from the business logic, it is easier to configure the transport or make changes to it without affecting application specific code.</span></span> <span data-ttu-id="a9b60-114">次の図は、MSMQ をトランスポートとして使用する WCF サービスとクライアントの構造を示しています。</span><span class="sxs-lookup"><span data-stu-id="a9b60-114">The following figure illustrates the structure of a WCF service and client using MSMQ as a transport.</span></span>  
  
 <span data-ttu-id="a9b60-115">![アプリケーション ダイアグラムをキューに置かれた](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "分散キュー図")</span><span class="sxs-lookup"><span data-stu-id="a9b60-115">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="a9b60-116">上の図からわかるように、クライアントとサービスは、アプリケーションのセマンティクス、つまりコントラクトと実装だけを定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-116">As you can see from the preceding figure, the client and service must define only the application semantics, that is, the contract and implementation.</span></span> <span data-ttu-id="a9b60-117">サービスは、優先設定を使用してキューに置かれたバインディングを構成します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-117">The service configures a queued binding with preferred settings.</span></span> <span data-ttu-id="a9b60-118">クライアントを使用して、 [ServiceModel メタデータ ユーティリティ ツール (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)を生成する、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]クライアント サービスとサービスにメッセージを送信に使用するバインディングについて説明する構成ファイルを生成します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-118">The client uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client to the service and to generate a configuration file that describes the bindings to use to send messages to the service.</span></span> <span data-ttu-id="a9b60-119">したがって、キューに置かれたメッセージを送信するとき、クライアントは、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] クライアントをインスタンス化し、そのクライアントに対する操作を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-119">Thus, to send a queued message, the client instantiates a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and invokes an operation on it.</span></span> <span data-ttu-id="a9b60-120">これによって、メッセージは転送キューに送信され、次にターゲット キューに転送されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-120">This causes the message to be sent to the transmission queue and transferred to the target queue.</span></span> <span data-ttu-id="a9b60-121">キュー通信の複雑さはすべて、メッセージを送受信するアプリケーションからは見えません。</span><span class="sxs-lookup"><span data-stu-id="a9b60-121">All the complexities of queued communication are hidden from the application that is sending and receiving messages.</span></span>  
  
 <span data-ttu-id="a9b60-122">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] のキューに置かれたバインディングには、次の注意事項があります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-122">Caveats about queued binding in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] include:</span></span>  
  
-   <span data-ttu-id="a9b60-123">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] で既定のキューに置かれたバインディングは、キューを使用した双方向通信をサポートしないので、すべてのサービス操作は一方向である必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-123">All service operations must be one-way because the default queued binding in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] does not support duplex communication using queues.</span></span> <span data-ttu-id="a9b60-124">双方向通信のサンプル ([双方向通信](../../../../docs/framework/wcf/samples/two-way-communication.md)) 2 つの一方向コントラクトを使用してキューを使用して双方向通信を実装する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="a9b60-124">A two-way communication sample ([Two-Way Communication](../../../../docs/framework/wcf/samples/two-way-communication.md)) illustrates how to use two one-way contracts to implement duplex communication using queues.</span></span>  
  
-   <span data-ttu-id="a9b60-125">メタデータ交換を使用する [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] クライアントを生成するには、サービスに追加の HTTP エンドポイントが必要です。これによって、エンドポイントを直接照会して [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] クライアントを生成したり、キュー通信を適切に構成するためにバインディング情報を取得したりできるようになります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-125">To generate a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client using metadata exchange requires an additional HTTP endpoint on the service so that it can be queried directly to generate the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and obtain binding information to appropriately configure queued communication.</span></span>  
  
-   <span data-ttu-id="a9b60-126">キューに置かれたバインディングに応じて、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] の外側で別の構成が必要になります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-126">Based on the queued binding, extra configuration outside of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is required.</span></span> <span data-ttu-id="a9b60-127">たとえば、<xref:System.ServiceModel.NetMsmqBinding> に付属の [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] クラスでは、バインディングを構成する以外に、メッセージ キュー (MSMQ) を最小限構成することが必要です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-127">For example, the <xref:System.ServiceModel.NetMsmqBinding> class that is shipped with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] requires you to configure the bindings as well as minimally configure Message Queuing (MSMQ).</span></span>  
  
 <span data-ttu-id="a9b60-128">後のセクションでは、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] に付属する、MSMQ に基づいた特定のキューに置かれたバインディングについて説明します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-128">The following sections describe the specific queued bindings shipped with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], which are based on MSMQ.</span></span>  
  
### <a name="msmq"></a><span data-ttu-id="a9b60-129">MSMQ</span><span class="sxs-lookup"><span data-stu-id="a9b60-129">MSMQ</span></span>  
 <span data-ttu-id="a9b60-130">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] のキューに置かれたトランスポートでは、そのキュー通信に MSMQ を使用します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-130">The queued transport in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] uses MSMQ for its queued communication.</span></span>  
  
 <span data-ttu-id="a9b60-131">MSMQ は Windows のオプション コンポーネントとして付属し、NT サービスの 1 つとして実行されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-131">MSMQ ships as an optional component with Windows and runs as an NT service.</span></span> <span data-ttu-id="a9b60-132">MSMQ サービスは、転送するメッセージを転送キューから取り込み、配信するメッセージをターゲット キューから取り込みます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-132">It captures messages for transmission in a transmission queue and for delivery in a target queue.</span></span> <span data-ttu-id="a9b60-133">MSMQ キュー マネージャーは信頼できるメッセージ転送プロトコルを実装して、送信中にメッセージが失われないようにします。</span><span class="sxs-lookup"><span data-stu-id="a9b60-133">The MSMQ queue managers implement a reliable message-transfer protocol so that messages are not lost in transmission.</span></span> <span data-ttu-id="a9b60-134">このプロトコルは、ネイティブまたは SOAP リライアブル メッセージ プロトコル (SRMP) などの SOAP ベースのプロトコルです。</span><span class="sxs-lookup"><span data-stu-id="a9b60-134">The protocol can be either native or SOAP-based, such as the SOAP Reliable Message Protocol (SRMP).</span></span>  
  
 <span data-ttu-id="a9b60-135">MSMQ では、キューをトランザクションまたは非トランザクションとして設定できます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-135">In MSMQ, queues can be transactional or non-transactional.</span></span> <span data-ttu-id="a9b60-136">トランザクション キューの場合、トランザクションによるメッセージの取り込みと配信が可能です。メッセージは、キューに永続的に格納されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-136">A transactional queue allows messages to be captured and delivered in a transaction and then stored durably in the queue.</span></span> <span data-ttu-id="a9b60-137">トランザクション キューに送信されたメッセージは、正確に 1 回だけ、順序どおりに転送されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-137">Messages sent to a transactional queue are transferred exactly once in order.</span></span> <span data-ttu-id="a9b60-138">非トランザクション キューを使用すると、揮発性メッセージと非揮発性メッセージの両方を送信できます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-138">You can use a non-transactional queue to send both volatile and durable messages.</span></span> <span data-ttu-id="a9b60-139">非トランザクション キューに送信されたメッセージには、信頼できる転送保証がありません。したがって、メッセージが失われる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-139">A message sent to a non-transactional queue does not carry any reliable transfer assurances; thus, messages can be lost.</span></span>  
  
 <span data-ttu-id="a9b60-140">MSMQ キューも、Active Directory ディレクトリ サービスに登録された Windows ID を使用してセキュリティで保護できます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-140">MSMQ queues can also be secured using a Windows identity registered with the Active Directory directory service.</span></span> <span data-ttu-id="a9b60-141">MSMQ をインストールするとき、Active Directory 統合をインストールできます。Active Directory 統合では、コンピューターを Windows ドメイン ネットワークに含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-141">When installing MSMQ, you can install Active Directory integration, which requires the computer to be part of a Windows domain network.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="a9b60-142">MSMQ を参照してください[をインストールするメッセージ キュー (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md)です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-142"> MSMQ, see [Installing Message Queuing (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md).</span></span>  
  
### <a name="netmsmqbinding"></a><span data-ttu-id="a9b60-143">NetMsmqBinding</span><span class="sxs-lookup"><span data-stu-id="a9b60-143">NetMsmqBinding</span></span>  
 <span data-ttu-id="a9b60-144">[ \<NetMsmqBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md)キューに置かれたバインディング[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]という 2 つの提供[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]MSMQ を使用して通信するエンドポイント。</span><span class="sxs-lookup"><span data-stu-id="a9b60-144">The [\<netMsmqBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md) is the queued binding [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] provides for two [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] endpoints to communicate using MSMQ.</span></span> <span data-ttu-id="a9b60-145">したがって、このバインディングは、MSMQ 固有のプロパティを公開します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-145">The binding, therefore, exposes properties that are specific to MSMQ.</span></span> <span data-ttu-id="a9b60-146">ただし、すべての MSMQ 機能とプロパティが `NetMsmqBinding` で公開されるわけではありません。</span><span class="sxs-lookup"><span data-stu-id="a9b60-146">However, not all MSMQ features and properties are exposed in the `NetMsmqBinding`.</span></span> <span data-ttu-id="a9b60-147">コンパクトな `NetMsmqBinding` は、大部分のユーザーが満足できる最適な機能セットを考慮して設計されています。</span><span class="sxs-lookup"><span data-stu-id="a9b60-147">The compact `NetMsmqBinding` is designed with an optimal set of features that most customers should find sufficient.</span></span>  
  
 <span data-ttu-id="a9b60-148">`NetMsmqBinding` は、これまでに説明した基本的なキューの概念をバインディングのプロパティという形で明確に示しています。</span><span class="sxs-lookup"><span data-stu-id="a9b60-148">The `NetMsmqBinding` manifests the core queuing concepts discussed thus far in the form of properties on the bindings.</span></span> <span data-ttu-id="a9b60-149">このプロパティは、メッセージの転送方法と配信方法を MSMQ に伝達します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-149">These properties, in turn, communicate to MSMQ how to transfer and deliver the messages.</span></span> <span data-ttu-id="a9b60-150">プロパティのカテゴリの詳細については、後のセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a9b60-150">A discussion of the property categories is in the following sections.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="a9b60-151">、特定のプロパティについて詳しく説明している概念に関するトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a9b60-151"> the conceptual topics that describe specific properties more completely.</span></span>  
  
#### <a name="exactlyonce-and-durable-properties"></a><span data-ttu-id="a9b60-152">ExactlyOnce プロパティと Durable プロパティ</span><span class="sxs-lookup"><span data-stu-id="a9b60-152">ExactlyOnce and Durable Properties</span></span>  
 <span data-ttu-id="a9b60-153">`ExactlyOnce` プロパティと `Durable` プロパティは、キュー間のメッセージの転送方法を制御します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-153">The `ExactlyOnce` and `Durable` properties affect how messages are transferred between queues:</span></span>  
  
-   <span data-ttu-id="a9b60-154">`ExactlyOnce`: `true` (既定) に設定した場合、キューに置かれたチャネルによって、メッセージが重複しないようにすることができます (メッセージが配信される場合)。</span><span class="sxs-lookup"><span data-stu-id="a9b60-154">`ExactlyOnce`: When set to `true` (the default), the queued channel ensures that the message, if delivered, is not duplicated.</span></span> <span data-ttu-id="a9b60-155">また、メッセージが失われないようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-155">It also ensures that the message is not lost.</span></span> <span data-ttu-id="a9b60-156">メッセージを配信できない場合、またはメッセージを配信する前にメッセージの有効期間 (TTL: Time To Live) が切れた場合、失敗したメッセージが配信エラー理由と共に配信不能キューに記録されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-156">If the message cannot be delivered, or the message Time-To Live expires before the message can be delivered, the failed message along with the delivery failure reason is recorded in a dead-letter queue.</span></span> <span data-ttu-id="a9b60-157">`false` に設定した場合、キューに置かれたチャネルにより、メッセージの転送が試行されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-157">When set to `false`, the queued channel makes an effort to transfer the message.</span></span> <span data-ttu-id="a9b60-158">この場合、必要に応じて配信不能キューを選択できます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-158">In this case, you can optionally choose a dead-letter queue.</span></span>  
  
-   <span data-ttu-id="a9b60-159">`Durable:``true` (既定) に設定した場合、キューに置かれたチャネルによって、MSMQ がメッセージをディスクに永続的に格納することが保証されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-159">`Durable:` When set to `true` (the default), the queued channel ensures that MSMQ stores the message durably on disk.</span></span> <span data-ttu-id="a9b60-160">したがって、MSMQ サービスを停止して再起動した場合、ディスク上のメッセージがターゲット キューに転送されるか、サービスに配信されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-160">Thus, if the MSMQ service were to stop and restart, the messages on disk is transferred to the target queue or delivered to the service.</span></span> <span data-ttu-id="a9b60-161">`false` に設定した場合、メッセージは揮発性ストアに格納され、MSMQ サービスを停止して再起動すると、メッセージは失われます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-161">When set to `false`, the messages are stored in volatile store and are lost on stopping and restarting the MSMQ service.</span></span>  
  
 <span data-ttu-id="a9b60-162">`ExactlyOnce` の信頼できる転送を実現するために、MSMQ ではトランザクション キューを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-162">For `ExactlyOnce` reliable transfer, MSMQ requires the queue to be transactional.</span></span> <span data-ttu-id="a9b60-163">また、MSMQ では、トランザクションがトランザクション キューから読み取られる必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-163">Also, MSMQ requires a transaction to read from a transactional queue.</span></span> <span data-ttu-id="a9b60-164">このため、`NetMsmqBinding` を使用する場合、`ExactlyOnce` を `true` に設定したときは、メッセージの送受信にトランザクションが必要なことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a9b60-164">As such, when you use the `NetMsmqBinding`, remember that a transaction is required to send or receive messages when `ExactlyOnce` is set to `true`.</span></span> <span data-ttu-id="a9b60-165">同様に、ベスト エフォート保証を使用する場合 (`ExactlyOnce` が `false` の場合など) および揮発性メッセージングを行う場合、MSMQ で非トランザクション キューを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-165">Similarly, MSMQ requires the queue to be non-transactional for best-effort assurances, such as when `ExactlyOnce` is `false` and for volatile messaging.</span></span> <span data-ttu-id="a9b60-166">このため、`ExactlyOnce` を `false` に設定するか、または Durable を `false` に設定した場合、トランザクションを使用して送受信できません。</span><span class="sxs-lookup"><span data-stu-id="a9b60-166">Thus, when setting `ExactlyOnce` to `false` or durable to `false`, you cannot send or receive using a transaction.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a9b60-167">正しいキュー (トランザクションまたは非トランザクション) がバインディングの設定に基づいて作成されるようにしてください。</span><span class="sxs-lookup"><span data-stu-id="a9b60-167">Ensure that the correct queue (transactional or non-transactional) is created based on settings in the bindings.</span></span> <span data-ttu-id="a9b60-168">`ExactlyOnce` が `true` の場合はトランザクション キューを使用し、false の場合は非トランザクション キューを使用します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-168">If `ExactlyOnce` is `true`, use a transactional queue; otherwise, use a non-transactional queue.</span></span>  
  
#### <a name="dead-letter-queue-properties"></a><span data-ttu-id="a9b60-169">配信不能キューのプロパティ</span><span class="sxs-lookup"><span data-stu-id="a9b60-169">Dead-Letter Queue Properties</span></span>  
 <span data-ttu-id="a9b60-170">配信不能キューは、配信に失敗したメッセージを格納するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-170">The dead-letter queue is used to store messages that fail delivery.</span></span> <span data-ttu-id="a9b60-171">ユーザーは、配信不能キューからメッセージを読み取る補正ロジックを記述できます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-171">The user can write compensating logic that reads messages out of the dead-letter queue.</span></span>  
  
 <span data-ttu-id="a9b60-172">多くのキュー システムは、システム全体の配信不能キューを提供します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-172">Many queuing systems provide for a system-wide dead-letter queue.</span></span> <span data-ttu-id="a9b60-173">MSMQ は、非トランザクション キューへの配信が失敗したメッセージに対してシステム全体の非トランザクション配信不能キューを提供し、トランザクション キューへの配信が失敗したメッセージに対してシステム全体のトランザクション配信不能キューを提供します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-173">MSMQ provides a system-wide non-transactional dead-letter queue for messages that fail delivery to non-transactional queues and a system-wide transactional dead-letter queue for messages that fail delivery to transactional queues.</span></span>  
  
 <span data-ttu-id="a9b60-174">異なるターゲット キューにメッセージを送信する複数のクライアントによって MSMQ サービスが共有される場合、クライアントが送信したすべてのメッセージが同じ配信不能キューに集まります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-174">If multiple clients sending messages to different target queues share the MSMQ service, all messages sent by the clients go to the same dead-letter queue.</span></span> <span data-ttu-id="a9b60-175">これが適さない状況もあります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-175">This is not always preferable.</span></span> <span data-ttu-id="a9b60-176">分離を向上するために、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] と [!INCLUDE[wv](../../../../includes/wv-md.md)] の MSMQ には、ユーザーが配信に失敗したメッセージを格納するために指定できるカスタム配信不能キュー (またはアプリケーション固有の配信不能キュー) が用意されています。</span><span class="sxs-lookup"><span data-stu-id="a9b60-176">For better isolation, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] and MSMQ in [!INCLUDE[wv](../../../../includes/wv-md.md)] provide a custom dead-letter queue (or application-specific dead-letter queue) that the user can specify to store messages that fail delivery.</span></span> <span data-ttu-id="a9b60-177">したがって、異なるクライアントが同じ配信不能キューを共有することがありません。</span><span class="sxs-lookup"><span data-stu-id="a9b60-177">Therefore, different clients do not share the same dead-letter queue.</span></span>  
  
 <span data-ttu-id="a9b60-178">バインディングには、2 つの該当するプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-178">The binding has two properties of interest:</span></span>  
  
-   <span data-ttu-id="a9b60-179">`DeadLetterQueue`: このプロパティは、配信不能キューが要求されるかどうかを示す列挙体です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-179">`DeadLetterQueue`: This property is an enumeration that indicates whether a dead-letter queue is requested.</span></span> <span data-ttu-id="a9b60-180">この列挙体では、配信不能キューが要求される場合、そのキューの種類も指定します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-180">The enumeration also contains the kind of dead-letter queue, if one is requested.</span></span> <span data-ttu-id="a9b60-181">値は、`None`、`System`、および `Custom` です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-181">The values are `None`, `System`, and `Custom`.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="a9b60-182">これらのプロパティの解釈を参照してください[メッセージ転送エラーの処理を配信不能メッセージ キューを使用します。](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</span><span class="sxs-lookup"><span data-stu-id="a9b60-182"> the interpretation of these properties, see [Using Dead-Letter Queues to Handle Message Transfer Failures](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</span></span>  
  
-   <span data-ttu-id="a9b60-183">`CustomDeadLetterQueue`: このプロパティは、アプリケーション固有の配信不能キューの URI (Uniform Resource Identifier) アドレスです。</span><span class="sxs-lookup"><span data-stu-id="a9b60-183">`CustomDeadLetterQueue`: This property is the Uniform Resource Identifier (URI) address of the application-specific dead-letter queue.</span></span> <span data-ttu-id="a9b60-184">これは、必要な場合`DeadLetterQueue`です。`Custom`</span><span class="sxs-lookup"><span data-stu-id="a9b60-184">This is required if `DeadLetterQueue`.`Custom`</span></span> <span data-ttu-id="a9b60-185">選択されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-185">is chosen.</span></span>  
  
#### <a name="poison-message-handling-properties"></a><span data-ttu-id="a9b60-186">有害メッセージ処理プロパティ</span><span class="sxs-lookup"><span data-stu-id="a9b60-186">Poison Message Handling properties</span></span>  
 <span data-ttu-id="a9b60-187">サービスがトランザクションでターゲット キューからメッセージを読み取るとき、サービスはさまざまな原因でメッセージの処理に失敗する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-187">When the service reads messages from the target queue under a transaction, the service may fail to process the message for various reasons.</span></span> <span data-ttu-id="a9b60-188">失敗したメッセージは、再度読み取るためにキューに戻されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-188">The message is then put back into the queue to be read again.</span></span> <span data-ttu-id="a9b60-189">繰り返し失敗するメッセージを処理するために、有害メッセージ処理プロパティをバインディングで構成できます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-189">To deal with messages that fail repeatedly, a set of poison-message handling properties can be configured in the binding.</span></span> <span data-ttu-id="a9b60-190">`ReceiveRetryCount`、`MaxRetryCycles`、`RetryCycleDelay`、および `ReceiveErrorHandling` という 4 つのプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-190">There are four properties: `ReceiveRetryCount`, `MaxRetryCycles`, `RetryCycleDelay`, and `ReceiveErrorHandling`.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="a9b60-191">これらのプロパティを参照してください[有害メッセージ処理](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-191"> these properties, see [Poison Message Handling](../../../../docs/framework/wcf/feature-details/poison-message-handling.md).</span></span>  
  
#### <a name="security-properties"></a><span data-ttu-id="a9b60-192">セキュリティ プロパティ</span><span class="sxs-lookup"><span data-stu-id="a9b60-192">Security Properties</span></span>  
 <span data-ttu-id="a9b60-193">MSMQ では、キューのアクセス制御リスト (ACL)、認証されたメッセージの送信など、独自のセキュリティ モデルを公開します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-193">MSMQ exposes its own security model, such as access control lists (ACLs) on a queue or sending authenticated messages.</span></span> <span data-ttu-id="a9b60-194">`NetMsmqBinding` は、このセキュリティ プロパティをそのトランスポート セキュリティ設定の一部として公開します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-194">The `NetMsmqBinding` exposes these security properties as part of its transport security settings.</span></span> <span data-ttu-id="a9b60-195">トランスポート セキュリティのバインディングには、`MsmqAuthenticationMode` プロパティおよび `MsmqProtectionLevel` プロパティという 2 つのプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-195">There are two properties in the binding for transport security: `MsmqAuthenticationMode` and `MsmqProtectionLevel`.</span></span> <span data-ttu-id="a9b60-196">このプロパティの設定は、MSMQ の構成方法によって異なります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-196">Settings in these properties depend on how MSMQ is configured.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="a9b60-197">[トランスポート セキュリティを使用してメッセージをセキュリティで保護する](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-197"> [Securing Messages Using Transport Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md).</span></span>  
  
 <span data-ttu-id="a9b60-198">トランスポート セキュリティに加えて、実際の SOAP メッセージはメッセージ セキュリティでも保護できます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-198">In addition to transport security, the actual SOAP message itself can be secured using message security.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="a9b60-199">[メッセージ セキュリティを使用してメッセージをセキュリティで保護する](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md)です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-199"> [Securing Messages Using Message Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md).</span></span>  
  
 <span data-ttu-id="a9b60-200">また、`MsmqTransportSecurity` は、2 つのプロパティ `MsmqEncryptionAlgorithm` と `MsmqHashAlgorithm` を公開します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-200">`MsmqTransportSecurity` also exposes two properties, `MsmqEncryptionAlgorithm` and `MsmqHashAlgorithm`.</span></span> <span data-ttu-id="a9b60-201">このプロパティは、キュー間の転送でメッセージを暗号化するために、または署名をハッシュするために選択できる異なるアルゴリズムの列挙体です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-201">These are enumerations of different algorithms to choose for queue-to-queue transfer encryption of messages and hashing of the signatures.</span></span>  
  
#### <a name="other-properties"></a><span data-ttu-id="a9b60-202">その他のプロパティ</span><span class="sxs-lookup"><span data-stu-id="a9b60-202">Other Properties</span></span>  
 <span data-ttu-id="a9b60-203">上記のプロパティに加えて、次の MSMQ 固有のプロパティがバインディングで公開されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-203">In addition to the preceding properties, other MSMQ-specific properties exposed in the binding include:</span></span>  
  
-   <span data-ttu-id="a9b60-204">`UseSourceJournal`: ソース ジャーナリングが有効かどうかを示すプロパティです。</span><span class="sxs-lookup"><span data-stu-id="a9b60-204">`UseSourceJournal`: A property to indicate that source journaling is turned on.</span></span> <span data-ttu-id="a9b60-205">ソース ジャーナリングとは、転送キューから正常に送信されたメッセージを追跡する MSMQ の機能です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-205">Source journaling is an MSMQ feature that keeps track of messages that have been successfully transmitted from the transmission queue.</span></span>  
  
-   <span data-ttu-id="a9b60-206">`UseMsmqTracing`: MSMQ トレースが有効かどうかを示すプロパティです。</span><span class="sxs-lookup"><span data-stu-id="a9b60-206">`UseMsmqTracing`: A property to indicate that MSMQ tracing is turned on.</span></span> <span data-ttu-id="a9b60-207">MSMQ トレースでは、MSMQ キュー マネージャーをホストしているコンピューターでメッセージが送受信されるたびに、レポート メッセージをレポート キューに送信します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-207">MSMQ tracing sends report messages to a report queue each time a message leaves or arrives at a machine hosting an MSMQ queue manager.</span></span>  
  
-   <span data-ttu-id="a9b60-208">`QueueTransferProtocol`: キュー間のメッセージ転送に使用するプロトコルの列挙体です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-208">`QueueTransferProtocol`: An enumeration of the protocol to use for queue-to-queue message transfers.</span></span> <span data-ttu-id="a9b60-209">MSMQ では、ネイティブのキュー間転送プロトコルおよび SOAP リライアブル メッセージ プロトコル (SRMP) と呼ばれる SOAP ベースのプロトコルを実装しています。</span><span class="sxs-lookup"><span data-stu-id="a9b60-209">MSMQ implements a native queue-to-queue transfer protocol and a SOAP-based protocol called SOAP Reliable Messaging Protocol (SRMP).</span></span> <span data-ttu-id="a9b60-210">SRMP は、キュー間の転送に HTTP トランスポートを使用している場合に使用します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-210">SRMP is used when using HTTP transport for queue-to-queue transfers.</span></span> <span data-ttu-id="a9b60-211">SRMP Secure は、キュー間の転送に HTTPS を使用している場合に使用します。</span><span class="sxs-lookup"><span data-stu-id="a9b60-211">SRMP secure is used when using HTTPS for queue-to-queue transfers.</span></span>  
  
-   <span data-ttu-id="a9b60-212">`UseActiveDirectory`: キューのアドレス解決に Active Directory を使用する必要があるかどうかを示すブール値です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-212">`UseActiveDirectory`: A Boolean value to indicate whether the Active Directory must be used for queue address resolution.</span></span> <span data-ttu-id="a9b60-213">既定ではオフになっています。</span><span class="sxs-lookup"><span data-stu-id="a9b60-213">By default, this is off.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="a9b60-214">[サービス エンドポイントとキューのアドレス指定](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)です。</span><span class="sxs-lookup"><span data-stu-id="a9b60-214"> [Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md).</span></span>  
  
### <a name="msmqintegrationbinding"></a><span data-ttu-id="a9b60-215">MsmqIntegrationBinding</span><span class="sxs-lookup"><span data-stu-id="a9b60-215">MsmqIntegrationBinding</span></span>  
 <span data-ttu-id="a9b60-216">`MsmqIntegrationBinding` は、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] エンドポイントが、C、C++、COM、または System.Messaging API を使用して作成された既存の MSMQ アプリケーションと通信する場合に使用されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-216">The `MsmqIntegrationBinding` is used when you want a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] endpoint to communicate with an existing MSMQ application written in C, C++, COM, or System.Messaging APIs.</span></span>  
  
 <span data-ttu-id="a9b60-217">このバインディングのプロパティは、`NetMsmqBinding` のプロパティと同じです。</span><span class="sxs-lookup"><span data-stu-id="a9b60-217">The binding properties are the same as for `NetMsmqBinding`.</span></span> <span data-ttu-id="a9b60-218">ただし、次のような違いがあります。</span><span class="sxs-lookup"><span data-stu-id="a9b60-218">However, the following differences apply:</span></span>  
  
-   <span data-ttu-id="a9b60-219">`MsmqIntegrationBinding` の操作コントラクトは、型パラメーターが本文型である型 <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> の 1 つのパラメーターしか指定することができません。</span><span class="sxs-lookup"><span data-stu-id="a9b60-219">The operation contract for `MsmqIntegrationBinding` is restricted to taking a single parameter of type <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> where the type parameter is the body type.</span></span>  
  
-   <span data-ttu-id="a9b60-220">ほとんどの MSMQ ネイティブ メッセージ プロパティは、使用するために <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> で公開されます。</span><span class="sxs-lookup"><span data-stu-id="a9b60-220">Much of MSMQ native message properties are exposed in the <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> for use.</span></span>  
  
-   <span data-ttu-id="a9b60-221">メッセージ本文のシリアル化と逆シリアル化のために、XML、ActiveX などのシリアライザーが用意されています。</span><span class="sxs-lookup"><span data-stu-id="a9b60-221">To help with serialization and deserialization of the message body, serializers such as XML and ActiveX are provided.</span></span>  
  
### <a name="sample-code"></a><span data-ttu-id="a9b60-222">サンプル コード</span><span class="sxs-lookup"><span data-stu-id="a9b60-222">Sample Code</span></span>  
 <span data-ttu-id="a9b60-223">MSMQ を使用する WCF サービスを書き込む方法の手順については、次のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a9b60-223">For step by step instructions on how to write WCF services that use MSMQ see the following topics:</span></span>  
  
-   [<span data-ttu-id="a9b60-224">方法: WCF エンドポイントでメッセージを交換して、メッセージ キュー アプリケーション</span><span class="sxs-lookup"><span data-stu-id="a9b60-224">How to: Exchange Messages with WCF Endpoints and Message Queuing Applications</span></span>](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-with-wcf-endpoints-and-message-queuing-applications.md)  
  
-   [<span data-ttu-id="a9b60-225">方法: Exchange の WCF エンドポイントとメッセージのキュー</span><span class="sxs-lookup"><span data-stu-id="a9b60-225">How to: Exchange Queued Messages with WCF Endpoints</span></span>](../../../../docs/framework/wcf/feature-details/how-to-exchange-queued-messages-with-wcf-endpoints.md)  
  
 <span data-ttu-id="a9b60-226">WCF での MSMQ の使用を示す完全なコード サンプルについては、次のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a9b60-226">For a completed code sample illustrating the use of MSMQ in WCF see the following topics:</span></span>  
  
-   [<span data-ttu-id="a9b60-227">トランザクション MSMQ バインディング</span><span class="sxs-lookup"><span data-stu-id="a9b60-227">Transacted MSMQ Binding</span></span>](../../../../docs/framework/wcf/samples/transacted-msmq-binding.md)  
  
-   [<span data-ttu-id="a9b60-228">揮発性キューによる通信</span><span class="sxs-lookup"><span data-stu-id="a9b60-228">Volatile Queued Communication</span></span>](../../../../docs/framework/wcf/samples/volatile-queued-communication.md)  
  
-   [<span data-ttu-id="a9b60-229">配信不能キュー</span><span class="sxs-lookup"><span data-stu-id="a9b60-229">Dead Letter Queues</span></span>](../../../../docs/framework/wcf/samples/dead-letter-queues.md)  
  
-   [<span data-ttu-id="a9b60-230">セッションおよびキュー</span><span class="sxs-lookup"><span data-stu-id="a9b60-230">Sessions and Queues</span></span>](../../../../docs/framework/wcf/samples/sessions-and-queues.md)  
  
-   [<span data-ttu-id="a9b60-231">双方向の通信</span><span class="sxs-lookup"><span data-stu-id="a9b60-231">Two-Way Communication</span></span>](../../../../docs/framework/wcf/samples/two-way-communication.md)  
  
-   [<span data-ttu-id="a9b60-232">トランザクション バッチ</span><span class="sxs-lookup"><span data-stu-id="a9b60-232">Transacted Batching</span></span>](../../../../docs/framework/wcf/samples/transacted-batching.md)  
  
-   [<span data-ttu-id="a9b60-233">SRMP</span><span class="sxs-lookup"><span data-stu-id="a9b60-233">SRMP</span></span>](../../../../docs/framework/wcf/samples/srmp.md)  
  
-   [<span data-ttu-id="a9b60-234">メッセージ キューを介したメッセージ セキュリティ</span><span class="sxs-lookup"><span data-stu-id="a9b60-234">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)  
  
## <a name="see-also"></a><span data-ttu-id="a9b60-235">関連項目</span><span class="sxs-lookup"><span data-stu-id="a9b60-235">See Also</span></span>  
 [<span data-ttu-id="a9b60-236">サービス エンドポイントとキューのアドレス指定</span><span class="sxs-lookup"><span data-stu-id="a9b60-236">Service Endpoints and Queue Addressing</span></span>](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)  
 [<span data-ttu-id="a9b60-237">キューに置かれたアプリケーションをホストする web</span><span class="sxs-lookup"><span data-stu-id="a9b60-237">Web Hosting a Queued Application</span></span>](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)
