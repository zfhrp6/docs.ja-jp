---
title: サービス トレース ビューアーを使用した相関トレースの表示とトラブルシューティング
ms.date: 03/30/2017
ms.assetid: 05d2321c-8acb-49d7-a6cd-8ef2220c6775
ms.openlocfilehash: cfa1ec0e486943d196ec016be87544f17a0114e6
ms.sourcegitcommit: 15109844229ade1c6449f48f3834db1b26907824
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2018
ms.locfileid: "33806771"
---
# <a name="using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting"></a><span data-ttu-id="974b7-102">サービス トレース ビューアーを使用した相関トレースの表示とトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="974b7-102">Using Service Trace Viewer for Viewing Correlated Traces and Troubleshooting</span></span>
<span data-ttu-id="974b7-103">ここでは、トレース データの形式、表示方法、およびサービス トレース ビューアーを使用したアプリケーションのトラブルシューティングの方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="974b7-103">This topic describes the format of trace data, how to view it, and approaches that use the Service Trace Viewer to troubleshoot your application.</span></span>  
  
## <a name="using-the-service-trace-viewer-tool"></a><span data-ttu-id="974b7-104">サービス トレース ビューアー ツールの使用</span><span class="sxs-lookup"><span data-stu-id="974b7-104">Using the Service Trace Viewer Tool</span></span>  
 <span data-ttu-id="974b7-105">Windows Communication Foundation (WCF) サービス トレース ビューアー ツールを使用して、エラーの根本原因を検索する WCF リスナーによって生成された診断トレースを関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="974b7-105">The Windows Communication Foundation (WCF) Service Trace Viewer tool helps you correlate diagnostic traces produced by WCF listeners to locate the root cause of an error.</span></span> <span data-ttu-id="974b7-106">このツールでは、簡単に表示、グループ、および診断、修復して WCF サービスの問題を確認できるように、トレースをフィルター処理する方法を使用します。</span><span class="sxs-lookup"><span data-stu-id="974b7-106">The tool gives you a way to easily view, group, and filter traces so that you can diagnose, repair and verify issues with WCF services.</span></span> <span data-ttu-id="974b7-107">詳細については、このツールを使用して、次を参照してください。[サービス トレース ビューアー ツール (SvcTraceViewer.exe)](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)です。</span><span class="sxs-lookup"><span data-stu-id="974b7-107">For more information about using this tool, see [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md).</span></span>  
  
 <span data-ttu-id="974b7-108">このトピックを実行して生成されたトレースのスクリーン ショットが含まれています、[トレースとメッセージ ログ](../../../../../docs/framework/wcf/samples/tracing-and-message-logging.md)を使用して表示するときに、サンプリング、[サービス トレース ビューアー ツール (SvcTraceViewer.exe)](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)です。</span><span class="sxs-lookup"><span data-stu-id="974b7-108">This topic contains screenshots of traces generated by running the [Tracing and Message Logging](../../../../../docs/framework/wcf/samples/tracing-and-message-logging.md) sample, when viewed using the [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md).</span></span> <span data-ttu-id="974b7-109">ここでは、トレースの内容、アクティビティ、およびアクティビティの相関関係を理解する方法と、トラブルシューティングを行うときに多数のトレースを分析する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="974b7-109">This topic demonstrates how to understand trace content, activities and their correlation, and how to analyze large numbers of traces when troubleshooting.</span></span>  
  
## <a name="viewing-trace-content"></a><span data-ttu-id="974b7-110">トレースの内容の表示</span><span class="sxs-lookup"><span data-stu-id="974b7-110">Viewing Trace Content</span></span>  
 <span data-ttu-id="974b7-111">トレース イベントには、次のような最も重要な情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="974b7-111">A trace event contains the following most significant information:</span></span>  
  
-   <span data-ttu-id="974b7-112">設定時のアクティビティ名。</span><span class="sxs-lookup"><span data-stu-id="974b7-112">Activity name when set.</span></span>  
  
-   <span data-ttu-id="974b7-113">出力時間。</span><span class="sxs-lookup"><span data-stu-id="974b7-113">Emission time.</span></span>  
  
-   <span data-ttu-id="974b7-114">トレース レベル。</span><span class="sxs-lookup"><span data-stu-id="974b7-114">Trace level.</span></span>  
  
-   <span data-ttu-id="974b7-115">トレース ソース名。</span><span class="sxs-lookup"><span data-stu-id="974b7-115">Trace source name.</span></span>  
  
-   <span data-ttu-id="974b7-116">プロセス名。</span><span class="sxs-lookup"><span data-stu-id="974b7-116">Process name.</span></span>  
  
-   <span data-ttu-id="974b7-117">スレッド ID。</span><span class="sxs-lookup"><span data-stu-id="974b7-117">Thread id.</span></span>  
  
-   <span data-ttu-id="974b7-118">トレースに関連する詳細情報を取得することができます、Microsoft のドキュメントの送信先を指す URL は、一意のトレース識別子です。</span><span class="sxs-lookup"><span data-stu-id="974b7-118">A unique trace identifier, which is a URL that points to a destination in Microsoft Docs, from which you can obtain more information related to the trace.</span></span>  
  
 <span data-ttu-id="974b7-119">これらのすべてでわかるように、右上のパネルや、サービス トレース ビューアーで、**基本的な情報**トレースを選択するときに右下のパネルの書式付き ビューのセクションです。</span><span class="sxs-lookup"><span data-stu-id="974b7-119">All of these can be seen in the upper right panel in the Service Trace Viewer, or in the **Basic Information** section in the formatted view of the lower-right panel when selecting a trace.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="974b7-120">クライアントとサービスが同じコンピューター上にある場合、両方のアプリケーションのトレースが存在します。</span><span class="sxs-lookup"><span data-stu-id="974b7-120">If the client and the service are on the same machine, the traces for both applications will be present.</span></span> <span data-ttu-id="974b7-121">これは、フィルター処理することを使用して、**プロセス名**列です。</span><span class="sxs-lookup"><span data-stu-id="974b7-121">These can be filtered using the **Process Name** column.</span></span>  
  
 <span data-ttu-id="974b7-122">また、[書式付き] ビューには、トレースの説明と追加詳細情報も表示されます (利用できる場合)。</span><span class="sxs-lookup"><span data-stu-id="974b7-122">In addition, the formatted view also provides a description for the trace and additional detailed information when available.</span></span> <span data-ttu-id="974b7-123">追加詳細情報には、例外の種類とメッセージ、呼び出しスタック、メッセージ アクション、転送元/転送先フィールド、およびその他の例外情報が含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="974b7-123">The latter can include exception type and message, call stacks, message action, from/to fields, and other exception information.</span></span>  
  
 <span data-ttu-id="974b7-124">[XML] ビューには、以下の有用な XML タグが含まれます。</span><span class="sxs-lookup"><span data-stu-id="974b7-124">In the XML view, useful xml tags include the following:</span></span>  
  
-   <span data-ttu-id="974b7-125">\<サブタイプ > (トレース レベル)。</span><span class="sxs-lookup"><span data-stu-id="974b7-125">\<SubType> (trace level).</span></span>  
  
-   <span data-ttu-id="974b7-126">\<TimeCreated >。</span><span class="sxs-lookup"><span data-stu-id="974b7-126">\<TimeCreated>.</span></span>  
  
-   <span data-ttu-id="974b7-127">\<ソース > (トレース ソース名)。</span><span class="sxs-lookup"><span data-stu-id="974b7-127">\<Source> (trace source name).</span></span>  
  
-   <span data-ttu-id="974b7-128">\<相関関係 > (トレースの出力時に設定活動 id)。</span><span class="sxs-lookup"><span data-stu-id="974b7-128">\<Correlation> (activity id set when emitting the trace).</span></span>  
  
-   <span data-ttu-id="974b7-129">\<実行 > (プロセスとスレッド id)。</span><span class="sxs-lookup"><span data-stu-id="974b7-129">\<Execution> (process and thread id).</span></span>  
  
-   <span data-ttu-id="974b7-130">\<コンピューター >。</span><span class="sxs-lookup"><span data-stu-id="974b7-130">\<Computer>.</span></span>  
  
-   <span data-ttu-id="974b7-131">\<ExtendedData > など、\<アクション >、 \<MessageID >、および\<ActivityId > メッセージを送信するときに、メッセージ ヘッダーに設定します。</span><span class="sxs-lookup"><span data-stu-id="974b7-131">\<ExtendedData>, including \<Action>, \<MessageID> and the \<ActivityId> set in the message header when sending a message.</span></span>  
  
 <span data-ttu-id="974b7-132">"チャネル経由でメッセージを送信しました" トレースを調べると、次のような内容を確認できます。</span><span class="sxs-lookup"><span data-stu-id="974b7-132">If you examine the "Sent a message over a channel" trace, you may see the following content.</span></span>  
  
```xml  
<E2ETraceEvent xmlns="http://schemas.microsoft.com/2004/06/E2ETraceEvent">  
   <System xmlns="http://schemas.microsoft.com/2004/06/windows/eventlog/system">  
      <EventID>262163</EventID>  
      <Type>3</Type>  
      <SubType Name="Information">0</SubType>  
      <Level>8</Level>  
      <TimeCreated SystemTime="2006-08-04T18:45:30.8491051Z" />  
      <Source Name="System.ServiceModel" />  
       <Correlation ActivityID="{27c6331d-8998-43aa-a382-03239013a6bd}"/>  
       <Execution ProcessName="client" ProcessID="1808" ThreadID="1" />  
       <Channel />  
       <Computer>TEST1</Computer>  
   </System>  
   <ApplicationData>  
       <TraceData>  
          <DataItem>  
             <TraceRecord xmlns="http://schemas.microsoft.com/2004/10/E2ETraceEvent/TraceRecord" Severity="Information">  
                 <TraceIdentifier>http://msdn.microsoft.com/library/System.ServiceModel.Channels.MessageSent.aspx</TraceIdentifier>  
                 <Description>Sent a message over a channel.</Description>  
                 <AppDomain>client.exe</AppDomain>  
                 <Source>System.ServiceModel.Channels.ClientFramingDuplexSessionChannel/35191196</Source>  
                <ExtendedData xmlns="http://schemas.microsoft.com/2006/08/ServiceModel/MessageTransmitTraceRecord">  
  
                  <MessageProperties>  
                     <AllowOutputBatching>False</AllowOutputBatching>  
                  </MessageProperties>  
                  <MessageHeaders>  
                     <Action d4p1:mustUnderstand="1" xmlns:d4p1="http://www.w3.org/2003/05/soap-envelope" xmlns="http://www.w3.org/2005/08/addressing">http://Microsoft.ServiceModel.Samples/ICalculator/Multiply</Action>  
                     <MessageID xmlns="http://www.w3.org/2005/08/addressing">urn:uuid:7c6670d8-4c9c-496e-b6a0-2ceb6db35338</MessageID>  
                     <ActivityId CorrelationId="b02e2189-0816-4387-980c-dd8e306440f5" xmlns="http://schemas.microsoft.com/2004/09/ServiceModel/Diagnostics">27c6331d-8998-43aa-a382-03239013a6bd</ActivityId>  
                     <ReplyTo xmlns="http://www.w3.org/2005/08/addressing">  
                        <Address>http://www.w3.org/2005/08/addressing/anonymous</Address>  
                    </ReplyTo>  
                    <To d4p1:mustUnderstand="1" xmlns:d4p1="http://www.w3.org/2003/05/soap-envelope" xmlns="http://www.w3.org/2005/08/addressing">net.tcp://localhost/servicemodelsamples/service</To>  
                  </MessageHeaders>  
                  <RemoteAddress>net.tcp://localhost/servicemodelsamples/service</RemoteAddress>  
                </ExtendedData>  
            </TraceRecord>  
          </DataItem>  
       </TraceData>  
   </ApplicationData>  
</E2ETraceEvent>  
```  
  
## <a name="servicemodel-e2e-tracing"></a><span data-ttu-id="974b7-133">ServiceModel のエンドツーエンドのトレース</span><span class="sxs-lookup"><span data-stu-id="974b7-133">ServiceModel E2E Tracing</span></span>  
 <span data-ttu-id="974b7-134">ときに、`System.ServiceModel`トレース ソースを設定すると、 `switchValue` Off 以外と`ActivityTracing`WCF は、アクティビティおよび転送について WCF 処理を作成します。</span><span class="sxs-lookup"><span data-stu-id="974b7-134">When the `System.ServiceModel` trace source is set with a `switchValue` other than Off, and `ActivityTracing`, WCF creates activities and transfers for WCF processing.</span></span>  
  
 <span data-ttu-id="974b7-135">アクティビティとは、その処理単位に関連するすべてのトレースをグループ化する処理の論理単位です。</span><span class="sxs-lookup"><span data-stu-id="974b7-135">An activity is a logical unit of processing that groups all traces related to that processing unit.</span></span> <span data-ttu-id="974b7-136">たとえば、要求ごとに 1 つのアクティビティを定義できます。</span><span class="sxs-lookup"><span data-stu-id="974b7-136">For example, you can define one activity for each request.</span></span> <span data-ttu-id="974b7-137">転送により、エンドポイント内のアクティビティ間の因果関係が作成されます。</span><span class="sxs-lookup"><span data-stu-id="974b7-137">Transfers create a causal relationship between activities within endpoints.</span></span> <span data-ttu-id="974b7-138">アクティビティ ID を伝達することにより、エンドポイント間でアクティビティを関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="974b7-138">Propagating the activity ID enables you to relate activities across endpoints.</span></span> <span data-ttu-id="974b7-139">設定してこれ行う`propagateActivity` = `true`の各エンドポイントで構成します。</span><span class="sxs-lookup"><span data-stu-id="974b7-139">This can be done by setting `propagateActivity`=`true` in configuration at every endpoint.</span></span> <span data-ttu-id="974b7-140">アクティビティ、転送、および伝達により、エラーの関連付けを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="974b7-140">Activities, transfers, and propagation allow you to perform error correlation.</span></span> <span data-ttu-id="974b7-141">このようにして、エラーの根本原因をよりすばやく見つけることができるようになります。</span><span class="sxs-lookup"><span data-stu-id="974b7-141">In this way, you can find the root cause of an error more quickly.</span></span>  
  
 <span data-ttu-id="974b7-142">クライアントでは、1 つの WCF アクティビティが作成オブジェクト モデルの呼び出し (たとえば、Open ChannelFactory、Add、Divide などおよびなどです。)各操作呼び出しは、「プロセス アクション」アクティビティで処理されます。</span><span class="sxs-lookup"><span data-stu-id="974b7-142">On the client, one WCF activity is created for each object model call (for example, Open ChannelFactory, Add, Divide, and so on.) Each of the operation calls is processed in a "Process Action" activity.</span></span>  
  
 <span data-ttu-id="974b7-143">次のスクリーン ショットから抽出、[トレースとメッセージ ログ](../../../../../docs/framework/wcf/samples/tracing-and-message-logging.md)サンプル左側のパネルには、作成時刻順に並べ替えて、クライアントのプロセスで作成されたアクティビティの一覧が表示されます。</span><span class="sxs-lookup"><span data-stu-id="974b7-143">In the following screenshot, extracted from the [Tracing and Message Logging](../../../../../docs/framework/wcf/samples/tracing-and-message-logging.md) sample the left panel displays the list of activities created in the client process, sorted by creation time.</span></span> <span data-ttu-id="974b7-144">以下に、各アクティビティを時系列で示します。</span><span class="sxs-lookup"><span data-stu-id="974b7-144">The following is a chronological list of activities:</span></span>  
  
-   <span data-ttu-id="974b7-145">チャネル ファクトリ (ClientBase) を作成しました。</span><span class="sxs-lookup"><span data-stu-id="974b7-145">Constructed the channel factory (ClientBase).</span></span>  
  
-   <span data-ttu-id="974b7-146">チャネル ファクトリを開きました。</span><span class="sxs-lookup"><span data-stu-id="974b7-146">Opened the channel factory.</span></span>  
  
-   <span data-ttu-id="974b7-147">Add アクションを処理しました。</span><span class="sxs-lookup"><span data-stu-id="974b7-147">Processed the Add action.</span></span>  
  
-   <span data-ttu-id="974b7-148">セキュリティで保護されたセッションを設定し (これは最初の要求で発生します)、RST、RSTR、SCT (プロセス メッセージ 1、2、3) の 3 つのセキュリティ インフラストラクチャ応答メッセージを処理しました。</span><span class="sxs-lookup"><span data-stu-id="974b7-148">Set up the Secure Session (this OCCURRED on the first request) and processed three security infrastructure response messages: RST, RSTR, SCT (Process message 1, 2, 3).</span></span>  
  
-   <span data-ttu-id="974b7-149">Subtract、Multiply、および Divide の各要求を処理しました。</span><span class="sxs-lookup"><span data-stu-id="974b7-149">Processed the Subtract, Multiply, and Divide requests.</span></span>  
  
-   <span data-ttu-id="974b7-150">チャネル ファクトリを閉じ、これにより、セキュリティで保護されたセッションを閉じました。また、セキュリティ メッセージ応答の Cancel を処理しました。</span><span class="sxs-lookup"><span data-stu-id="974b7-150">Closed the channel factory, and doing so closed the Secure session and processed the security message response Cancel.</span></span>  
  
 <span data-ttu-id="974b7-151">セキュリティ インフラストラクチャ メッセージがあるのは、wsHttpBinding を使用しているためです。</span><span class="sxs-lookup"><span data-stu-id="974b7-151">We see the security infrastructure messages because of the wsHttpBinding.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="974b7-152">WCF では、説明、別のアクティビティ (プロセス メッセージ) で最初に処理する応答メッセージは転送を介して、要求メッセージが含まれる、対応するプロセス アクション アクティビティに関連付ける前にします。</span><span class="sxs-lookup"><span data-stu-id="974b7-152">In WCF, we show response messages being processed initially in a separate activity (Process message) before we correlate them to the corresponding Process Action activity that includes the request message, through a transfer.</span></span> <span data-ttu-id="974b7-153">これは、インフラストラクチャ メッセージと非同期要求に対して行います。非同期要求の場合、インフラストラクチャ メッセージを調べて activityId ヘッダーを確認し、該当の ID を持つ既存の "プロセス アクション" アクティビティを特定してこれに関連付ける必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="974b7-153">This happens for infrastructure messages and asynchronous requests and is due to the fact that we must inspect the message, read the activityId header, and identify the existing Process Action activity with that id to correlate to it.</span></span> <span data-ttu-id="974b7-154">同期要求の場合は、応答のためにブロックするため、応答を関連付けるプロセス アクションがわかります。</span><span class="sxs-lookup"><span data-stu-id="974b7-154">For synchronous requests, we are blocking for the response and hence know which Process action the response relates to.</span></span>  
  
 <span data-ttu-id="974b7-155">![トレース ビューアーを使用して](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace4.gif "e2eTrace4")</span><span class="sxs-lookup"><span data-stu-id="974b7-155">![Using the Trace Viewer](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace4.gif "e2eTrace4")</span></span>  
<span data-ttu-id="974b7-156">作成時刻に従って一覧表示された WCF クライアント アクティビティ (左のパネル)、および入れ子にされたアクティビティとトレース (右上のパネル)</span><span class="sxs-lookup"><span data-stu-id="974b7-156">WCF client activities listed by creation time (left panel) and their nested activities and traces (upper right panel)</span></span>  
  
 <span data-ttu-id="974b7-157">左のパネルでアクティビティを選択すると、右上のパネルに入れ子にされたアクティビティとトレースが表示されます。</span><span class="sxs-lookup"><span data-stu-id="974b7-157">When we select an activity in the left panel, we can see nested activities and traces on the upper right panel.</span></span> <span data-ttu-id="974b7-158">したがって、これは、選択した親アクティビティに基づいて、左側のアクティビティのリストの階層表示を減らしたものです。</span><span class="sxs-lookup"><span data-stu-id="974b7-158">Therefore, this is a reduced hierarchical view of the list of activities on the left, based on the selected parent activity.</span></span> <span data-ttu-id="974b7-159">選択した "プロセス アクション Add" は最初に作成された要求であるため、このアクティビティには、"セキュリティで保護されたセッションの設定" アクティビティ (転送先と返送元) と、Add アクションの実際の処理のトレースが含まれます。</span><span class="sxs-lookup"><span data-stu-id="974b7-159">Because the selected Process action Add is the first request made, this activity contains the Set Up Secure Session activity (transfer to, transfer back from), and traces for the actual processing of the Add action.</span></span>  
  
 <span data-ttu-id="974b7-160">左側のパネルでの活動の追加プロセス アクション ダブルクリックすると場合、Add に関連するクライアント WCF アクティビティのグラフィック表示がわかります。</span><span class="sxs-lookup"><span data-stu-id="974b7-160">If we double click the Process action Add activity in the left panel, we can see a graphical representation of the client WCF activities related to Add.</span></span> <span data-ttu-id="974b7-161">左の最初のアクティビティがルート アクティビティ (0000) であり、既定のアクティビティです。</span><span class="sxs-lookup"><span data-stu-id="974b7-161">The first activity on the left is the root activity (0000), which is the default activity.</span></span> <span data-ttu-id="974b7-162">WCF は、アンビエント アクティビティから転送します。</span><span class="sxs-lookup"><span data-stu-id="974b7-162">WCF transfers out of the ambient activity.</span></span> <span data-ttu-id="974b7-163">定義されていない場合、WCF は 0000 から転送します。</span><span class="sxs-lookup"><span data-stu-id="974b7-163">If this is not defined, WCF transfers out of 0000.</span></span> <span data-ttu-id="974b7-164">ここでは、2 番目のアクティビティである "プロセス アクション Add" が 0 から転送します。</span><span class="sxs-lookup"><span data-stu-id="974b7-164">Here, the second activity, Process Action Add, transfers out of 0.</span></span> <span data-ttu-id="974b7-165">次に、"セキュリティで保護されたセッションの設定" が示されています。</span><span class="sxs-lookup"><span data-stu-id="974b7-165">Then we see Setup Secure Session.</span></span>  
  
 <span data-ttu-id="974b7-166">![トレース ビューアーを使用して](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace5.gif "e2eTrace5")</span><span class="sxs-lookup"><span data-stu-id="974b7-166">![Using the Trace Viewer](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace5.gif "e2eTrace5")</span></span>  
<span data-ttu-id="974b7-167">WCF クライアント アクティビティのグラフ ビュー: アンビエント アクティビティ (ここでは 0)、プロセス アクション、およびセキュリティで保護されたセッションの設定</span><span class="sxs-lookup"><span data-stu-id="974b7-167">Graph view of WCF client activities: Ambient Activity (here 0), Process action, and Set Up Secure Session</span></span>  
  
 <span data-ttu-id="974b7-168">右上のパネルでは、"プロセス アクション Add" アクティビティに関連するすべてのトレースを確認できます。</span><span class="sxs-lookup"><span data-stu-id="974b7-168">On the upper right panel, we can see all traces related to the Process Action Add activity.</span></span> <span data-ttu-id="974b7-169">具体的には、同じアクティビティで、要求メッセージ ("チャネル経由でメッセージを送信しました") を送信し、応答 ("チャネル経由でメッセージを受信しました") を受け取っています。</span><span class="sxs-lookup"><span data-stu-id="974b7-169">Specifically, we have sent the request message ("Sent a message over a channel") and received the response ("Received a message over a channel") in the same activity.</span></span> <span data-ttu-id="974b7-170">これを次のグラフに示します。</span><span class="sxs-lookup"><span data-stu-id="974b7-170">This is shown in the following graph.</span></span> <span data-ttu-id="974b7-171">わかりやすくするために、このグラフでは、"セキュリティで保護されたセッションの設定" アクティビティを折りたたんでいます。</span><span class="sxs-lookup"><span data-stu-id="974b7-171">For clarity, the Set up Secure Session activity is collapsed in the graph.</span></span>  
  
 <span data-ttu-id="974b7-172">![トレース ビューアーを使用して](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace6.gif "e2eTrace6")</span><span class="sxs-lookup"><span data-stu-id="974b7-172">![Using the Trace Viewer](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace6.gif "e2eTrace6")</span></span>  
<span data-ttu-id="974b7-173">"プロセス アクション" アクティビティのトレースのリスト: 同じアクティビティで要求を送信し、応答を受信します。</span><span class="sxs-lookup"><span data-stu-id="974b7-173">List of traces for the Process Action activity: we send the request and receive the response in the same activity.</span></span>  
  
 <span data-ttu-id="974b7-174">ここでは、わかりやすくするため、クライアントのトレースのみを読み込むことがツールに読み込みしてもいる場合に、サービス トレース (受信した要求メッセージと送信される応答メッセージ) が同じアクティビティに表示し、`propagateActivity`に設定された`true.`後ほど図に表示されます。</span><span class="sxs-lookup"><span data-stu-id="974b7-174">Here, we load client traces only for clarity, but service traces (request message received and response message sent) appear in the same activity if they are also loaded in the tool and `propagateActivity` was set to `true.` This is shown in a later illustration.</span></span>  
  
 <span data-ttu-id="974b7-175">サービスで、アクティビティ モデルようにマップする WCF の概念。</span><span class="sxs-lookup"><span data-stu-id="974b7-175">On the service, the activity model maps to the WCF concepts as follows:</span></span>  
  
1.  <span data-ttu-id="974b7-176">ServiceHost を作成して開きます (たとえば、セキュリティの場合、複数のホスト関連アクティビティを作成できます)。</span><span class="sxs-lookup"><span data-stu-id="974b7-176">We construct and open a ServiceHost (this may create several host-related activities, for instance, in the case of security).</span></span>  
  
2.  <span data-ttu-id="974b7-177">ServiceHost のリスナーごとに "リッスン" アクティビティを作成します (Open ServiceHost との間の転送を使用)。</span><span class="sxs-lookup"><span data-stu-id="974b7-177">We create a Listen At activity for each listener in the ServiceHost (with transfers in and out of Open ServiceHost).</span></span>  
  
3.  <span data-ttu-id="974b7-178">リスナーは、クライアントが開始した通信要求を検出すると、クライアントから送信されたすべてのバイトが処理される、「バイトを受信」アクティビティに転送します。</span><span class="sxs-lookup"><span data-stu-id="974b7-178">When the listener detects a communication request initiated by the client, it transfers to a "Receive Bytes" activity, in which all bytes sent from the client are processed.</span></span> <span data-ttu-id="974b7-179">このアクティビティでは、クライアントとサーバーの対話中に発生したすべての接続エラーを確認できます。</span><span class="sxs-lookup"><span data-stu-id="974b7-179">In this activity, we can see any connection errors that have happened during the client-service interaction.</span></span>  
  
4.  <span data-ttu-id="974b7-180">セットごとに受信されるバイトのメッセージに対応する、処理、「プロセス メッセージ」アクティビティでこれらのバイト WCF メッセージ オブジェクトを作成しました。</span><span class="sxs-lookup"><span data-stu-id="974b7-180">For each set of bytes that is received that corresponds to a message, we process these bytes in a "Process Message" activity, where we create the WCF Message object.</span></span> <span data-ttu-id="974b7-181">このアクティビティでは、不正なエンベロープや誤った形式のメッセージに関連するエラーを確認できます。</span><span class="sxs-lookup"><span data-stu-id="974b7-181">In this activity, we see errors related to a bad envelope or a malformed message.</span></span>  
  
5.  <span data-ttu-id="974b7-182">メッセージが作成されたら、"プロセス アクション" アクティビティに転送します。</span><span class="sxs-lookup"><span data-stu-id="974b7-182">Once the message is formed, we transfer to a Process Action activity.</span></span> <span data-ttu-id="974b7-183">クライアントとサービスの両方で、`propagateActivity` が `true` に設定されている場合、既に説明したように、このアクティビティはクライアントに定義されている ID と同じ ID を持ちます。</span><span class="sxs-lookup"><span data-stu-id="974b7-183">If `propagateActivity` is set to `true` on both the client and service, this activity has the same id as the one defined in the client, and described previously.</span></span> <span data-ttu-id="974b7-184">このステージから利点を得る直接的な相関関係から、エンドポイント間で要求に関連付けられている、WCF で出力されたすべてのトレースが応答メッセージ処理も含め、その同じアクティビティであるためです。</span><span class="sxs-lookup"><span data-stu-id="974b7-184">From this stage we start to benefit from direct correlation across endpoints, because all traces emitted in WCF that are related to the request are in that same activity, including the response message processing.</span></span>  
  
6.  <span data-ttu-id="974b7-185">アウト プロセス操作 で、WCF で出力されるからユーザー コードで出力されるトレースを分離する「ユーザー コードを実行」アクティビティを作成します。</span><span class="sxs-lookup"><span data-stu-id="974b7-185">For out-of-process action, we create an "Execute user code" activity to isolate traces emitted in user code from the ones emitted in WCF.</span></span> <span data-ttu-id="974b7-186">上記の例では、該当する場合に「サービスが Add 応答を送信します」トレースは、クライアントによって伝達されたアクティビティではなく、「ユーザー コードを実行」アクティビティで出力されます。</span><span class="sxs-lookup"><span data-stu-id="974b7-186">In the preceding example, the "Service sends Add response" trace is emitted in the "Execute User code" activity not in the activity propagated by the client, if applicable.</span></span>  
  
 <span data-ttu-id="974b7-187">次の図では、左の最初のアクティビティがルート アクティビティ (0000) であり、既定のアクティビティです。</span><span class="sxs-lookup"><span data-stu-id="974b7-187">In the illustration that follows, the first activity on the left is the root activity (0000), which is the default activity.</span></span> <span data-ttu-id="974b7-188">次の 3 つのアクティビティは、ServiceHost を開くためのアクティビティです。</span><span class="sxs-lookup"><span data-stu-id="974b7-188">The next three activities are to open the ServiceHost.</span></span> <span data-ttu-id="974b7-189">5 列目のアクティビティはリスナーです。残りのアクティビティ (6 ～ 8 列目) は、バイト処理からユーザー コードのアクティブ化までの、WCF でのメッセージ処理を示しています。</span><span class="sxs-lookup"><span data-stu-id="974b7-189">The activity in column 5 is the listener, and the remaining activities (6 to 8) describe the WCF processing of a message, from bytes processing to user code activation.</span></span>  
  
 <span data-ttu-id="974b7-190">![トレース ビューアーを使用して](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace7.gif "e2eTrace7")</span><span class="sxs-lookup"><span data-stu-id="974b7-190">![Using the Trace Viewer](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace7.gif "e2eTrace7")</span></span>  
<span data-ttu-id="974b7-191">WCF サービス アクティビティのリスト</span><span class="sxs-lookup"><span data-stu-id="974b7-191">List of WCF service activities</span></span>  
  
 <span data-ttu-id="974b7-192">次のスクリーンショットは、クライアントとサービスの両方のアクティビティを示しています。プロセス全体にわたり、"プロセス アクション Add" アクティビティはオレンジで強調表示されています。</span><span class="sxs-lookup"><span data-stu-id="974b7-192">The following screenshot shows the activities for both the client and service, and highlights the Process Action Add activity across processes (orange).</span></span> <span data-ttu-id="974b7-193">矢印は、クライアントとサービスによって送受信された要求メッセージと応答メッセージを関連付けています。</span><span class="sxs-lookup"><span data-stu-id="974b7-193">Arrows relate the request and response messages sent and received by the client and service.</span></span> <span data-ttu-id="974b7-194">このグラフでは、"プロセス アクション" のトレースはプロセス間で分かれていますが、右上のパネルには同じアクティビティの一部として示されています。</span><span class="sxs-lookup"><span data-stu-id="974b7-194">The traces of Process Action are separated across processes in the graph, but shown as part of the same activity in the upper-right panel.</span></span> <span data-ttu-id="974b7-195">このパネルには、送信されたメッセージのクライアント トレースの後に、受信および処理されたメッセージのサービス トレースが表示されています。</span><span class="sxs-lookup"><span data-stu-id="974b7-195">In this panel, we can see client traces for sent messages followed by service traces for received and processed messages.</span></span>  
  
 <span data-ttu-id="974b7-196">![トレース ビューアーを使用して](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace8.gif "e2eTrace8")</span><span class="sxs-lookup"><span data-stu-id="974b7-196">![Using the Trace Viewer](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace8.gif "e2eTrace8")</span></span>  
<span data-ttu-id="974b7-197">WCF クライアント アクティビティとサービス アクティビティのグラフ ビュー</span><span class="sxs-lookup"><span data-stu-id="974b7-197">Graph view of both WCF client and service activities</span></span>  
  
 <span data-ttu-id="974b7-198">次のエラー シナリオでは、サービスとクライアントのエラー トレースおよび警告トレースが関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="974b7-198">In the following error scenario, error and warning traces at the service and client are related.</span></span> <span data-ttu-id="974b7-199">サービスのユーザー コードで最初に例外がスローされています ("サービスはユーザー コードでこの要求を処理できません" という例外の警告トレースを含む右端の緑のアクティビティ)。</span><span class="sxs-lookup"><span data-stu-id="974b7-199">An exception is first thrown in user code on the service (right-most green activity that includes a warning trace for the exception "The service cannot process this request in user code.").</span></span> <span data-ttu-id="974b7-200">クライアントに応答が送信されると、警告トレースが再度出力されて、エラー メッセージが表示されます (左のピンクのアクティビティ)。</span><span class="sxs-lookup"><span data-stu-id="974b7-200">When the response is sent to the client, a warning trace is again emitted to denote the fault message (left pink activity).</span></span> <span data-ttu-id="974b7-201">その後、クライアントは WCF クライアントを閉じます (左下の黄色のアクティビティ)。これにより、サービスへの接続が中止されます。</span><span class="sxs-lookup"><span data-stu-id="974b7-201">The client then closes its WCF client (yellow activity on the lower-left side), which aborts the connection to the service.</span></span> <span data-ttu-id="974b7-202">サービスはエラーをスローします (右側の最も長いピンクのアクティビティ)。</span><span class="sxs-lookup"><span data-stu-id="974b7-202">The service throws an error (longest pink activity on the right).</span></span>  
  
 <span data-ttu-id="974b7-203">![トレース ビューアーを使用して](../../../../../docs/framework/wcf/diagnostics/tracing/media/wcfc-e2etrace9s.gif "wcfc_e2etrace9s")</span><span class="sxs-lookup"><span data-stu-id="974b7-203">![Using the Trace Viewer](../../../../../docs/framework/wcf/diagnostics/tracing/media/wcfc-e2etrace9s.gif "wcfc_e2etrace9s")</span></span>  
<span data-ttu-id="974b7-204">サービスとクライアント間のエラーの相関関係</span><span class="sxs-lookup"><span data-stu-id="974b7-204">Error correlation across the service and client</span></span>  
  
 <span data-ttu-id="974b7-205">これらのトレースの生成に使用したサンプルは、wsHttpBinding を使用する一連の同期要求です。</span><span class="sxs-lookup"><span data-stu-id="974b7-205">The sample used to generate these traces is a series of synchronous requests using the wsHttpBinding.</span></span> <span data-ttu-id="974b7-206">セキュリティを使用しないシナリオ、または非同期要求を使用するシナリオの場合は、このグラフとは違う部分があります。非同期要求の場合、"プロセス アクション" アクティビティは、非同期呼び出しを構成する開始操作と終了操作の間に配置され、コールバック アクティビティへの転送が示されます。</span><span class="sxs-lookup"><span data-stu-id="974b7-206">There are deviations from this graph for scenarios without security, or with asynchronous requests, where the Process Action activity encompasses the begin and end operations that constitute the asynchronous call, and shows transfers to a callback activity.</span></span> <span data-ttu-id="974b7-207">その他のシナリオの詳細については、次を参照してください。[エンド ツー エンドのトレースのシナリオ](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md)です。</span><span class="sxs-lookup"><span data-stu-id="974b7-207">For more information about additional scenarios, see [End-To-End Tracing Scenarios](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md).</span></span>  
  
## <a name="troubleshooting-using-the-service-trace-viewer"></a><span data-ttu-id="974b7-208">サービス トレース ビューアーを使用したトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="974b7-208">Troubleshooting Using the Service Trace Viewer</span></span>  
 <span data-ttu-id="974b7-209">サービス トレース ビューアー ツールにトレース ファイルを読み込むと、左のパネルの赤または黄色のアクティビティを選択することによって、アプリケーションの問題の原因を突き止めることができます。</span><span class="sxs-lookup"><span data-stu-id="974b7-209">When you load trace files in the Service Trace Viewer Tool, you can select any red or yellow activity on the left panel to track down the cause of a problem in your application.</span></span> <span data-ttu-id="974b7-210">通常、000 アクティビティには、ユーザーにバブリングする未処理の例外が含まれます。</span><span class="sxs-lookup"><span data-stu-id="974b7-210">The 000 activity typically has unhandled exceptions that bubble up to the user.</span></span>  
  
 <span data-ttu-id="974b7-211">![トレース ビューアーを使用して](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace10.gif "e2eTrace10")</span><span class="sxs-lookup"><span data-stu-id="974b7-211">![Using the Trace Viewer](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace10.gif "e2eTrace10")</span></span>  
<span data-ttu-id="974b7-212">赤または黄色のアクティビティを選択して問題の原因を特定します。</span><span class="sxs-lookup"><span data-stu-id="974b7-212">Selecting red or yellow activity to locate the root of a problem</span></span>  
  
 <span data-ttu-id="974b7-213">右上のパネルでは、左側で選択したアクティビティのトレースを調べることができます。</span><span class="sxs-lookup"><span data-stu-id="974b7-213">On the upper right panel, you can examine traces for the activity you selected on the left.</span></span> <span data-ttu-id="974b7-214">このパネルで赤または黄色のトレースを調べ、それらがどのように関連しているかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="974b7-214">You can then examine red or yellow traces in that panel and see how they are correlated.</span></span> <span data-ttu-id="974b7-215">前のグラフで、同じ "プロセス アクション" アクティビティのクライアントとサービスの警告トレースを確認します。</span><span class="sxs-lookup"><span data-stu-id="974b7-215">In the preceding graph, we see warning traces both for the client and service in the same Process Action activity.</span></span>  
  
 <span data-ttu-id="974b7-216">これらのトレースからエラーの根本原因がわからない場合は、左のパネルで選択したアクティビティ (ここでは "プロセス アクション") をダブルクリックすることでグラフを利用できます。</span><span class="sxs-lookup"><span data-stu-id="974b7-216">If these traces do not provide you with the root cause of the error, you can utilize the graph by double-clicking the selected activity on the left panel (here Process action).</span></span> <span data-ttu-id="974b7-217">関連アクティビティが含まれたグラフが表示されます。</span><span class="sxs-lookup"><span data-stu-id="974b7-217">The graph with related activities is then displayed.</span></span> <span data-ttu-id="974b7-218">(「+」記号をクリック) して関連アクティビティを展開することができますを赤または黄色、関連アクティビティで最初に出力されたトレースを検索します。</span><span class="sxs-lookup"><span data-stu-id="974b7-218">You can then expand related activities (by clicking the "+" signs) to find the first emitted trace in red or yellow in a related activity.</span></span> <span data-ttu-id="974b7-219">調べる対象の赤または黄色のトレースの直前に発生したアクティビティを展開し、エンドポイント間の関連アクティビティまたはメッセージ フローをたどって問題の根本原因を突き止めます。</span><span class="sxs-lookup"><span data-stu-id="974b7-219">Keep expanding the activities that happened just before the red or yellow trace of interest, following transfers to related activities or message flows across endpoints, until you track the root cause of the problem.</span></span>  
  
 <span data-ttu-id="974b7-220">![トレース ビューアーを使用して](../../../../../docs/framework/wcf/diagnostics/tracing/media/wcfc-e2etrace9s.gif "wcfc_e2etrace9s")</span><span class="sxs-lookup"><span data-stu-id="974b7-220">![Using the Trace Viewer](../../../../../docs/framework/wcf/diagnostics/tracing/media/wcfc-e2etrace9s.gif "wcfc_e2etrace9s")</span></span>  
<span data-ttu-id="974b7-221">アクティビティを展開して問題の根本原因を追跡します。</span><span class="sxs-lookup"><span data-stu-id="974b7-221">Expanding activities to track the root cause of a problem</span></span>  
  
 <span data-ttu-id="974b7-222">ServiceModel の `ActivityTracing` が無効になっていても、ServiceModel トレースが有効であれば、0000 アクティビティで出力された ServiceModel のトレースを確認できます。</span><span class="sxs-lookup"><span data-stu-id="974b7-222">If ServiceModel `ActivityTracing` is off but ServiceModel tracing is on, you can see ServiceModel traces emitted in the 0000 activity.</span></span> <span data-ttu-id="974b7-223">ただし、この場合、これらのトレースの相関関係を理解するには多くの労力を必要とします。</span><span class="sxs-lookup"><span data-stu-id="974b7-223">However, this requires more effort to understand the correlation of these traces.</span></span>  
  
 <span data-ttu-id="974b7-224">メッセージ ログを有効にすると、[メッセージ] タブを使用してエラーの影響を受けるメッセージを確認できます。</span><span class="sxs-lookup"><span data-stu-id="974b7-224">If Message Logging is enabled, you can use the Message Tab to see which message is impacted by the error.</span></span> <span data-ttu-id="974b7-225">赤または黄色のメッセージをダブルクリックすると、関連アクティビティのグラフ ビューを表示できます。</span><span class="sxs-lookup"><span data-stu-id="974b7-225">By double-clicking a message in red or yellow, you can see the graph view of the related activities.</span></span> <span data-ttu-id="974b7-226">これらのアクティビティは、エラーが発生した要求に最も密接に関連するアクティビティです。</span><span class="sxs-lookup"><span data-stu-id="974b7-226">These activities are the ones most closely related to the request where an error happened.</span></span>  
  
 <span data-ttu-id="974b7-227">![トレース ビューアーを使用して](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace11.gif "e2eTrace11")</span><span class="sxs-lookup"><span data-stu-id="974b7-227">![Using the Trace Viewer](../../../../../docs/framework/wcf/diagnostics/tracing/media/e2etrace11.gif "e2eTrace11")</span></span>  
<span data-ttu-id="974b7-228">トラブルシューティングを開始するには、赤または黄色のメッセージ トレースを選択し、これをダブルクリックして根本原因を追跡します。</span><span class="sxs-lookup"><span data-stu-id="974b7-228">To start troubleshooting, you can also pick a red or yellow message trace and double click it to track the root cause</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="974b7-229">関連項目</span><span class="sxs-lookup"><span data-stu-id="974b7-229">See Also</span></span>  
 [<span data-ttu-id="974b7-230">エンドツーエンドのトレースのシナリオ</span><span class="sxs-lookup"><span data-stu-id="974b7-230">End-To-End Tracing Scenarios</span></span>](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md)  
 [<span data-ttu-id="974b7-231">サービス トレース ビューアー ツール (SvcTraceViewer.exe)</span><span class="sxs-lookup"><span data-stu-id="974b7-231">Service Trace Viewer Tool (SvcTraceViewer.exe)</span></span>](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)  
 [<span data-ttu-id="974b7-232">トレース</span><span class="sxs-lookup"><span data-stu-id="974b7-232">Tracing</span></span>](../../../../../docs/framework/wcf/diagnostics/tracing/index.md)
