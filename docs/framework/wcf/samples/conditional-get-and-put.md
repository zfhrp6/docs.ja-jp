---
title: 条件付きの Get と Put
ms.date: 03/30/2017
ms.assetid: 3d22067f-57b8-4e0f-a571-a694512187ae
ms.openlocfilehash: f2d170da80de1186aa41b4821da52d58a0bb0e0e
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/04/2018
---
# <a name="conditional-get-and-put"></a><span data-ttu-id="e5cc1-102">条件付きの Get と Put</span><span class="sxs-lookup"><span data-stu-id="e5cc1-102">Conditional Get and Put</span></span>
<span data-ttu-id="e5cc1-103">このサンプルでは、新しい条件付きの取得 API と更新 API を WCF REST プログラミング モデルで使用する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-103">This sample demonstrates how to use the new conditional retrieve and update APIs for the WCF REST programming model.</span></span> <span data-ttu-id="e5cc1-104">条件付きの取得と更新プログラムに最も適したためリソース指向の REST サービスでは、このサンプルを拡張し、[基本的なリソース サービス](../../../../docs/framework/wcf/samples/basic-resource-service.md)サンプルです。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-104">Because conditional retrieve and update are most appropriate for resource-oriented and REST services, this sample extends the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="e5cc1-105">このサンプルでは、条件付きの取得と更新のサポートの追加、[基本的なリソース サービス](../../../../docs/framework/wcf/samples/basic-resource-service.md)で導入された新しい Api を使用してサンプル[!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]です。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-105">This sample focuses on adding support for conditional retrieve and update to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample using the new APIs introduced in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="e5cc1-106">使用例</span><span class="sxs-lookup"><span data-stu-id="e5cc1-106">Demonstrates</span></span>  
 <span data-ttu-id="e5cc1-107">条件付きの取得と更新</span><span class="sxs-lookup"><span data-stu-id="e5cc1-107">Conditional Retrieve and Update</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="e5cc1-108">説明</span><span class="sxs-lookup"><span data-stu-id="e5cc1-108">Discussion</span></span>  
 <span data-ttu-id="e5cc1-109">このサンプルの WCF サービスでは、リソース指向の REST 方式で顧客のコレクションが公開されます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-109">The WCF service in this sample exposes a collection of customers in a resource-oriented and REST manner.</span></span> <span data-ttu-id="e5cc1-110">サービス実装の詳細についてを参照してください、[基本的なリソース サービス](../../../../docs/framework/wcf/samples/basic-resource-service.md)サンプルです。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-110">For a detailed description of the service implementation, please see the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span>  
  
 <span data-ttu-id="e5cc1-111">このサンプルは、条件付きの取得と更新機能を追加、[基本的なリソース サービス](../../../../docs/framework/wcf/samples/basic-resource-service.md)サンプルです。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-111">This sample adds conditional retrieve and update capabilities to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="e5cc1-112">条件付きの取得と更新では、HTTP のエンティティ タグと HTTP の If-None-Match ヘッダーおよび If-Match ヘッダーを使用して、指定されたリソースの最新のエンティティがクライアントにあるかどうかを検証します。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-112">Conditional retrieve and update use HTTP entity tags and the HTTP If-None-Match and If-Match headers to validate that clients either have or do not have the most current entity for a given resource.</span></span> <span data-ttu-id="e5cc1-113">しかし、HTTP の If-None-Match ヘッダーと If-Match ヘッダーを正しく解析するコードを実装することは、面倒であるだけでなく間違いの元にもなります。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-113">However, implementing the code to correctly parse the HTTP If-None-Match and If-Match headers can be tedious and error-prone.</span></span> <span data-ttu-id="e5cc1-114">そのため、<xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> に <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> メソッドと <xref:System.ServiceModel.Web.IncomingWebRequestContext> メソッドが追加され、<xref:System.ServiceModel.Web.WebOperationContext> の現在のインスタンスを使用してアクセスできるようになっています。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-114">Therefore, the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> and <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> methods have been added to the <xref:System.ServiceModel.Web.IncomingWebRequestContext>, which can be accessed using the current instance of the <xref:System.ServiceModel.Web.WebOperationContext>.</span></span> <span data-ttu-id="e5cc1-115">さらに、`SetETag` に <xref:System.ServiceModel.Web.OutgoingWebRequestContext> メソッドが追加されているため、有効なエンティティ タグを返すのも簡単になります。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-115">In addition, the `SetETag` method has been added to the <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, making it easier to return valid entity tags.</span></span>  
  
 <span data-ttu-id="e5cc1-116"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> メソッドは、[WebGet] 操作で使用されることを想定しています。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-116">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method is intended to be used with [WebGet] operations.</span></span> <span data-ttu-id="e5cc1-117">このメソッドは、指定されたリソースの現在のエンティティ タグを `entityTag` パラメーターとして取得します。これは、`string`、`int`、`long`、または `Guid` のいずれかになります。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-117">It takes the current entity tag for the given resource as the `entityTag` parameter, which can be a `string`, `int`, `long` or `Guid`.</span></span> <span data-ttu-id="e5cc1-118"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> メソッドは、エンティティ タグを要求の HTTP If-None-Match ヘッダーと照合してチェックします。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-118">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method checks the entity tag against the HTTP If-None-Match header of the request.</span></span> <span data-ttu-id="e5cc1-119">エンティティ タグが HTTP If-None-Match ヘッダーにある場合、ステータス コード 304 (変更なし) が設定された <xref:System.ServiceModel.Web.WebFaultException> がスローされます。それ以外の場合は、メソッドから制御が戻ります。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-119">If the entity tag is present in the HTTP If-None-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Not Modified (304) is thrown; otherwise the method returns.</span></span> <span data-ttu-id="e5cc1-120">条件付きの取得メカニズムでは、クライアントからサーバーにそのエンティティを持っていることを通知し、クライアントがまだ現在のエンティティを持っていない場合にのみエンティティを送信することができます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-120">The conditional retrieve mechanism allows the client to tell the server that it has this entity and to only send the current entity if the client does not already have it.</span></span> <span data-ttu-id="e5cc1-121"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> メソッドの使用例は、サービスの `GetCustomer` 操作および `GetCustomers` 操作で確認できます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-121">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method can be seen in the `GetCustomer` and `GetCustomers` operations of the service.</span></span> <span data-ttu-id="e5cc1-122"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> の呼び出しは戻らない場合があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-122">It is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> may not return.</span></span> <span data-ttu-id="e5cc1-123">そのため、操作を実装するときは、<xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> の呼び出しの実行前に、要求が成功することがわかるようにする必要があります。そうすることで、<xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> の呼び出しがなかった場合でも、成功を示すステータス コードが設定された応答がサービスから送信されます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-123">Developers should implement the operation so that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> was not present, the service would send a response with a successful status code.</span></span>  
  
 <span data-ttu-id="e5cc1-124"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> メソッドは、<xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> メソッドに似ています。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-124">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method is similar to the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method.</span></span> <span data-ttu-id="e5cc1-125">このメソッドも、指定されたリソースの現在のエンティティ タグを取得します。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-125">It also takes the current entity tag for the given resource.</span></span> <span data-ttu-id="e5cc1-126">ただし、メソッドは、メソッドが"PUT"または"DELETE"に設定されている [WebInvoke] 操作で使用するものでは。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-126">However, it is intended to be used with [WebInvoke] operations in which the method is set to "PUT" or "DELETE".</span></span> <span data-ttu-id="e5cc1-127"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> メソッドは、エンティティ タグを要求の HTTP If-Match ヘッダーと照合してチェックします。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-127">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method checks the entity tag against the HTTP If-Match header of the request.</span></span> <span data-ttu-id="e5cc1-128">エンティティ タグが HTTP If-Match ヘッダーにない場合、ステータス コード 412 (必須条件に失敗しました) が設定された <xref:System.ServiceModel.Web.WebFaultException> がスローされます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-128">If the entity tag is not present in the HTTP If-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Precondition Failed (412) is thrown.</span></span> <span data-ttu-id="e5cc1-129">条件付きの更新メカニズムでは、クライアントからサーバーにリソースのそのエンティティを持っていることを通知し、クライアントが現在のエンティティを持っている場合にのみリソースの変更を許可することができます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-129">The conditional update mechanism allows the client to tell the server that it has this entity for the resource and to only allow the client to alter the resource; if the entity it has is current.</span></span> <span data-ttu-id="e5cc1-130"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> メソッドの使用例は、サービスの `UpdateCustomer` 操作および `DeleteCustomer` 操作で確認できます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-130">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method can be seen in the `UpdateCustomer` and `DeleteCustomer` operations of the service.</span></span> <span data-ttu-id="e5cc1-131"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> と同様に、<xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> の呼び出しは戻らない場合があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-131">Just as with <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, it is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> may not return.</span></span> <span data-ttu-id="e5cc1-132">そのため、操作を実装するときは、<xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> の呼び出しの実行前に、要求が成功することがわかるようにする必要があります。そうすることで、<xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> の呼び出しがなかった場合でも、成功を示すステータス コードがサービスから返されます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-132">Developers should implement the operation such that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> was not present, the service would respond with a successful status code.</span></span>  
  
 <span data-ttu-id="e5cc1-133">このサンプルは、コンソール アプリケーション内で実行される自己ホスト型サービスとクライアントで構成されています。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-133">The sample consists of a self-hosted service and a client that runs within a console application.</span></span> <span data-ttu-id="e5cc1-134">コンソール アプリケーションが実行されると、クライアントはサービスに要求を発行し、応答からの適切な情報をコンソール ウィンドウに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-134">As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="e5cc1-135">サンプルを実行するには</span><span class="sxs-lookup"><span data-stu-id="e5cc1-135">To run the sample</span></span>  
  
1.  <span data-ttu-id="e5cc1-136">条件付きの Get と Put のサンプルのソリューションを開きます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-136">Open the solution for the Conditional Get and Put sample.</span></span> <span data-ttu-id="e5cc1-137">サンプルを正しく実行するには、[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] を起動するときに、管理者として実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-137">When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator to execute the sample successfully.</span></span> <span data-ttu-id="e5cc1-138">これには、右クリックし、[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]アイコンをクリックして選択する**管理者として実行**コンテキスト メニュー。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-138">Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and choosing **Run as Administrator** from the context menu.</span></span>  
  
2.  <span data-ttu-id="e5cc1-139">Ctrl キーと Shift キーを押しながら B キーを押してソリューションをビルドし、Ctrl キーを押しながら F5 キーを押してコンソール アプリケーション プロジェクトを実行します。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-139">Press CTRL+SHIFT+B to build the solution and then press CTRL+F5 to run the console application project.</span></span> <span data-ttu-id="e5cc1-140">デバッグを有効にしてこのプロジェクトを実行する場合 (Ctrl キーと F5 キーではなく F5 キーだけを押した場合) は、条件付きの GET および PUT のチェックで例外がスローされるとデバッガーが停止します。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-140">If running this project with debugging enabled (by pressing F5 instead of CTRL+F5), the debugger stops when an exception is thrown by the conditional GET and PUT checking.</span></span> <span data-ttu-id="e5cc1-141">停止した場合、サンプルの実行を続けるには F5 キーを押してください。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-141">When this happens, press F5 to continue executing the sample.</span></span>  
  
3.  <span data-ttu-id="e5cc1-142">コンソール ウィンドウが表示されて、実行中のサービスの URI および実行中のサービスの HTML ヘルプ ページの URI が示されます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-142">The console window appear sand provides the URI of the running service and the URI of the HTML help page for the running service.</span></span>  
  
4.  <span data-ttu-id="e5cc1-143">サンプルが実行されると、クライアントは要求をサービスに送信し、応答をコンソール ウィンドウに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-143">As the sample runs, the client sends requests to the service and writes the responses to the console window.</span></span>  
  
5.  <span data-ttu-id="e5cc1-144">任意のキーを押して、サンプルを終了します。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-144">Press any key to terminate the sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="e5cc1-145">サンプルは、既にコンピューターにインストールされている場合があります。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-145">The samples may already be installed on your machine.</span></span> <span data-ttu-id="e5cc1-146">続行する前に、次の (既定の) ディレクトリを確認してください。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-146">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="e5cc1-147">このディレクトリが存在しない場合に、 [Windows Communication Foundation (WCF) および .NET Framework 4 向けの Windows Workflow Foundation (WF) サンプル](http://go.microsoft.com/fwlink/?LinkId=150780)すべて Windows Communication Foundation (WCF) をダウンロードして[!INCLUDE[wf1](../../../../includes/wf1-md.md)]サンプルです。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-147">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="e5cc1-148">このサンプルは、次のディレクトリに格納されます。</span><span class="sxs-lookup"><span data-stu-id="e5cc1-148">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Web\ConditionalGetAndPut`
