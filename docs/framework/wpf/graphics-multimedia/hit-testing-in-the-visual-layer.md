---
title: ビジュアル層でのヒット テスト
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- hit testing functionality [WPF]
- visual layer [WPF], hit testing functionality
ms.assetid: b1a64b61-14be-4d75-b89a-5c67bebb2c7b
ms.openlocfilehash: 60da11af51722e86a61c5e3298fafba2221f000b
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/04/2018
ms.locfileid: "33558110"
---
# <a name="hit-testing-in-the-visual-layer"></a><span data-ttu-id="1f52b-102">ビジュアル層でのヒット テスト</span><span class="sxs-lookup"><span data-stu-id="1f52b-102">Hit Testing in the Visual Layer</span></span>
<span data-ttu-id="1f52b-103">ここでは、ビジュアル層で提供されるヒット テスト機能の概要について説明します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-103">This topic provides an overview of hit testing functionality provided by the visual layer.</span></span> <span data-ttu-id="1f52b-104">ヒット テストのサポートでは、geometry 型またはポイントの値の表示内容内かどうかを確認することができます、 <xref:System.Windows.Media.Visual>、複数のオブジェクトを選択する四角形を描くなどのユーザー インターフェイスの動作を実装することができます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-104">Hit testing support allows you to determine whether a geometry or point value falls within the rendered content of a <xref:System.Windows.Media.Visual>, allowing you to implement user interface behavior such as a selection rectangle to select multiple objects.</span></span>  
  
 
  
<a name="hit_testing_scenarios"></a>   
## <a name="hit-testing-scenarios"></a><span data-ttu-id="1f52b-105">ヒット テストのシナリオ</span><span class="sxs-lookup"><span data-stu-id="1f52b-105">Hit Testing Scenarios</span></span>  
 <span data-ttu-id="1f52b-106"><xref:System.Windows.UIElement>クラスを提供、<xref:System.Windows.UIElement.InputHitTest%2A>メソッドで、指定された座標の値を使用して、要素に対してヒット テストすることができます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-106">The <xref:System.Windows.UIElement> class provides the <xref:System.Windows.UIElement.InputHitTest%2A> method, which allows you to hit test against an element using a given coordinate value.</span></span> <span data-ttu-id="1f52b-107">多くの場合、<xref:System.Windows.UIElement.InputHitTest%2A>要素のテストのヒットを実装するメソッドが必要な機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-107">In many cases, the <xref:System.Windows.UIElement.InputHitTest%2A> method provides the desired functionality for implementing hit testing of elements.</span></span> <span data-ttu-id="1f52b-108">ただし、ビジュアル層でのヒット テストを実装する必要があるシナリオもいくつか存在します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-108">However, there are several scenarios in which you may need to implement hit testing at the visual layer.</span></span>  
  
-   <span data-ttu-id="1f52b-109">非に対するヒット テスト<xref:System.Windows.UIElement>オブジェクト: これ以外のテストがヒットする場合に当てはまります<xref:System.Windows.UIElement>などのオブジェクト<xref:System.Windows.Media.DrawingVisual>またはグラフィックス オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="1f52b-109">Hit testing against non-<xref:System.Windows.UIElement> objects: This applies if you are hit testing non-<xref:System.Windows.UIElement> objects, such as <xref:System.Windows.Media.DrawingVisual> or graphics objects.</span></span>  
  
-   <span data-ttu-id="1f52b-110">ジオメトリを使用したヒット テスト: ポイントの座標値ではなくジオメトリ オブジェクトを使用してヒット テストを行う必要がある場合に適用されます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-110">Hit testing using a geometry: This applies if you need to hit test using a geometry object rather than the coordinate value of a point.</span></span>  
  
-   <span data-ttu-id="1f52b-111">複数のオブジェクトに対するヒット テスト: 重なっているオブジェクトなどの複数のオブジェクトに対してヒット テストを行う必要がある場合に適用されます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-111">Hit testing against multiple objects: This applies when you need to hit test against multiple objects, such as overlapping objects.</span></span> <span data-ttu-id="1f52b-112">最初のビジュアルだけでなく、ジオメトリまたはポイントと交差するすべてのビジュアルの結果を取得できます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-112">You can get results for all visuals intersecting a geometry or point, not just the first one.</span></span>  
  
-   <span data-ttu-id="1f52b-113">無視<xref:System.Windows.UIElement>ヒット テスト ポリシー: を無視する必要がある場合にこれが適用されます、<xref:System.Windows.UIElement>ヒット テスト ポリシーで、要素が無効になっているかどうかまたは非表示としてなどの条件を考慮します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-113">Ignoring <xref:System.Windows.UIElement> hit testing policy: This applies when you need to ignore the <xref:System.Windows.UIElement> hit testing policy, which takes into consideration such factors as whether an element is disabled or invisible.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="1f52b-114">ビジュアル層でのテスト ヒットを示すコード サンプル全体については、「[DrawingVisuals を使用したヒット テストのサンプル](http://go.microsoft.com/fwlink/?LinkID=159994)」と「[Win32 相互運用によるヒット テストのサンプル](http://go.microsoft.com/fwlink/?LinkID=159995)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1f52b-114">For a complete code sample illustrating hit testing at the visual layer, see [Hit Test Using DrawingVisuals Sample](http://go.microsoft.com/fwlink/?LinkID=159994) and [Hit Test with Win32 Interoperation Sample](http://go.microsoft.com/fwlink/?LinkID=159995).</span></span>  
  
<a name="hit_testing_support"></a>   
## <a name="hit-testing-support"></a><span data-ttu-id="1f52b-115">ヒット テストのサポート</span><span class="sxs-lookup"><span data-stu-id="1f52b-115">Hit Testing Support</span></span>  
 <span data-ttu-id="1f52b-116">目的、<xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>内のメソッド、<xref:System.Windows.Media.VisualTreeHelper>クラスは、geometry 型またはポイント座標の値がコントロールのグラフィック要素など、特定のオブジェクトの描画された内容内かどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-116">The purpose of the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> methods in the <xref:System.Windows.Media.VisualTreeHelper> class is to determine whether a geometry or point coordinate value is within the rendered content of a given object, such as a control or graphic element.</span></span> <span data-ttu-id="1f52b-117">たとえば、ヒット テストを使用することで、オブジェクトの外接する四角形内でのマウス クリックが、円のジオメトリ内にあるかどうかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-117">For example, you could use hit testing to determine whether a mouse click within the bounding rectangle of an object falls within the geometry of a circle.</span></span> <span data-ttu-id="1f52b-118">また、ヒット テストの既定の実装をオーバーライドして、独自のカスタム ヒット テスト計算を実行することもできます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-118">You can also choose to override the default implementation of hit testing to perform your own custom hit test calculations.</span></span>  
  
 <span data-ttu-id="1f52b-119">四角形以外のオブジェクトの領域と外接する四角形の関係を次の図に示します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-119">The following illustration shows the relationship between a non-rectangular object's region and its bounding rectangle.</span></span>  
  
 <span data-ttu-id="1f52b-120">![有効なヒット テスト領域のダイアグラム](../../../../docs/framework/wpf/graphics-multimedia/media/wcpsdk-mmgraphics-visuals-hittest-1.png "wcpsdk_mmgraphics_visuals_hittest_1")</span><span class="sxs-lookup"><span data-stu-id="1f52b-120">![Diagram of valid hit test region](../../../../docs/framework/wpf/graphics-multimedia/media/wcpsdk-mmgraphics-visuals-hittest-1.png "wcpsdk_mmgraphics_visuals_hittest_1")</span></span>  
<span data-ttu-id="1f52b-121">有効なヒット テスト領域のダイアグラム</span><span class="sxs-lookup"><span data-stu-id="1f52b-121">Diagram of valid hit test region</span></span>  
  
<a name="hit_testing_and_z-order"></a>   
## <a name="hit-testing-and-z-order"></a><span data-ttu-id="1f52b-122">ヒット テストと z オーダー</span><span class="sxs-lookup"><span data-stu-id="1f52b-122">Hit Testing and Z-Order</span></span>  
 <span data-ttu-id="1f52b-123">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] のビジュアル層は、最上位のオブジェクトだけでなく、ポイントまたはジオメトリの下にあるすべてのオブジェクトに対するヒット テストをサポートします。</span><span class="sxs-lookup"><span data-stu-id="1f52b-123">The [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] visual layer supports hit testing against all objects under a point or geometry, not just the top-most object.</span></span> <span data-ttu-id="1f52b-124">結果は z オーダーで返されます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-124">Results are returned in z-order.</span></span> <span data-ttu-id="1f52b-125">ただし、ビジュアル オブジェクトをパラメーターとして渡す、<xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>のどの部分を決定するメソッドがヒットするビジュアル ツリーのテストします。</span><span class="sxs-lookup"><span data-stu-id="1f52b-125">However, the visual object that you pass as the parameter to the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method determines which portion of the visual tree that will be hit test.</span></span> <span data-ttu-id="1f52b-126">ヒット テストは、ビジュアル ツリー全体またはその一部に対して実行できます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-126">You can hit test against the entire visual tree, or any portion of it.</span></span>  
  
 <span data-ttu-id="1f52b-127">次の図では、四角形と三角形の両方のオブジェクト上に円オブジェクトがあります。</span><span class="sxs-lookup"><span data-stu-id="1f52b-127">In the following illustration, the circle object is on top of both the square and triangle objects.</span></span> <span data-ttu-id="1f52b-128">ヒット z オーダー値がある最上位のビジュアル オブジェクトをテストに興味のみ場合は、返されるビジュアル ヒット テスト列挙型を設定できます<xref:System.Windows.Media.HitTestResultBehavior.Stop>から、<xref:System.Windows.Media.HitTestResultCallback>を最初の項目の後にヒット テストの検査を停止します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-128">If you are only interested in hit testing the visual object whose z-order value is top-most, you can set the visual hit test enumeration to return <xref:System.Windows.Media.HitTestResultBehavior.Stop> from the <xref:System.Windows.Media.HitTestResultCallback> to stop the hit test traversal after the first item.</span></span>  
  
 <span data-ttu-id="1f52b-129">![Z のダイアグラム&#45;ビジュアル ツリーの順序](../../../../docs/framework/wpf/graphics-multimedia/media/wcpsdk-mmgraphics-visuals-hittest-2.png "wcpsdk_mmgraphics_visuals_hittest_2")</span><span class="sxs-lookup"><span data-stu-id="1f52b-129">![Diagram of the z&#45;order of a visual tree](../../../../docs/framework/wpf/graphics-multimedia/media/wcpsdk-mmgraphics-visuals-hittest-2.png "wcpsdk_mmgraphics_visuals_hittest_2")</span></span>  
<span data-ttu-id="1f52b-130">ビジュアル ツリーの z オーダーのダイアグラム</span><span class="sxs-lookup"><span data-stu-id="1f52b-130">Diagram of the z-order of a visual tree</span></span>  
  
 <span data-ttu-id="1f52b-131">特定の時点または geometry 下にあるすべてのビジュアル オブジェクトを列挙する場合は、返す<xref:System.Windows.Media.HitTestResultBehavior.Continue>から、<xref:System.Windows.Media.HitTestResultCallback>です。</span><span class="sxs-lookup"><span data-stu-id="1f52b-131">If you want to enumerate all visual objects under a specific point or geometry, return <xref:System.Windows.Media.HitTestResultBehavior.Continue> from the <xref:System.Windows.Media.HitTestResultCallback>.</span></span> <span data-ttu-id="1f52b-132">つまり、完全に隠されているものも含めて、他のオブジェクトの下にあるすべてのビジュアル オブジェクトに対してヒット テストを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-132">This means you can hit test for visual objects that are beneath other objects, even if they are wholly obscured.</span></span> <span data-ttu-id="1f52b-133">詳細については、「ヒット テスト結果のコールバックの使用」のサンプル コードを参照してください。</span><span class="sxs-lookup"><span data-stu-id="1f52b-133">See the sample code in the section "Using a Hit Test Results Callback" for more information.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="1f52b-134">透明なビジュアル オブジェクトのヒット テストも実行できます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-134">A visual object that is transparent can also be hit test.</span></span>  
  
<a name="using_default_hit_testing"></a>   
## <a name="using-default-hit-testing"></a><span data-ttu-id="1f52b-135">既定のヒット テストの使用</span><span class="sxs-lookup"><span data-stu-id="1f52b-135">Using Default Hit Testing</span></span>  
 <span data-ttu-id="1f52b-136">ポイントを使用してビジュアル オブジェクトのジオメトリ内かどうかを識別することができます、 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> visual オブジェクトと、ポイント座標と比較する値を指定します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-136">You can identify whether a point is within the geometry of a visual object, by using the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method to specify a visual object and a point coordinate value to test against.</span></span> <span data-ttu-id="1f52b-137">ビジュアル オブジェクトのパラメーターは、ヒット テストの検索のためのビジュアル ツリー内の開始点を識別します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-137">The visual object parameter identifies the starting point in the visual tree for the hit test search.</span></span> <span data-ttu-id="1f52b-138">設定されているジオメトリには、目的の座標が含まれています。 ビジュアル ツリーで visual オブジェクトが見つかった場合、<xref:System.Windows.Media.HitTestResult.VisualHit%2A>のプロパティ、<xref:System.Windows.Media.HitTestResult>オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="1f52b-138">If a visual object is found in the visual tree whose geometry contains the coordinate, it is set to the <xref:System.Windows.Media.HitTestResult.VisualHit%2A> property of a <xref:System.Windows.Media.HitTestResult> object.</span></span> <span data-ttu-id="1f52b-139"><xref:System.Windows.Media.HitTestResult>からは返され、<xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>メソッドです。</span><span class="sxs-lookup"><span data-stu-id="1f52b-139">The <xref:System.Windows.Media.HitTestResult> is then returned from the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span> <span data-ttu-id="1f52b-140">ポイントがヒット テストは visual のサブツリーに含まれていない場合<xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>返します`null`です。</span><span class="sxs-lookup"><span data-stu-id="1f52b-140">If the point is not contained with the visual sub-tree you are hit testing, <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> returns `null`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="1f52b-141">既定のヒット テストでは、常に z オーダーで最上位のオブジェクトが返されます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-141">Default hit testing always returns the top-most object in the z-order.</span></span> <span data-ttu-id="1f52b-142">部分的または完全に隠されているものも含めて、すべてのビジュアル オブジェクトを識別するには、ヒット テストの結果のコールバックを使用します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-142">In order to identify all visual objects, even those that may be partly or wholly obscured, use a hit test result callback.</span></span>  
  
 <span data-ttu-id="1f52b-143">座標の値のポイントのパラメーターとして渡す、<xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>への座標空間に対するテストがヒットしたビジュアル オブジェクトの相対的なメソッドには。</span><span class="sxs-lookup"><span data-stu-id="1f52b-143">The coordinate value you pass as the point parameter for the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method has to be relative to the coordinate space of the visual object you are hit testing against.</span></span> <span data-ttu-id="1f52b-144">たとえば、入れ子になったビジュアル オブジェクトが親の座標空間の (100, 100) に定義されている場合、(0, 0) での子のビジュアルのヒット テストは、親の座標空間の (100, 100) でのヒット テストと同じになります。</span><span class="sxs-lookup"><span data-stu-id="1f52b-144">For example, if you have nested visual objects defined at (100, 100) in the parent's coordinate space, then hit testing a child visual at (0, 0) is equivalent to hit testing at (100, 100) in the parent's coordinate space.</span></span>  
  
 <span data-ttu-id="1f52b-145">次のコードのマウス イベントのハンドラーを設定する方法を示しています、<xref:System.Windows.UIElement>ヒット テストのためのイベントをキャプチャするために使用できるオブジェクト。</span><span class="sxs-lookup"><span data-stu-id="1f52b-145">The following code shows how to set up mouse event handlers for a <xref:System.Windows.UIElement> object that is used to capture events used for hit testing.</span></span>  
  
 [!code-csharp[HitTestingOverview#100](../../../../samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#100)]
 [!code-vb[HitTestingOverview#100](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#100)]  
  
### <a name="how-the-visual-tree-affects-hit-testing"></a><span data-ttu-id="1f52b-146">ヒット テストに対するビジュアル ツリーの影響</span><span class="sxs-lookup"><span data-stu-id="1f52b-146">How the Visual Tree Affects Hit Testing</span></span>  
 <span data-ttu-id="1f52b-147">ビジュアル ツリー内の開始点によって、ヒット テストによるオブジェクトの列挙時に返されるオブジェクトが決定されます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-147">The starting point in the visual tree determines which objects are returned during the hit test enumeration of objects.</span></span> <span data-ttu-id="1f52b-148">ヒット テストの対象となるオブジェクトが複数存在する場合、ビジュアル ツリー内の開始点として使用されるビジュアル オブジェクトは、対象となるすべてのオブジェクトの共通の先祖である必要があります。</span><span class="sxs-lookup"><span data-stu-id="1f52b-148">If you have multiple objects you want to hit test, the visual object used as the starting point in the visual tree must be the common ancestor of all objects of interest.</span></span> <span data-ttu-id="1f52b-149">たとえば、次の図のボタン要素と描画ビジュアルの両方のヒット テストを行う場合、ビジュアル ツリー内の開始点を、その両方の共通の先祖に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1f52b-149">For example, if you were interested in hit testing both the button element and drawing visual in the following diagram, you would have to set the starting point in the visual tree to the common ancestor of both.</span></span> <span data-ttu-id="1f52b-150">この場合、キャンバス要素がボタン要素と描画ビジュアルの両方の共通の先祖になります。</span><span class="sxs-lookup"><span data-stu-id="1f52b-150">In this case, the canvas element is the common ancestor of both the button element and the drawing visual.</span></span>  
  
 <span data-ttu-id="1f52b-151">![ビジュアル ツリー階層のダイアグラム](../../../../docs/framework/wpf/graphics-multimedia/media/wcpsdk-mmgraphics-visuals-overview-01.gif "wcpsdk_mmgraphics_visuals_overview_01")</span><span class="sxs-lookup"><span data-stu-id="1f52b-151">![Diagram of a visual tree hierarchy](../../../../docs/framework/wpf/graphics-multimedia/media/wcpsdk-mmgraphics-visuals-overview-01.gif "wcpsdk_mmgraphics_visuals_overview_01")</span></span>  
<span data-ttu-id="1f52b-152">ビジュアル ツリー階層のダイアグラム</span><span class="sxs-lookup"><span data-stu-id="1f52b-152">Diagram of a visual tree hierarchy</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="1f52b-153"><xref:System.Windows.UIElement.IsHitTestVisible%2A>プロパティを取得またはを宣言する値を設定するかどうか、 <xref:System.Windows.UIElement>-、表示される内容の一部から派生したオブジェクトがヒット テストの結果として返される可能性のあることができます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-153">The <xref:System.Windows.UIElement.IsHitTestVisible%2A> property gets or sets a value that declares whether a <xref:System.Windows.UIElement>-derived object can possibly be returned as a hit test result from some portion of its rendered content.</span></span> <span data-ttu-id="1f52b-154">これにより、ビジュアル ツリーを選択的に変更し、ヒット テストの対象となるビジュアル オブジェクトを決定することができます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-154">This allows you to selectively alter the visual tree to determine which visual objects are involved in a hit test.</span></span>  
  
<a name="using_a_hit_test_result_callback"></a>   
## <a name="using-a-hit-test-result-callback"></a><span data-ttu-id="1f52b-155">ヒット テスト結果のコールバックの使用</span><span class="sxs-lookup"><span data-stu-id="1f52b-155">Using a Hit Test Result Callback</span></span>  
 <span data-ttu-id="1f52b-156">ジオメトリに指定した座標値が含まれるビジュアル ツリーのすべてのビジュアル オブジェクトを列挙できます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-156">You can enumerate all visual objects in a visual tree whose geometry contains a specified coordinate value.</span></span> <span data-ttu-id="1f52b-157">これにより、他のビジュアル オブジェクトによって部分的または完全に隠されているものも含めて、すべてのビジュアル オブジェクトを識別することができます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-157">This allows you to identify all visual objects, even those that may be partly or wholly obscured by other visual objects.</span></span> <span data-ttu-id="1f52b-158">ビジュアル ツリーを使用してビジュアル オブジェクトを列挙する、<xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>ヒット テストのコールバック関数を持つメソッドです。</span><span class="sxs-lookup"><span data-stu-id="1f52b-158">To enumerate visual objects in a visual tree use the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method with a hit test callback function.</span></span> <span data-ttu-id="1f52b-159">ヒット テスト コールバック関数は、指定した座標値がビジュアル オブジェクトに含まれている場合にシステムによって呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-159">The hit test callback function is called by the system when the coordinate value you specify is contained in a visual object.</span></span>  
  
 <span data-ttu-id="1f52b-160">ヒット テストの結果の列挙時には、ビジュアル ツリーを変更する操作を実行しないでください。</span><span class="sxs-lookup"><span data-stu-id="1f52b-160">During the hit test results enumeration, you should not perform any operation that modifies the visual tree.</span></span> <span data-ttu-id="1f52b-161">走査中のビジュアル ツリーに対してオブジェクトの追加または削除を行うと、予測不可能な動作を招く可能性があります。</span><span class="sxs-lookup"><span data-stu-id="1f52b-161">Adding or removing an object from the visual tree while it is being traversed can result in unpredictable behavior.</span></span> <span data-ttu-id="1f52b-162">安全に後のビジュアル ツリーを変更することができます、<xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>メソッドを返します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-162">You can safely modify the visual tree after the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method returns.</span></span> <span data-ttu-id="1f52b-163">など、データ構造を提供することも、 <xref:System.Collections.ArrayList>、ヒット テスト結果の列挙中に値を格納します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-163">You may want to provide a data structure, such as an <xref:System.Collections.ArrayList>, to store values during the hit test results enumeration.</span></span>  
  
 [!code-csharp[HitTestingOverview#101](../../../../samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#101)]
 [!code-vb[HitTestingOverview#101](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#101)]  
  
 <span data-ttu-id="1f52b-164">ヒット テストのコールバック メソッドは、ビジュアル ツリーの特定のビジュアル オブジェクトでヒット テストが識別されたときに、ユーザーが実行するアクションを定義します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-164">The hit test callback method defines the actions you perform when a hit test is identified on a particular visual object in the visual tree.</span></span> <span data-ttu-id="1f52b-165">操作を実行した後に戻す、<xref:System.Windows.Media.HitTestResultBehavior>を他のビジュアル オブジェクトの列挙を続行するかどうかを決定する値。</span><span class="sxs-lookup"><span data-stu-id="1f52b-165">After you perform the actions, you return a <xref:System.Windows.Media.HitTestResultBehavior> value that determines whether to continue the enumeration of any other visual objects or not.</span></span>  
  
 [!code-csharp[HitTestingOverview#102](../../../../samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#102)]
 [!code-vb[HitTestingOverview#102](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#102)]  
  
> [!NOTE]
>  <span data-ttu-id="1f52b-166">ヒットしたビジュアル オブジェクトの列挙の順序は、z オーダー順です。</span><span class="sxs-lookup"><span data-stu-id="1f52b-166">The order of enumeration of hit visual objects is by z-order.</span></span> <span data-ttu-id="1f52b-167">z オーダーの最上位のビジュアル オブジェクトが最初に列挙されます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-167">The visual object at the top-most z-order level is the first object enumerated.</span></span> <span data-ttu-id="1f52b-168">その他のビジュアル オブジェクトは、z オーダーの上位から順に列挙されます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-168">Any other visual objects enumerated are at decreasing z-order level.</span></span> <span data-ttu-id="1f52b-169">この列挙の順序は、ビジュアルの描画順序に対応します。</span><span class="sxs-lookup"><span data-stu-id="1f52b-169">This order of enumeration corresponds to the rendering order of the visuals.</span></span>  
  
 <span data-ttu-id="1f52b-170">ヒット テストのコールバック関数でいつでもビジュアル オブジェクトの列挙を停止するには、返すを<xref:System.Windows.Media.HitTestResultBehavior.Stop>です。</span><span class="sxs-lookup"><span data-stu-id="1f52b-170">You can stop the enumeration of visual objects at any time in the hit test callback function by returning <xref:System.Windows.Media.HitTestResultBehavior.Stop>.</span></span>  
  
 [!code-csharp[HitTestingOverview#103](../../../../samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#103)]
 [!code-vb[HitTestingOverview#103](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#103)]  
  
<a name="using_a_hit_test_filter_callback"></a>   
## <a name="using-a-hit-test-filter-callback"></a><span data-ttu-id="1f52b-171">ヒット テスト フィルターのコールバックの使用</span><span class="sxs-lookup"><span data-stu-id="1f52b-171">Using a Hit Test Filter Callback</span></span>  
 <span data-ttu-id="1f52b-172">オプションのヒット テスト フィルターを使用して、ヒット テストの結果に渡されるオブジェクトを制限できます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-172">You can use an optional hit test filter to restrict the objects that are passed on to the hit test results.</span></span> <span data-ttu-id="1f52b-173">これにより、ヒット テストの結果でビジュアル ツリーの一部を処理する必要がない場合、その部分を無視できます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-173">This allows you to ignore parts of the visual tree that you are not interested in processing in your hit test results.</span></span> <span data-ttu-id="1f52b-174">ヒット テスト フィルターを実装するヒット テスト フィルターのコールバック関数を定義して呼び出すときにパラメーター値として渡す、、<xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>メソッドです。</span><span class="sxs-lookup"><span data-stu-id="1f52b-174">To implement a hit test filter, you define a hit test filter callback function and pass it as a parameter value when you call the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span>  
  
 [!code-csharp[HitTestingOverview#104](../../../../samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#104)]
 [!code-vb[HitTestingOverview#104](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#104)]  
  
 <span data-ttu-id="1f52b-175">省略可能なヒット テスト フィルターのコールバック関数を指定しない場合、`null`とそのパラメーターの値、<xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>メソッドです。</span><span class="sxs-lookup"><span data-stu-id="1f52b-175">If you do not want to supply the optional hit test filter callback function, pass a `null` value as its parameter for the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span>  
  
 [!code-csharp[HitTestingOverview#105](../../../../samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#105)]
 [!code-vb[HitTestingOverview#105](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#105)]  
  
 <span data-ttu-id="1f52b-176">![ヒット テスト フィルターを使用したビジュアル ツリーの簡略化](../../../../docs/framework/wpf/graphics-multimedia/media/filteredvisualtree-01.png "FilteredVisualTree_01")</span><span class="sxs-lookup"><span data-stu-id="1f52b-176">![Pruning a visual tree using a hit test filter](../../../../docs/framework/wpf/graphics-multimedia/media/filteredvisualtree-01.png "FilteredVisualTree_01")</span></span>  
<span data-ttu-id="1f52b-177">ビジュアル ツリーの簡略化</span><span class="sxs-lookup"><span data-stu-id="1f52b-177">Pruning a visual tree</span></span>  
  
 <span data-ttu-id="1f52b-178">ヒット テスト フィルターのコールバック関数を使用すると、描画されるコンテンツに指定した座標が含まれるすべてのビジュアルを列挙できます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-178">The hit test filter callback function allows you to enumerate through all the visuals whose rendered content contains the coordinates you specify.</span></span> <span data-ttu-id="1f52b-179">ただし、ヒット テストの結果のコールバック関数で、ビジュアル ツリーの一部の分岐を処理する必要がない場合、これらの分岐を無視できます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-179">However, you may want to ignore certain branches of the visual tree that you are not interested in processing in your hit test results callback function.</span></span> <span data-ttu-id="1f52b-180">ヒット テスト フィルターのコールバック関数の戻り値によって、ビジュアル オブジェクトの列挙体が実行するアクションの種類が決定されます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-180">The return value of the hit test filter callback function determines what type of action the enumeration of the visual objects should take.</span></span> <span data-ttu-id="1f52b-181">たとえば、次の値を返す<xref:System.Windows.Media.HitTestFilterBehavior.ContinueSkipSelfAndChildren>、ヒット テスト結果の列挙体から現在の visual オブジェクトとその子を削除することができます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-181">For example, if you return the value, <xref:System.Windows.Media.HitTestFilterBehavior.ContinueSkipSelfAndChildren>, you can remove the current visual object and its children from the hit test results enumeration.</span></span> <span data-ttu-id="1f52b-182">つまり、ヒット テストの結果のコールバック関数は、列挙体でこれらのオブジェクトを認識しなくなります。</span><span class="sxs-lookup"><span data-stu-id="1f52b-182">This means that the hit test results callback function will not see these objects in its enumeration.</span></span> <span data-ttu-id="1f52b-183">オブジェクトのビジュアル ツリーから余分なものを取り除くと、ヒット テストの結果の列挙体が渡されるときの処理を減らすことができます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-183">Pruning the visual tree of objects decreases the amount of processing during the hit test results enumeration pass.</span></span> <span data-ttu-id="1f52b-184">次のコード例では、フィルターはラベルとその子孫をスキップし、他のすべてのヒット テストを行います。</span><span class="sxs-lookup"><span data-stu-id="1f52b-184">In the following code example, the filter skips labels and their descendants and hit tests everything else.</span></span>  
  
 [!code-csharp[HitTestingOverview#106](../../../../samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#106)]
 [!code-vb[HitTestingOverview#106](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#106)]  
  
> [!NOTE]
>  <span data-ttu-id="1f52b-185">ヒット テスト フィルターのコールバックは、ヒット テストの結果のコールバックが呼び出されない場合に呼び出されることがあります。</span><span class="sxs-lookup"><span data-stu-id="1f52b-185">The hit test filter callback will sometimes be called in cases where the hit test results callback is not called.</span></span>  
  
<a name="overriding_default_hit_testing"></a>   
## <a name="overriding-default-hit-testing"></a><span data-ttu-id="1f52b-186">既定のヒット テストのオーバーライド</span><span class="sxs-lookup"><span data-stu-id="1f52b-186">Overriding Default Hit Testing</span></span>  
 <span data-ttu-id="1f52b-187">オーバーライドすることでサポートをテストしてビジュアル オブジェクトの既定のヒットをオーバーライドすることができます、<xref:System.Windows.Media.Visual.HitTestCore%2A>メソッドです。</span><span class="sxs-lookup"><span data-stu-id="1f52b-187">You can override a visual object’s default hit testing support by overriding the <xref:System.Windows.Media.Visual.HitTestCore%2A> method.</span></span> <span data-ttu-id="1f52b-188">つまりを呼び出すときは、<xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>メソッドは、のオーバーライドされた実装<xref:System.Windows.Media.Visual.HitTestCore%2A>と呼びます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-188">This means that when you invoke the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method, your overridden implementation of <xref:System.Windows.Media.Visual.HitTestCore%2A> is called.</span></span> <span data-ttu-id="1f52b-189">座標がビジュアル オブジェクトの描画されるコンテンツの外側にあっても、ビジュアル オブジェクトの外接する四角形内でヒット テストが実行されると、オーバーライドされたメソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="1f52b-189">Your overridden method is called when a hit test falls within the bounding rectangle of the visual object, even if the coordinate falls outside the rendered content of the visual object.</span></span>  
  
 [!code-csharp[HitTestingOverview#107](../../../../samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#107)]
 [!code-vb[HitTestingOverview#107](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#107)]  
  
 <span data-ttu-id="1f52b-190">ビジュアル オブジェクトの外接する四角形と描画されるコンテンツの両方に対してヒット テストを行う必要が生じる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="1f52b-190">There may be times when you want to hit test against both the bounding rectangle and the rendered content of a visual object.</span></span> <span data-ttu-id="1f52b-191">使用して、 `PointHitTestParameters` 、オーバーライドのパラメーター値<xref:System.Windows.Media.Visual.HitTestCore%2A>基本メソッドにパラメーターとしてメソッド<xref:System.Windows.Media.Visual.HitTestCore%2A>、ビジュアル オブジェクトの外接する四角形のヒットに基づいてアクションを実行してに対して 2 つ目のヒット テストを実行しますビジュアル オブジェクトのコンテンツをレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="1f52b-191">By using the `PointHitTestParameters` parameter value in your overridden <xref:System.Windows.Media.Visual.HitTestCore%2A> method as the parameter to the base method <xref:System.Windows.Media.Visual.HitTestCore%2A>, you can perform actions based on a hit of the bounding rectangle of a visual object, and then perform a second hit test against the rendered content of the visual object.</span></span>  
  
 [!code-csharp[HitTestingOverview#108](../../../../samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#108)]
 [!code-vb[HitTestingOverview#108](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#108)]  
  
## <a name="see-also"></a><span data-ttu-id="1f52b-192">関連項目</span><span class="sxs-lookup"><span data-stu-id="1f52b-192">See Also</span></span>  
 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>  
 <xref:System.Windows.Media.HitTestResult>  
 <xref:System.Windows.Media.HitTestResultCallback>  
 <xref:System.Windows.Media.HitTestFilterCallback>  
 <xref:System.Windows.UIElement.IsHitTestVisible%2A>  
 [<span data-ttu-id="1f52b-193">ヒット テスト DrawingVisuals サンプルの使用</span><span class="sxs-lookup"><span data-stu-id="1f52b-193">Hit Test Using DrawingVisuals Sample</span></span>](http://go.microsoft.com/fwlink/?LinkID=159994)  
 [<span data-ttu-id="1f52b-194">ヒット テストの Win32 相互運用性サンプル</span><span class="sxs-lookup"><span data-stu-id="1f52b-194">Hit Test with Win32 Interoperation Sample</span></span>](http://go.microsoft.com/fwlink/?LinkID=159995)  
 [<span data-ttu-id="1f52b-195">ビジュアル内のジオメトリのヒット テストを実行する</span><span class="sxs-lookup"><span data-stu-id="1f52b-195">Hit Test Geometry in a Visual</span></span>](../../../../docs/framework/wpf/graphics-multimedia/how-to-hit-test-geometry-in-a-visual.md)  
 [<span data-ttu-id="1f52b-196">Win32 ホスト コンテナーを使用してヒット テストを実行する</span><span class="sxs-lookup"><span data-stu-id="1f52b-196">Hit Test Using a Win32 Host Container</span></span>](../../../../docs/framework/wpf/graphics-multimedia/how-to-hit-test-using-a-win32-host-container.md)
