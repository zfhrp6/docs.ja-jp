---
title: "WPF と Win32 の相互運用性"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- hosting WPF content in Win32 window [WPF]
- HWND interop [WPF]
- Win32 code [WPF], WPF interoperation
- interoperability [WPF], Win32
ms.assetid: 0ffbde0d-701d-45a3-a6fa-dd71f4d9772e
caps.latest.revision: "26"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 6ff6e008c95844388930a505caacbaf6d407edd1
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/21/2017
---
# <a name="wpf-and-win32-interoperation"></a><span data-ttu-id="58052-102">WPF と Win32 の相互運用性</span><span class="sxs-lookup"><span data-stu-id="58052-102">WPF and Win32 Interoperation</span></span>
<span data-ttu-id="58052-103">このトピックでは、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] および [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] コードを相互運用する方法の概要について説明します。</span><span class="sxs-lookup"><span data-stu-id="58052-103">This topic provides an overview of how to interoperate [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span> [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]<span data-ttu-id="58052-104"> は、アプリケーションの作成に適した環境を提供します。</span><span class="sxs-lookup"><span data-stu-id="58052-104"> provides a rich environment for creating applications.</span></span> <span data-ttu-id="58052-105">ただし、[!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] コードに多くの投資を行った場合は、そのコードの一部を再利用する方がより効率的である場合があります。</span><span class="sxs-lookup"><span data-stu-id="58052-105">However, when you have a substantial investment in [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] code, it might be more effective to reuse some of that code.</span></span>  
  

  
<a name="basics"></a>   
## <a name="wpf-and-win32-interoperation-basics"></a><span data-ttu-id="58052-106">WPF と Win32 の相互運用の基本</span><span class="sxs-lookup"><span data-stu-id="58052-106">WPF and Win32 Interoperation Basics</span></span>  
 <span data-ttu-id="58052-107">
          [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] と [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] コードを相互運用するための基本的な手法は 2 つあります。</span><span class="sxs-lookup"><span data-stu-id="58052-107">There are two basic techniques for interoperation between [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span>  
  
-   <span data-ttu-id="58052-108">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] ウィンドウで [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツをホストします。</span><span class="sxs-lookup"><span data-stu-id="58052-108">Host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="58052-109">この手法では、標準の [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] ウィンドウおよびアプリケーションのフレームワーク内で [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] の高度なグラフィックス機能を使用できます。</span><span class="sxs-lookup"><span data-stu-id="58052-109">With this technique, you can use the advanced graphics capabilities of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] within the framework of a standard [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window and application.</span></span>  
  
-   <span data-ttu-id="58052-110">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツで [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] ウィンドウをホストします。</span><span class="sxs-lookup"><span data-stu-id="58052-110">Host a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="58052-111">この手法では、既存のカスタム [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] コントロールを他の [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツのコンテキストで使用し、境界を越えてデータを渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="58052-111">With this technique, you can use an existing custom [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] control in the context of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and pass data across the boundaries.</span></span>  
  
 <span data-ttu-id="58052-112">ここでは、これらの各手法について概念的に説明します。</span><span class="sxs-lookup"><span data-stu-id="58052-112">Each of these techniques is conceptually introduced in this topic.</span></span> <span data-ttu-id="58052-113">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] で [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] をホストする場合のコードを使用した説明については、「[チュートリアル: Win32 での WPF コンテンツのホスト](../../../../docs/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="58052-113">For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], see [Walkthrough: Hosting WPF Content in Win32](../../../../docs/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32.md).</span></span> <span data-ttu-id="58052-114">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] で [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] をホストする場合のコードを使用した説明については、「[チュートリアル: WPF での Win32 コントロールのホスト](../../../../docs/framework/wpf/advanced/walkthrough-hosting-a-win32-control-in-wpf.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="58052-114">For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], see [Walkthrough: Hosting a Win32 Control in WPF](../../../../docs/framework/wpf/advanced/walkthrough-hosting-a-win32-control-in-wpf.md).</span></span>  
  
<a name="projects"></a>   
## <a name="wpf-interoperation-projects"></a><span data-ttu-id="58052-115">WPF 相互運用プロジェクト</span><span class="sxs-lookup"><span data-stu-id="58052-115">WPF Interoperation Projects</span></span>  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="58052-116"> [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] はマネージ コードですが、ほとんどの既存の [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] プログラムはアンマネージ [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] で記述されています。</span><span class="sxs-lookup"><span data-stu-id="58052-116"> [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] are managed code, but most existing [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programs are written in unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span></span>  <span data-ttu-id="58052-117">純粋なアンマネージ プログラムから [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)][!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] を呼び出すことはできません。</span><span class="sxs-lookup"><span data-stu-id="58052-117">You cannot call [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] from a true unmanaged program.</span></span> <span data-ttu-id="58052-118">ただし、[!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)] コンパイラで `/clr` オプションを使用すると、マネージとアンマネージの [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] 呼び出しをシームレスに混在させることができる、マネージとアンマネージの混在プログラムを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="58052-118">However, by using the `/clr` option with the [!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)] compiler, you can create a mixed managed-unmanaged program where you can seamlessly mix managed and unmanaged [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] calls.</span></span>  
  
 <span data-ttu-id="58052-119">プロジェクト レベルで、[!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] ファイルを [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] プロジェクトにコンパイルできないという問題があります。</span><span class="sxs-lookup"><span data-stu-id="58052-119">One project-level complication is that you cannot compile [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] files into a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] project.</span></span>  <span data-ttu-id="58052-120">これを解決するために、プロジェクトを分割する手法がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="58052-120">There are several project division techniques to compensate for this.</span></span>  
  
-   <span data-ttu-id="58052-121">すべての [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] ページを含む [!INCLUDE[TLA2#tla_cshrp](../../../../includes/tla2sharptla-cshrp-md.md)] DLL をコンパイル済みのアセンブリとして作成し、[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] 実行可能ファイルにその [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] を参照として含めます。</span><span class="sxs-lookup"><span data-stu-id="58052-121">Create a [!INCLUDE[TLA2#tla_cshrp](../../../../includes/tla2sharptla-cshrp-md.md)] DLL that contains all your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages as a compiled assembly, and then have your [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] executable include that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] as a reference.</span></span>  
  
-   <span data-ttu-id="58052-122">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツの [!INCLUDE[TLA2#tla_cshrp](../../../../includes/tla2sharptla-cshrp-md.md)] 実行可能ファイルを作成し、そのファイルが [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] コンテンツを含む [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] を参照するようにします。</span><span class="sxs-lookup"><span data-stu-id="58052-122">Create a [!INCLUDE[TLA2#tla_cshrp](../../../../includes/tla2sharptla-cshrp-md.md)] executable for the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and have it reference a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] that contains the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content.</span></span>  
  
-   <span data-ttu-id="58052-123">使用して<xref:System.Windows.Markup.XamlReader.Load%2A>をロード[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]コンパイルではなく、実行時に、[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]です。</span><span class="sxs-lookup"><span data-stu-id="58052-123">Use <xref:System.Windows.Markup.XamlReader.Load%2A> to load any [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at run time, instead of compiling your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span>  
  
-   <span data-ttu-id="58052-124">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] を使用せずに、すべての [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] をコードで記述し、<xref:System.Windows.Application> から要素ツリーを構築します。</span><span class="sxs-lookup"><span data-stu-id="58052-124">Do not use [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at all, and write all your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in code, building up the element tree from <xref:System.Windows.Application>.</span></span>  
  
 <span data-ttu-id="58052-125">これらの中で最適な方法を使用してください。</span><span class="sxs-lookup"><span data-stu-id="58052-125">Use whatever approach works best for you.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="58052-126">
          [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] を使用したことがない場合は、相互運用のコード例に `gcnew` や `nullptr` などの "見慣れない" キーワードがあるかもしれません。</span><span class="sxs-lookup"><span data-stu-id="58052-126">If you have not used [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] before, you might notice some "new" keywords such as `gcnew` and `nullptr` in the interoperation code examples.</span></span> <span data-ttu-id="58052-127">古い二重アンダースコアの構文 (`__gc`) がこれらのキーワードによって置き換えられています。これらのキーワードを使用すると、[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] のマネージ コードの構文がより自然になります。</span><span class="sxs-lookup"><span data-stu-id="58052-127">These keywords supersede the older double-underscore syntax (`__gc`) and provide a more natural syntax for managed code in [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span></span>  <span data-ttu-id="58052-128">[!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] マネージ機能の詳細については、「[ランタイム プラットフォームのコンポーネントの拡張機能](/cpp/windows/component-extensions-for-runtime-platforms)」および「[Hello, C++/CLI](http://go.microsoft.com/fwlink/?LinkId=98739)」(C++/CLI 入門) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="58052-128">To learn more about the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] managed features, see [Component Extensions for Runtime Platforms](/cpp/windows/component-extensions-for-runtime-platforms) and [Hello, C++/CLI](http://go.microsoft.com/fwlink/?LinkId=98739).</span></span>  
  
<a name="hwnds"></a>   
## <a name="how-wpf-uses-hwnds"></a><span data-ttu-id="58052-129">WPF での Hwnd の使用方法</span><span class="sxs-lookup"><span data-stu-id="58052-129">How WPF Uses Hwnds</span></span>  
 <span data-ttu-id="58052-130">ほとんどの [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] "HWND 相互運用" を行うには、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] での HWND の使用方法を理解する必要があります。</span><span class="sxs-lookup"><span data-stu-id="58052-130">To make the most of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] "HWND interop", you need to understand how [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses HWNDs.</span></span> <span data-ttu-id="58052-131">HWND では、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] レンダリングを [!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)] レンダリングまたは [!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)] / [!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)] レンダリングと混在させることはできません。</span><span class="sxs-lookup"><span data-stu-id="58052-131">For any HWND, you cannot mix [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] rendering with [!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)] rendering or [!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)] / [!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)] rendering.</span></span> <span data-ttu-id="58052-132">混在させると、さまざまな影響が生じます。</span><span class="sxs-lookup"><span data-stu-id="58052-132">This has a number of implications.</span></span> <span data-ttu-id="58052-133">主に、これらのレンダリング モデルを混在させるには、相互運用ソリューションを作成し、使用するレンダリング モデルごとに指定された相互運用セグメントを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="58052-133">Primarily, in order to mix these rendering models at all, you must create an interoperation solution, and use designated segments of interoperation for each rendering model that you choose to use.</span></span> <span data-ttu-id="58052-134">また、相互運用ソリューションで実現できる動作に対する "空域" 制限がレンダリング動作によって生じます。</span><span class="sxs-lookup"><span data-stu-id="58052-134">Also, the rendering behavior creates an "airspace" restriction for what your interoperation solution can accomplish.</span></span> <span data-ttu-id="58052-135">"空域" の概念の詳細については、「[技術領域の概要](../../../../docs/framework/wpf/advanced/technology-regions-overview.md)」のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="58052-135">The "airspace" concept is explained in greater detail in the topic [Technology Regions Overview](../../../../docs/framework/wpf/advanced/technology-regions-overview.md).</span></span>  
  
 <span data-ttu-id="58052-136">画面上のすべての [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 要素は最終的に HWND によってサポートされます。</span><span class="sxs-lookup"><span data-stu-id="58052-136">All [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements on the screen are ultimately backed by a HWND.</span></span> <span data-ttu-id="58052-137">作成するとき、 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window>、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]最上位の HWND を作成しを使用して、<xref:System.Windows.Interop.HwndSource>を配置する、<xref:System.Windows.Window>とその[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]HWND 内のコンテンツ。</span><span class="sxs-lookup"><span data-stu-id="58052-137">When you create a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window>, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] creates a top-level HWND, and uses an <xref:System.Windows.Interop.HwndSource> to put the <xref:System.Windows.Window> and its [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content inside the HWND.</span></span>  <span data-ttu-id="58052-138">アプリケーション内の残りの [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツは、その単一の HWND を共有します。</span><span class="sxs-lookup"><span data-stu-id="58052-138">The rest of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in the application shares that singular HWND.</span></span> <span data-ttu-id="58052-139">ただし、メニュー、コンボ ボックス ドロップダウン、およびその他のポップアップは例外です。</span><span class="sxs-lookup"><span data-stu-id="58052-139">An exception is menus, combo box drop downs, and other pop-ups.</span></span> <span data-ttu-id="58052-140">これらの要素では独自のトップレベル ウィンドウが作成されます。このため [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] メニューは、そのメニューを格納するウィンドウ HWND の端を越える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="58052-140">These elements create their own top-level window, which is why a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] menu can potentially go past the edge of the window HWND that contains it.</span></span> <span data-ttu-id="58052-141">使用すると<xref:System.Windows.Interop.HwndHost>内 HWND を配置する[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]通知[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]に新しい子 HWND 相対を配置する方法、 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> HWND です。</span><span class="sxs-lookup"><span data-stu-id="58052-141">When you use <xref:System.Windows.Interop.HwndHost> to put an HWND inside [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] informs [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] how to position the new child HWND relative to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> HWND.</span></span>  
  
 <span data-ttu-id="58052-142">HWND の関連概念として、各 HWND 内および各 HWND 間の透過性が挙げられます。</span><span class="sxs-lookup"><span data-stu-id="58052-142">A related concept to HWND is transparency within and between each HWND.</span></span> <span data-ttu-id="58052-143">これについても「[技術領域の概要](../../../../docs/framework/wpf/advanced/technology-regions-overview.md)」のトピックで解説されています。</span><span class="sxs-lookup"><span data-stu-id="58052-143">This is also discussed in the topic [Technology Regions Overview](../../../../docs/framework/wpf/advanced/technology-regions-overview.md).</span></span>  
  
<a name="hosting_a_wpf_page"></a>   
## <a name="hosting-wpf-content-in-a-microsoft-win32-window"></a><span data-ttu-id="58052-144">Microsoft Win32 ウィンドウでの WPF コンテンツのホスト</span><span class="sxs-lookup"><span data-stu-id="58052-144">Hosting WPF Content in a Microsoft Win32 Window</span></span>  
 <span data-ttu-id="58052-145">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] ウィンドウで [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] をホストするキーとなるのは、<xref:System.Windows.Interop.HwndSource> クラスです。</span><span class="sxs-lookup"><span data-stu-id="58052-145">The key to hosting a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] on a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window is the <xref:System.Windows.Interop.HwndSource> class.</span></span> <span data-ttu-id="58052-146">このクラスは [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] ウィンドウの [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] コンテンツをラップし、その [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツを子ウィンドウとして[!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] に組み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="58052-146">This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window, so that the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content can be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window.</span></span> <span data-ttu-id="58052-147">次の方法では、[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] および [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] を単一のアプリケーションに統合します。</span><span class="sxs-lookup"><span data-stu-id="58052-147">The following approach combines the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in a single application.</span></span>  
  
1.  <span data-ttu-id="58052-148">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ (コンテンツのルート要素) をマネージ クラスとして実装します。</span><span class="sxs-lookup"><span data-stu-id="58052-148">Implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content (the content root element) as a managed class.</span></span> <span data-ttu-id="58052-149">通常、このクラスは、複数の子要素を格納できるクラスやルート要素として使用されるクラスのいずれか (<xref:System.Windows.Controls.DockPanel> や <xref:System.Windows.Controls.Page> など) から継承されます。</span><span class="sxs-lookup"><span data-stu-id="58052-149">Typically, the class inherits from one of the classes that can contain multiple child elements and/or used as a root element, such as <xref:System.Windows.Controls.DockPanel> or <xref:System.Windows.Controls.Page>.</span></span> <span data-ttu-id="58052-150">以降の手順では、このクラスを [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ クラスと呼び、そのクラスのインスタンスを [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ オブジェクトと呼びます。</span><span class="sxs-lookup"><span data-stu-id="58052-150">In subsequent steps, this class is referred to as the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class, and instances of the class are referred to as [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content objects.</span></span>  
  
2.  <span data-ttu-id="58052-151">
          [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] アプリケーションを [!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)] で実装します。</span><span class="sxs-lookup"><span data-stu-id="58052-151">Implement a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application with [!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)].</span></span> <span data-ttu-id="58052-152">既存のアンマネージ [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] アプリケーションから始める場合、通常、`/clr` コンパイラ フラグが含まれるようにプロジェクトの設定を変更して、アプリケーションでマネージ コードを呼び出すようにできます (`/clr` コンパイルをサポートするための要件の詳細については、ここでは説明しません)。</span><span class="sxs-lookup"><span data-stu-id="58052-152">If you are starting with an existing unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] application, you can usually enable it to call managed code by changing your project settings to include the `/clr` compiler flag (the full scope of what might be necessary to support `/clr` compilation is not described in this topic).</span></span>  
  
3.  <span data-ttu-id="58052-153">スレッド処理モデルをシングル スレッド アパートメント (STA: Single Threaded Apartment) に設定します。</span><span class="sxs-lookup"><span data-stu-id="58052-153">Set the threading model to Single Threaded Apartment (STA).</span></span> <span data-ttu-id="58052-154">このスレッド処理モデルを使用するのは [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] のみです。</span><span class="sxs-lookup"><span data-stu-id="58052-154">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses this threading model.</span></span>  
  
4.  <span data-ttu-id="58052-155">ウィンドウ プロシージャで WM_CREATE 通知を処理します。</span><span class="sxs-lookup"><span data-stu-id="58052-155">Handle the WM_CREATE notification in your window procedure.</span></span>  
  
5.  <span data-ttu-id="58052-156">ハンドラー (またはハンドラーが呼び出す関数) で、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="58052-156">Within the handler (or a function that the handler calls), do the following:</span></span>  
  
    1.  <span data-ttu-id="58052-157"><xref:System.Windows.Interop.HwndSource> パラメーターとして親ウィンドウ HWND を持つ新しい `parent` オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="58052-157">Create a new <xref:System.Windows.Interop.HwndSource> object with the parent window HWND as its `parent` parameter.</span></span>  
  
    2.  <span data-ttu-id="58052-158">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="58052-158">Create an instance of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class.</span></span>  
  
    3.  <span data-ttu-id="58052-159">参照を割り当てる、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ オブジェクトを<xref:System.Windows.Interop.HwndSource>オブジェクト<xref:System.Windows.Interop.HwndSource.RootVisual%2A>プロパティです。</span><span class="sxs-lookup"><span data-stu-id="58052-159">Assign a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object to the <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property.</span></span>  
  
    4.  <span data-ttu-id="58052-160"><xref:System.Windows.Interop.HwndSource> オブジェクトの <xref:System.Windows.Interop.HwndSource.Handle%2A> プロパティにウィンドウ ハンドル (HWND) が格納されます。</span><span class="sxs-lookup"><span data-stu-id="58052-160">The <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.Handle%2A> property contains the window handle (HWND).</span></span> <span data-ttu-id="58052-161">アプリケーションのアンマネージ部分で使用できる HWND を取得するには、`Handle.ToPointer()` を HWND にキャストします。</span><span class="sxs-lookup"><span data-stu-id="58052-161">To get an HWND that you can use in the unmanaged part of your application, cast `Handle.ToPointer()` to an HWND.</span></span>  
  
6.  <span data-ttu-id="58052-162">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ オブジェクトへの参照を保持する静的フィールドを含むマネージ クラスを実装します。</span><span class="sxs-lookup"><span data-stu-id="58052-162">Implement a managed class that contains a static field that holds a reference to your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object.</span></span> <span data-ttu-id="58052-163">このクラスへの参照を取得することができます、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ オブジェクトから、 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 、コードはこれにより、重要なは、<xref:System.Windows.Interop.HwndSource>誤ってガベージ コレクションの対象からです。</span><span class="sxs-lookup"><span data-stu-id="58052-163">This class allows you to get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code, but more importantly it prevents your <xref:System.Windows.Interop.HwndSource> from being inadvertently garbage collected.</span></span>  
  
7.  <span data-ttu-id="58052-164">ハンドラーを 1 つ以上の [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ オブジェクト イベントにアタッチして、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ オブジェクトから通知を受信します。</span><span class="sxs-lookup"><span data-stu-id="58052-164">Receive notifications from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by attaching a handler to one or more of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object events.</span></span>  
  
8.  <span data-ttu-id="58052-165">静的フィールドに格納した参照を使用してプロパティの設定やメソッドの呼び出しなどを行い、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ オブジェクトと通信します。</span><span class="sxs-lookup"><span data-stu-id="58052-165">Communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by using the reference that you stored in the static field to set properties, call methods, etc.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="58052-166">個別のアセンブリを生成して参照する場合は、手順 1 の [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ クラスの一部またはすべてについて、[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] でコンテンツ クラスの既定の部分クラスを使用して定義できます。</span><span class="sxs-lookup"><span data-stu-id="58052-166">You can do some or all of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class definition for Step One in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] using the default partial class of the content class, if you produce a separate assembly and then reference it.</span></span> <span data-ttu-id="58052-167">通常は、<xref:System.Windows.Application> オブジェクトを [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] のコンパイルの一部としてアセンブリに含めますが、その <xref:System.Windows.Application> を相互運用の一部として使用することにはなりません。単に、アプリケーションによって参照される [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] ファイルの 1 つ以上のルート クラスを使用し、その部分クラスを参照します。</span><span class="sxs-lookup"><span data-stu-id="58052-167">Although you typically include an <xref:System.Windows.Application> object as part of compiling the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] into an assembly, you do not end up using that <xref:System.Windows.Application> as part of the interoperation, you just use one or more of the root classes for [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files referred to by the application and reference their partial classes.</span></span> <span data-ttu-id="58052-168">手順の残りの部分は、基本的に前述の手順と同様です。</span><span class="sxs-lookup"><span data-stu-id="58052-168">The remainder of the procedure is essentially similar to that outlined above.</span></span>  
>   
>  <span data-ttu-id="58052-169">これらの各手順のコードを使用した説明については、「[チュートリアル: Win32 での WPF コンテンツのホスト](../../../../docs/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32.md)」のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="58052-169">Each of these steps is illustrated through code in the topic [Walkthrough: Hosting WPF Content in Win32](../../../../docs/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32.md).</span></span>  
  
<a name="hosting_an_hwnd"></a>   
## <a name="hosting-a-microsoft-win32-window-in-wpf"></a><span data-ttu-id="58052-170">WPF での Microsoft Win32 ウィンドウのホスト</span><span class="sxs-lookup"><span data-stu-id="58052-170">Hosting a Microsoft Win32 Window in WPF</span></span>  
 <span data-ttu-id="58052-171">ホストするキー、[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]内で他のウィンドウ[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツは、<xref:System.Windows.Interop.HwndHost>クラスです。</span><span class="sxs-lookup"><span data-stu-id="58052-171">The key to hosting a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window within other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is the <xref:System.Windows.Interop.HwndHost> class.</span></span> <span data-ttu-id="58052-172">このクラスは、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 要素ツリーに追加できる [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 要素でウィンドウをラップします。</span><span class="sxs-lookup"><span data-stu-id="58052-172">This class wraps the window in a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element which can be added to a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element tree.</span></span> <span data-ttu-id="58052-173"><xref:System.Windows.Interop.HwndHost>サポートしています[!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)]を使用するホストされたウィンドウのメッセージの処理などのタスクを実行します。</span><span class="sxs-lookup"><span data-stu-id="58052-173"><xref:System.Windows.Interop.HwndHost> also supports [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] that allow you to do such tasks as process messages for the hosted window.</span></span> <span data-ttu-id="58052-174">基本手順は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="58052-174">The basic procedure is:</span></span>  
  
1.  <span data-ttu-id="58052-175">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] アプリケーションの要素ツリーを作成します (コードまたはマークアップによって)。</span><span class="sxs-lookup"><span data-stu-id="58052-175">Create an element tree for a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application (can be through code or markup).</span></span> <span data-ttu-id="58052-176"><xref:System.Windows.Interop.HwndHost> の実装を子要素として追加できる適切な許可ポイントを要素ツリーで検索します。</span><span class="sxs-lookup"><span data-stu-id="58052-176">Find an appropriate and permissible point in the element tree where the <xref:System.Windows.Interop.HwndHost> implementation can be added as a child element.</span></span> <span data-ttu-id="58052-177">この手順では以後、この要素を予約要素と呼びます。</span><span class="sxs-lookup"><span data-stu-id="58052-177">In the remainder of these steps, this element is referred to as the reserving element.</span></span>  
  
2.  <span data-ttu-id="58052-178"><xref:System.Windows.Interop.HwndHost> からの派生クラスを作成し、[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] コンテンツを保持するオブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="58052-178">Derive from <xref:System.Windows.Interop.HwndHost> to create an object that holds your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content.</span></span>  
  
3.  <span data-ttu-id="58052-179">そのホスト クラスで、<xref:System.Windows.Interop.HwndHost> の <xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A> メソッドをオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="58052-179">In that host class, override the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A>.</span></span> <span data-ttu-id="58052-180">ホストされたウィンドウの HWND を返します。</span><span class="sxs-lookup"><span data-stu-id="58052-180">Return the HWND of the hosted window.</span></span> <span data-ttu-id="58052-181">返されたウィンドウの子ウィンドウとして実際のコントロールをラップすることもできます。ホスト ウィンドウでコントロールをラップすると、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツでコントロールからの通知を簡単に受信できます。</span><span class="sxs-lookup"><span data-stu-id="58052-181">You might want to wrap the actual control(s) as a child window of the returned window; wrapping the controls in a host window provides a simple way for your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to receive notifications from the controls.</span></span> <span data-ttu-id="58052-182">この手法により、ホストされたコントロールの境界でのメッセージ処理に関するいくつかの [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 問題を修正できます。</span><span class="sxs-lookup"><span data-stu-id="58052-182">This technique helps correct for some [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] issues regarding message handling at the hosted control boundary.</span></span>  
  
4.  <span data-ttu-id="58052-183"><xref:System.Windows.Interop.HwndHost> の <xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A> メソッドと <xref:System.Windows.Interop.HwndHost.WndProc%2A> メソッドをオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="58052-183">Override the <xref:System.Windows.Interop.HwndHost> methods <xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A> and <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span> <span data-ttu-id="58052-184">これは、クリーンアップの処理およびホストされたコンテンツへの参照の削除を行うためです (特に、アンマネージ オブジェクトへの参照を作成した場合)。</span><span class="sxs-lookup"><span data-stu-id="58052-184">The intention here is to process cleanup and remove references to the hosted content, particularly if you created references to unmanaged objects.</span></span>  
  
5.  <span data-ttu-id="58052-185">分離コード ファイルで、コントロール ホスト クラスのインスタンスを作成し、予約要素の子にします。</span><span class="sxs-lookup"><span data-stu-id="58052-185">In your code-behind file, create an instance of the control hosting class and make it a child of the reserving element.</span></span> <span data-ttu-id="58052-186">通常は、<xref:System.Windows.FrameworkElement.Loaded> などのイベント ハンドラーを使用するか、部分クラス コンストラクターを使用します。</span><span class="sxs-lookup"><span data-stu-id="58052-186">Typically you would use an event handler such as <xref:System.Windows.FrameworkElement.Loaded>, or use the partial class constructor.</span></span> <span data-ttu-id="58052-187">ただし、ランタイム動作によって相互運用コンテンツを追加することもできます。</span><span class="sxs-lookup"><span data-stu-id="58052-187">But you could also add the interoperation content through a runtime behavior.</span></span>  
  
6.  <span data-ttu-id="58052-188">コントロールの通知などの選択されたウィンドウ メッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="58052-188">Process selected window messages, such as control notifications.</span></span> <span data-ttu-id="58052-189">処理方法は 2 つあります。</span><span class="sxs-lookup"><span data-stu-id="58052-189">There are two approaches.</span></span> <span data-ttu-id="58052-190">どちらも同様にメッセージ ストリームにアクセスできるようにするため、どちらを選択するかは、多くの場合、プログラミングの便宜上の理由によって決まります。</span><span class="sxs-lookup"><span data-stu-id="58052-190">Both provide identical access to the message stream, so your choice is largely a matter of programming convenience.</span></span>  
  
    -   <span data-ttu-id="58052-191"><xref:System.Windows.Interop.HwndHost> の <xref:System.Windows.Interop.HwndHost.WndProc%2A> メソッドのオーバーライドで、シャットダウン メッセージだけでなくすべてのメッセージのメッセージ処理を実装します。</span><span class="sxs-lookup"><span data-stu-id="58052-191">Implement message processing for all messages (not just shutdown messages) in your override of the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span>  
  
    -   <span data-ttu-id="58052-192">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] イベントを処理して、ホスト <xref:System.Windows.Interop.HwndHost.MessageHook> 要素でメッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="58052-192">Have the hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element process the messages by handling the <xref:System.Windows.Interop.HwndHost.MessageHook> event.</span></span> <span data-ttu-id="58052-193">このイベントは、ホストされたウィンドウのメイン ウィンドウ プロシージャに送信されるすべてのメッセージに対して発生します。</span><span class="sxs-lookup"><span data-stu-id="58052-193">This event is raised for every message that is sent to the main window procedure of the hosted window.</span></span>  
  
    -   <span data-ttu-id="58052-194">メッセージは、<xref:System.Windows.Interop.HwndHost.WndProc%2A> を使用するプロセスで発生したウィンドウからは処理できません。</span><span class="sxs-lookup"><span data-stu-id="58052-194">You cannot process messages from windows that are out of process using <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span>  
  
7.  <span data-ttu-id="58052-195">プラットフォーム呼び出しを使用してアンマネージ `SendMessage` 関数を呼び出し、ホストされたウィンドウと通信します。</span><span class="sxs-lookup"><span data-stu-id="58052-195">Communicate with the hosted window by using platform invoke to call the unmanaged `SendMessage` function.</span></span>  
  
 <span data-ttu-id="58052-196">次の手順に従って、マウス入力で動作するアプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="58052-196">Following these steps creates an application that works with mouse input.</span></span> <span data-ttu-id="58052-197"><xref:System.Windows.Interop.IKeyboardInputSink> インターフェイスを実装して、ホストされたウィンドウで Tab キーによる移動がサポートされるようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="58052-197">You can add tabbing support for your hosted window by implementing the <xref:System.Windows.Interop.IKeyboardInputSink> interface.</span></span>  
  
 <span data-ttu-id="58052-198">これらの各手順のコードを使用した説明については、「[チュートリアル: WPF での Win32 コントロールのホスト](../../../../docs/framework/wpf/advanced/walkthrough-hosting-a-win32-control-in-wpf.md)」のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="58052-198">Each of these steps is illustrated through code in the topic [Walkthrough: Hosting a Win32 Control in WPF](../../../../docs/framework/wpf/advanced/walkthrough-hosting-a-win32-control-in-wpf.md).</span></span>  
  
### <a name="hwnds-inside-wpf"></a><span data-ttu-id="58052-199">WPF 内の HWND</span><span class="sxs-lookup"><span data-stu-id="58052-199">Hwnds Inside WPF</span></span>  
 <span data-ttu-id="58052-200"><xref:System.Windows.Interop.HwndHost> は特殊なコントロールであると考えることができます </span><span class="sxs-lookup"><span data-stu-id="58052-200">You can think of <xref:System.Windows.Interop.HwndHost> as a special control.</span></span> <span data-ttu-id="58052-201">(技術的には、<xref:System.Windows.Interop.HwndHost>は、<xref:System.Windows.FrameworkElement>派生クラスにはない、<xref:System.Windows.Controls.Control>派生クラスには、相互運用のためのコントロールと見なされることができます)。<xref:System.Windows.Interop.HwndHost> 、基になるを抽象化[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]ホストされているコンテンツの種類になるようの残りの部分[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]レンダリングし、入力を処理する必要がありますが、別のコントロールのようなオブジェクトをホストするコンテンツを考慮します。</span><span class="sxs-lookup"><span data-stu-id="58052-201">(Technically, <xref:System.Windows.Interop.HwndHost> is a <xref:System.Windows.FrameworkElement> derived class, not a <xref:System.Windows.Controls.Control> derived class, but it can be considered a control for purposes of interoperation.) <xref:System.Windows.Interop.HwndHost> abstracts the underlying [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] nature of the hosted content such that the remainder of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] considers the hosted content to be another control-like object, which should render and process input.</span></span> <span data-ttu-id="58052-202"><xref:System.Windows.Interop.HwndHost>一般に、他のように動作[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.FrameworkElement>(描画およびグラフィックス) の出力の周囲のいくつかの重要な違いがあるし、どのような基になる Hwnd の制限事項に基づく入力 (マウスとキーボード) をサポートできますが、します。</span><span class="sxs-lookup"><span data-stu-id="58052-202"><xref:System.Windows.Interop.HwndHost> generally behaves like any other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.FrameworkElement>, although there are some important differences around output (drawing and graphics) and input (mouse and keyboard) based on limitations of what the underlying HWNDs can support.</span></span>  
  
#### <a name="notable-differences-in-output-behavior"></a><span data-ttu-id="58052-203">出力動作の顕著な違い</span><span class="sxs-lookup"><span data-stu-id="58052-203">Notable Differences in Output Behavior</span></span>  
  
-   <span data-ttu-id="58052-204"><xref:System.Windows.FrameworkElement> の基底クラスである <xref:System.Windows.Interop.HwndHost> には、UI の変更に関係する多くのプロパティが用意されています。</span><span class="sxs-lookup"><span data-stu-id="58052-204"><xref:System.Windows.FrameworkElement>, which is the <xref:System.Windows.Interop.HwndHost> base class, has quite a few properties that imply changes to the UI.</span></span> <span data-ttu-id="58052-205">これには、親要素内の要素のレイアウトを変更する <xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType> などのプロパティが含まれます。</span><span class="sxs-lookup"><span data-stu-id="58052-205">These include properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType>, which changes the layout of elements within that element as a parent.</span></span> <span data-ttu-id="58052-206">ただし、これらのプロパティの多くは、[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] で等価機能が存在し得るとしても、それに対応付けられていません。</span><span class="sxs-lookup"><span data-stu-id="58052-206">However, most of these properties are not mapped to possible [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] equivalents, even if such equivalents might exist.</span></span> <span data-ttu-id="58052-207">非常に多くのプロパティとその意味がレンダリング テクノロジ固有でありすぎるために、対応付けをしても役に立ちません。</span><span class="sxs-lookup"><span data-stu-id="58052-207">Too many of these properties and their meanings are too rendering-technology specific for mappings to be practical.</span></span> <span data-ttu-id="58052-208">したがってなどのプロパティの設定<xref:System.Windows.FrameworkElement.FlowDirection%2A>で<xref:System.Windows.Interop.HwndHost>も何も起こりません。</span><span class="sxs-lookup"><span data-stu-id="58052-208">Therefore, setting properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A> on <xref:System.Windows.Interop.HwndHost> has no effect.</span></span>  
  
-   <span data-ttu-id="58052-209"><xref:System.Windows.Interop.HwndHost> は、回転、拡大縮小、傾斜、または変換の影響を受けません。</span><span class="sxs-lookup"><span data-stu-id="58052-209"><xref:System.Windows.Interop.HwndHost> cannot be rotated, scaled, skewed, or otherwise affected by a Transform.</span></span>  
  
-   <span data-ttu-id="58052-210"><xref:System.Windows.Interop.HwndHost> では、<xref:System.Windows.UIElement.Opacity%2A> プロパティ (アルファ ブレンディング) はサポートされません。</span><span class="sxs-lookup"><span data-stu-id="58052-210"><xref:System.Windows.Interop.HwndHost> does not support the <xref:System.Windows.UIElement.Opacity%2A> property (alpha blending).</span></span> <span data-ttu-id="58052-211"><xref:System.Windows.Interop.HwndHost> 内のコンテンツでアルファ情報を含む <xref:System.Drawing> 操作が実行される場合、それ自体は違反ではありませんが、<xref:System.Windows.Interop.HwndHost> 全体では不透明度 = 1.0 (100%) のみがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="58052-211">If content inside the <xref:System.Windows.Interop.HwndHost> performs <xref:System.Drawing> operations that include alpha information, that is itself not a violation, but the <xref:System.Windows.Interop.HwndHost> as a whole only supports Opacity = 1.0 (100%).</span></span>  
  
-   <span data-ttu-id="58052-212"><xref:System.Windows.Interop.HwndHost> は、同じトップレベル ウィンドウの他の [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 要素の上に表示されます。</span><span class="sxs-lookup"><span data-stu-id="58052-212"><xref:System.Windows.Interop.HwndHost> will appear on top of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements in the same top-level window.</span></span> <span data-ttu-id="58052-213">ただし、<xref:System.Windows.Controls.ToolTip> または <xref:System.Windows.Controls.ContextMenu> で生成されるメニューは独立したトップレベル ウィンドウであるため、<xref:System.Windows.Interop.HwndHost> で正しく動作します。</span><span class="sxs-lookup"><span data-stu-id="58052-213">However, a <xref:System.Windows.Controls.ToolTip> or <xref:System.Windows.Controls.ContextMenu> generated menu is a separate top-level window, and so will behave correctly with <xref:System.Windows.Interop.HwndHost>.</span></span>  
  
-   <span data-ttu-id="58052-214"><xref:System.Windows.Interop.HwndHost> は、親 <xref:System.Windows.UIElement> のクリッピング領域に対応しません。</span><span class="sxs-lookup"><span data-stu-id="58052-214"><xref:System.Windows.Interop.HwndHost> does not respect the clipping region of its parent <xref:System.Windows.UIElement>.</span></span> <span data-ttu-id="58052-215">これは、<xref:System.Windows.Interop.HwndHost> クラスをスクロール領域または <xref:System.Windows.Controls.Canvas> に格納しようとする場合に問題となる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="58052-215">This is potentially an issue if you attempt to put an <xref:System.Windows.Interop.HwndHost> class inside a scrolling region or <xref:System.Windows.Controls.Canvas>.</span></span>  
  
#### <a name="notable-differences-in-input-behavior"></a><span data-ttu-id="58052-216">入力動作の顕著な違い</span><span class="sxs-lookup"><span data-stu-id="58052-216">Notable Differences in Input Behavior</span></span>  
  
-   <span data-ttu-id="58052-217">通常、入力デバイスは、<xref:System.Windows.Interop.HwndHost> がホストする [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 領域内がスコープとなり、入力イベントは [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] に直接移動します。</span><span class="sxs-lookup"><span data-stu-id="58052-217">In general, while input devices are scoped within the <xref:System.Windows.Interop.HwndHost> hosted [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, input events go directly to [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span></span>  
  
-   <span data-ttu-id="58052-218">上にマウスが中に、 <xref:System.Windows.Interop.HwndHost>、アプリケーションが受信しない[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]マウス イベント、およびの値、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]プロパティ<xref:System.Windows.UIElement.IsMouseOver%2A>なります`false`です。</span><span class="sxs-lookup"><span data-stu-id="58052-218">While the mouse is over the <xref:System.Windows.Interop.HwndHost>, your application does not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] mouse events, and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsMouseOver%2A> will be `false`.</span></span>  
  
-   <span data-ttu-id="58052-219">中に、<xref:System.Windows.Interop.HwndHost>キーボード フォーカスがある、アプリケーションは受け取りません[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]キーボード イベントとの値、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]プロパティ<xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A>なります`false`です。</span><span class="sxs-lookup"><span data-stu-id="58052-219">While the <xref:System.Windows.Interop.HwndHost> has keyboard focus, your application will not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] keyboard events and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A> will be `false`.</span></span>  
  
-   <span data-ttu-id="58052-220">内でフォーカスがある場合、<xref:System.Windows.Interop.HwndHost>内の別のコントロールが変更され、 <xref:System.Windows.Interop.HwndHost>、アプリケーションは受け取りません、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]イベント<xref:System.Windows.UIElement.GotFocus>または<xref:System.Windows.UIElement.LostFocus>です。</span><span class="sxs-lookup"><span data-stu-id="58052-220">When focus is within the <xref:System.Windows.Interop.HwndHost> and changes to another control inside the <xref:System.Windows.Interop.HwndHost>, your application will not receive the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events <xref:System.Windows.UIElement.GotFocus> or <xref:System.Windows.UIElement.LostFocus>.</span></span>  
  
-   <span data-ttu-id="58052-221">関連するスタイラス プロパティおよびイベントは類似しており、スタイラスが <xref:System.Windows.Interop.HwndHost> 上にあるときは情報を報告しません。</span><span class="sxs-lookup"><span data-stu-id="58052-221">Related stylus properties and events are analogous, and do not report information while the stylus is over <xref:System.Windows.Interop.HwndHost>.</span></span>  
  
<a name="tabbing_mnemonics_accelerators"></a>   
## <a name="tabbing-mnemonics-and-accelerators"></a><span data-ttu-id="58052-222">Tab キーによる移動、ニーモニック、およびアクセラレータ</span><span class="sxs-lookup"><span data-stu-id="58052-222">Tabbing, Mnemonics, and Accelerators</span></span>  
 <span data-ttu-id="58052-223"><xref:System.Windows.Interop.IKeyboardInputSink> インターフェイスおよび <xref:System.Windows.Interop.IKeyboardInputSite> インターフェイスを使用すると、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] と [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] が混在するアプリケーションでシームレスなキーボード操作を実現できます。</span><span class="sxs-lookup"><span data-stu-id="58052-223">The <xref:System.Windows.Interop.IKeyboardInputSink> and <xref:System.Windows.Interop.IKeyboardInputSite> interfaces allow you to create a seamless keyboard experience for mixed [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] applications:</span></span>  
  
-   <span data-ttu-id="58052-224">
          [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] コンポーネントと [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンポーネント間の Tab キーによる移動</span><span class="sxs-lookup"><span data-stu-id="58052-224">Tabbing between [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] components</span></span>  
  
-   <span data-ttu-id="58052-225">フォーカスが Win32 コンポーネント内にある場合と WPF コンポーネント内にある場合の両方で動作するニーモニックおよびアクセラレータ</span><span class="sxs-lookup"><span data-stu-id="58052-225">Mnemonics and accelerators that work both when focus is within a Win32 component and when it is within a WPF component.</span></span>  
  
 <span data-ttu-id="58052-226"><xref:System.Windows.Interop.HwndHost> クラスと <xref:System.Windows.Interop.HwndSource> クラスはどちらも <xref:System.Windows.Interop.IKeyboardInputSink> の実装を提供しますが、より高度なシナリオで必要な入力メッセージが一部処理されない場合があります。</span><span class="sxs-lookup"><span data-stu-id="58052-226">The <xref:System.Windows.Interop.HwndHost> and <xref:System.Windows.Interop.HwndSource> classes both provide implementations of <xref:System.Windows.Interop.IKeyboardInputSink>, but they may not handle all the input messages that you want for more advanced scenarios.</span></span> <span data-ttu-id="58052-227">適切なメソッドをオーバーライドして、必要なキーボード動作を確保してください。</span><span class="sxs-lookup"><span data-stu-id="58052-227">Override the appropriate methods to get the keyboard behavior you want.</span></span>  
  
 <span data-ttu-id="58052-228">インターフェイスは、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 領域と [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 領域間の遷移で発生する処理をサポートするだけです。</span><span class="sxs-lookup"><span data-stu-id="58052-228">The interfaces only provide support for what happens on the transition between the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] regions.</span></span> <span data-ttu-id="58052-229">
          [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 領域では、Tab キーによる移動動作は、Tab キーによる移動の [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 実装ロジック (ある場合) によって完全に制御されます。</span><span class="sxs-lookup"><span data-stu-id="58052-229">Within the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, tabbing behavior is entirely controlled by the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] implemented logic for tabbing, if any.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="58052-230">関連項目</span><span class="sxs-lookup"><span data-stu-id="58052-230">See Also</span></span>  
 <xref:System.Windows.Interop.HwndHost>  
 <xref:System.Windows.Interop.HwndSource>  
 <xref:System.Windows.Interop>  
 [<span data-ttu-id="58052-231">チュートリアル: WPF での Win32 コントロールのホスト</span><span class="sxs-lookup"><span data-stu-id="58052-231">Walkthrough: Hosting a Win32 Control in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-hosting-a-win32-control-in-wpf.md)  
 [<span data-ttu-id="58052-232">チュートリアル: Win32 での WPF コンテンツのホスト</span><span class="sxs-lookup"><span data-stu-id="58052-232">Walkthrough: Hosting WPF Content in Win32</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32.md)
