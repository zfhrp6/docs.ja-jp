### <a name="cspparametersparentwindowhandle-now-expects-hwnd-value"></a><span data-ttu-id="bc3a1-101">CspParameters.ParentWindowHandle が HWND 値を受け取るようになる</span><span class="sxs-lookup"><span data-stu-id="bc3a1-101">CspParameters.ParentWindowHandle now expects HWND value</span></span>

|   |   |
|---|---|
|<span data-ttu-id="bc3a1-102">説明</span><span class="sxs-lookup"><span data-stu-id="bc3a1-102">Details</span></span>|<span data-ttu-id="bc3a1-103">.NET Framework 2.0 で導入された <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle> 値をアプリケーションに使用すると、親ウィンドウのハンドル値を登録できます。これを利用して、キーにアクセスする必要がある UI (PIN プロンプトや同意を求めるダイアログなど) を、指定したウィンドウの子のモーダルとして開くことができます。 .NET Framework 4.7 を対象とするアプリ以降では、Windows フォーム アプリケーションは、次のようなコードを使用して、<xref:System.Security.Cryptography.CspParameters.ParentWindowHandle> プロパティを設定できます。</span><span class="sxs-lookup"><span data-stu-id="bc3a1-103">The <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle> value, introduced in .NET Framework 2.0, allows an application to register a parent window handle value such that any UI required to access the key (such as a PIN prompt or consent dialog) opens as a modal child to the specified window.Starting with apps that target the .NET Framework 4.7, a Windows Forms application can set the <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle> property with code like the following:</span></span><pre><code class="lang-csharp">cspParameters.ParentWindowHandle = form.Handle;&#13;&#10;</code></pre><span data-ttu-id="bc3a1-104">以前のバージョンの .NET Framework では、[HWND](https://msdn.microsoft.com/library/windows/desktop/aa383751.aspx#HWND) 値が置かれているメモリ内の場所を表す <xref:System.IntPtr?displayProperty=name> が値として必要でした。</span><span class="sxs-lookup"><span data-stu-id="bc3a1-104">In previous versions of the .NET Framework, the value was expected to be an <xref:System.IntPtr?displayProperty=name> representing a location in memory where the [HWND](https://msdn.microsoft.com/library/windows/desktop/aa383751.aspx#HWND) value resided.</span></span> <span data-ttu-id="bc3a1-105">Windows 7 以前のバージョンでこのプロパティを form.Handle に設定しても影響はありませんでしたが、Windows 8 以降のバージョンでは、&quot;<xref:System.Security.Cryptography.CryptographicException?displayProperty=name>: パラメーターが正しくありません&quot; が表示されます。</span><span class="sxs-lookup"><span data-stu-id="bc3a1-105">Setting the property to form.Handle on Windows 7 and earlier versions had no effect, but on Windows 8 and later versions, it results in a &quot;<xref:System.Security.Cryptography.CryptographicException?displayProperty=name>: The parameter is incorrect.&quot;</span></span>|
|<span data-ttu-id="bc3a1-106">提案される解決策</span><span class="sxs-lookup"><span data-stu-id="bc3a1-106">Suggestion</span></span>|<span data-ttu-id="bc3a1-107">.NET Framework 4.7 以降をターゲットとするアプリケーションで親ウィンドウの関係を登録する場合、次のように単純な形式を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="bc3a1-107">Applications targeting .NET Framework 4.7 or higher wishing to register a parent window relationship are encouraged to use the simplified form:</span></span><pre><code class="lang-csharp">cspParameters.ParentWindowHandle = form.Handle;&#13;&#10;</code></pre><span data-ttu-id="bc3a1-108">渡すべき正しい値が値 <code>form.Handle</code> を保持していたメモリ内の場所のアドレスであったことを特定していた場合、AppContext スイッチ <code>Switch.System.Security.Cryptography.DoNotAddrOfCspParentWindowHandle</code> を <code>true</code> に設定し、動作変更を無効にできます。</span><span class="sxs-lookup"><span data-stu-id="bc3a1-108">Users who had identified that the correct value to pass was the address of a memory location which held the value <code>form.Handle</code> can opt out of the behavior change by setting the AppContext switch <code>Switch.System.Security.Cryptography.DoNotAddrOfCspParentWindowHandle</code> to <code>true</code>.</span></span><ol><li><span data-ttu-id="bc3a1-109">プログラムで AppContext の互換性スイッチを設定する (説明は[こちらに](http://blogs.msdn.com/b/dotnet/archive/2015/04/29/net-announcements-at-build-2015.aspx#dotnet46)あります)</span><span class="sxs-lookup"><span data-stu-id="bc3a1-109">By programmatically setting compat switches on the AppContext, as explained [here](http://blogs.msdn.com/b/dotnet/archive/2015/04/29/net-announcements-at-build-2015.aspx#dotnet46)</span></span></li><li><span data-ttu-id="bc3a1-110">app.config ファイルの <code>&lt;runtime&gt;</code> セクションに以下の行を追加する:</span><span class="sxs-lookup"><span data-stu-id="bc3a1-110">By adding the following line to the <code>&lt;runtime&gt;</code> section of the app.config file:</span></span></li></ol><pre><code class="lang-xml">&lt;runtime&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.System.Security.Cryptography.DoNotAddrOfCspParentWindowHandle=true&quot;/&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;</code></pre><span data-ttu-id="bc3a1-111">逆に、アプリケーションが以前のバージョンの .NET Framework の下で読み込むとき、.NET Framework 4.7 ランタイムで新しい動作を選択する場合、AppContext スイッチを <code>false</code> に設定できます。</span><span class="sxs-lookup"><span data-stu-id="bc3a1-111">Conversely, users who wish to opt in to the new behavior on the .NET Framework 4.7 runtime when the application loads under older .NET Framework versions can set the AppContext switch to <code>false</code>.</span></span>|
|<span data-ttu-id="bc3a1-112">スコープ</span><span class="sxs-lookup"><span data-stu-id="bc3a1-112">Scope</span></span>|<span data-ttu-id="bc3a1-113">マイナー</span><span class="sxs-lookup"><span data-stu-id="bc3a1-113">Minor</span></span>|
|<span data-ttu-id="bc3a1-114">Version</span><span class="sxs-lookup"><span data-stu-id="bc3a1-114">Version</span></span>|<span data-ttu-id="bc3a1-115">4.7</span><span class="sxs-lookup"><span data-stu-id="bc3a1-115">4.7</span></span>|
|<span data-ttu-id="bc3a1-116">型</span><span class="sxs-lookup"><span data-stu-id="bc3a1-116">Type</span></span>|<span data-ttu-id="bc3a1-117">再ターゲット中</span><span class="sxs-lookup"><span data-stu-id="bc3a1-117">Retargeting</span></span>|
|<span data-ttu-id="bc3a1-118">影響を受ける API</span><span class="sxs-lookup"><span data-stu-id="bc3a1-118">Affected APIs</span></span>|<ul><li><xref:System.Security.Cryptography.CspParameters.ParentWindowHandle?displayProperty=nameWithType></li></ul>|

