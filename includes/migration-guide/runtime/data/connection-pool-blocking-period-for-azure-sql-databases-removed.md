### <a name="connection-pool-blocking-period-for-azure-sql-databases-is-removed"></a><span data-ttu-id="f9f76-101">Azure SQL データベースの接続プールのブロック期間が削除される</span><span class="sxs-lookup"><span data-stu-id="f9f76-101">Connection pool blocking period for Azure SQL databases is removed</span></span>

|   |   |
|---|---|
|<span data-ttu-id="f9f76-102">説明</span><span class="sxs-lookup"><span data-stu-id="f9f76-102">Details</span></span>|<span data-ttu-id="f9f76-103">.NET Framework 4.6.2 以降では、既知の Azure SQL データベースへの接続確立要求の場合 (*.database.windows.net、*.database.chinacloudapi.cn、*.database.usgovcloudapi.net、*.database.cloudapi.de)、接続プールのブロック期間が削除され、接続確立のエラーはキャッシュされません。</span><span class="sxs-lookup"><span data-stu-id="f9f76-103">Starting with the .NET Framework 4.6.2, for connection open requests to known Azure SQL databases (*.database.windows.net, *.database.chinacloudapi.cn, *.database.usgovcloudapi.net, *.database.cloudapi.de), the connection pool blocking period is removed, and connection open errors are not cached.</span></span> <span data-ttu-id="f9f76-104">接続オープン要求の再試行は、一時的な接続エラーのほぼすぐ後に発生します。</span><span class="sxs-lookup"><span data-stu-id="f9f76-104">Attempts to retry connection open requests will occur almost immediately after transient connection errors.</span></span> <span data-ttu-id="f9f76-105">この変更により、Azure SQL データベースへの接続確立がすぐに再試行するされるため、クラウド対応アプリケーションのパフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="f9f76-105">This change allows the connection open attempt to be retried immediately for Azure SQL databases, thereby improving the performance of cloud- enabled apps.</span></span> <span data-ttu-id="f9f76-106">他のすべての接続を試みる場合は、接続プールのブロック期間が引き続き適用されます。</span><span class="sxs-lookup"><span data-stu-id="f9f76-106">For all other connection attempts, the connection pool blocking period continues to be enforced.</span></span><p/><span data-ttu-id="f9f76-107">.NET Framework 4.6.1 以前のバージョンでは、データベースへの接続時にアプリで一時的な接続エラーが発生した場合、接続はすぐに再試行されません。接続プールがエラーをキャッシュし、5 秒 ～ 1 分の間にエラーを再スローするためです。</span><span class="sxs-lookup"><span data-stu-id="f9f76-107">In the .NET Framework 4.6.1 and earlier versions, when an app encounters a transient connection failure when connecting to a database, the connection attempt cannot be retried quickly, because the connection pool caches the error and re-throws it for 5 seconds to 1 minute.</span></span> <span data-ttu-id="f9f76-108">詳しくは、「[SQL Server の接続プール (ADO.NET)](~/docs/framework/data/adonet/sql-server-connection-pooling.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f9f76-108">For more information, see [SQL Server Connection Pooling (ADO.NET)](~/docs/framework/data/adonet/sql-server-connection-pooling.md).</span></span> <span data-ttu-id="f9f76-109">この動作は、Azure SQL データベースへの接続時に問題となります。多くの場合、一時的なエラーが発生し、通常数秒内に回復します。</span><span class="sxs-lookup"><span data-stu-id="f9f76-109">This behavior is problematic for connections to Azure SQL databases, which often fail with transient errors that are typically recovered from within a few seconds.</span></span> <span data-ttu-id="f9f76-110">接続プールのブロック機能を使うと、データベースが使用可能で、アプリが数秒以内にレンダリングする必要がある場合でも、アプリは長期間データベースに接続できません。</span><span class="sxs-lookup"><span data-stu-id="f9f76-110">The connection pool blocking feature means that the app cannot connect to the database for an extensive period, even though the database is available and the app needs to render within a few seconds.</span></span>|
|<span data-ttu-id="f9f76-111">提案される解決策</span><span class="sxs-lookup"><span data-stu-id="f9f76-111">Suggestion</span></span>|<span data-ttu-id="f9f76-112">この動作が望ましくない場合は、.NET Framework 4.6.2 で導入された <xref:System.Data.SqlClient.SqlConnectionStringBuilder.PoolBlockingPeriod?displayProperty=name> プロパティを設定することで、接続プールのブロック期間を構成できます。</span><span class="sxs-lookup"><span data-stu-id="f9f76-112">If this behavior is undesirable, the connection pool blocking period can be configured by setting the <xref:System.Data.SqlClient.SqlConnectionStringBuilder.PoolBlockingPeriod?displayProperty=name> property introduced in the .NET Framework 4.6.2.</span></span> <span data-ttu-id="f9f76-113">プロパティ値が <xref:System.Data.SqlClient.PoolBlockingPeriod?displayProperty=name> 列挙型のメンバーである場合、次の 3 つの値のいずれかを使用できます。</span><span class="sxs-lookup"><span data-stu-id="f9f76-113">The value of the property is a member of the <xref:System.Data.SqlClient.PoolBlockingPeriod?displayProperty=name> enumeration that can take either of three values:</span></span><ul><li><xref:System.Data.SqlClient.PoolBlockingPeriod.AlwaysBlock></li><li><xref:System.Data.SqlClient.PoolBlockingPeriod.Auto></li><li><xref:System.Data.SqlClient.PoolBlockingPeriod.NeverBlock></li></ul><span data-ttu-id="f9f76-114"><xref:System.Data.SqlClient.SqlConnectionStringBuilder.PoolBlockingPeriod?displayProperty=name> プロパティを <xref:System.Data.SqlClient.PoolBlockingPeriod.AlwaysBlock> に設定して、以前の動作を復元することができます。</span><span class="sxs-lookup"><span data-stu-id="f9f76-114">The previous behavior can be restored by setting the <xref:System.Data.SqlClient.SqlConnectionStringBuilder.PoolBlockingPeriod?displayProperty=name> property to <xref:System.Data.SqlClient.PoolBlockingPeriod.AlwaysBlock>.</span></span>|
|<span data-ttu-id="f9f76-115">スコープ</span><span class="sxs-lookup"><span data-stu-id="f9f76-115">Scope</span></span>|<span data-ttu-id="f9f76-116">マイナー</span><span class="sxs-lookup"><span data-stu-id="f9f76-116">Minor</span></span>|
|<span data-ttu-id="f9f76-117">Version</span><span class="sxs-lookup"><span data-stu-id="f9f76-117">Version</span></span>|<span data-ttu-id="f9f76-118">4.6.2</span><span class="sxs-lookup"><span data-stu-id="f9f76-118">4.6.2</span></span>|
|<span data-ttu-id="f9f76-119">型</span><span class="sxs-lookup"><span data-stu-id="f9f76-119">Type</span></span>|<span data-ttu-id="f9f76-120">ランタイム</span><span class="sxs-lookup"><span data-stu-id="f9f76-120">Runtime</span></span>|
|<span data-ttu-id="f9f76-121">影響を受ける API</span><span class="sxs-lookup"><span data-stu-id="f9f76-121">Affected APIs</span></span>|<ul><li><xref:System.Data.Common.DbConnection.OpenAsync?displayProperty=nameWithType></li><li><xref:System.Data.SqlClient.SqlConnection.Open?displayProperty=nameWithType></li><li><xref:System.Data.SqlClient.SqlConnection.OpenAsync(System.Threading.CancellationToken)?displayProperty=nameWithType></li></ul>|

